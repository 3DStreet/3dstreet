<html>
  <head>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-sun-sky@^3.0.3/dist/aframe-sun-sky.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.5.0/velocity.js"></script> -->
    <script src="https://unpkg.com/aframe-orbit-controls@1.2.0/dist/aframe-orbit-controls.min.js"></script>
    <script src="https://unpkg.com/aframe-ground-component@0.0.4/dist/aframe-ground-component.min.js"></script>
    <script src="https://unpkg.com/aframe-atlas-uvs-component@2.1.0/dist/aframe-atlas-uvs-component.min.js"></script>

    <script src="js/aframe-streetmix-textured.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="js/intro.css">

  </head>
  <body>

    <a-scene fogoff="type: linear; color: #D5C69B; far: 200" gltf-model="dracoDecoderPath: js/;">
      <a-assets>
        <a-asset-item id="xd40" src="assets/objects/XD40.glb"></a-asset-item>
        <a-asset-item id="carmodel" src="assets/objects/SM_Veh_Car_Sedan_01.gltf"></a-asset-item>

        <a-asset-item id="fence-model" src="assets/objects/chainlink_fence_-_low_poly.glb"></a-asset-item>

        <a-asset-item id="lamp-modern-glb" src="assets/objects/lamp-post-modern-centered.glb"></a-asset-item>
        <a-asset-item id="lamp-traditional-glb" src="assets/objects/lamp-post-traditional.glb"></a-asset-item>

        <a-asset-item id="pylon-obj" src="assets/objects/nyc-wayfinding-pylon-large-nomtl.obj"></a-asset-item>
        <image id="wayfinding" src="assets/objects/wayfinding.jpg" />

        <image id="sky" src="assets/CGSkies_0343_8k_ERextended.jpg" />

        <a-mixin id="drive-lane-t1" geometry="width:3;height:150;primitive:plane" material="repeat:0.3 25;offset:0.55 0;src:materials/TexturesCom_Roads0086_1_seamless_S_rotate.jpg;"></a-mixin>
        <a-mixin id="drive-lane-t0" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/asphalthd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/asphalthd_Normal.jpg;"></a-mixin>

        <a-mixin id="bike-lane-t1" geometry="width:1.8;height:150;primitive:plane" material="repeat:0.3 25;offset:0.55 0;color:#adff83;roughness:1;metalness:0;src:materials/TexturesCom_Roads0086_1_seamless_S_rotate.jpg;"></a-mixin>
        <a-mixin id="bike-lane-t0" geometry="width:1.8;height:150;primitive:plane" material="repeat:2 150;src:materials/bikelane_Base_Color.jpg;normalTextureRepeat:2 150;normalMap:materials/bikelane_Normal.jpg"></a-mixin>

        <a-mixin id="sidewalk-t1" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/TexturesCom_FloorsRegular0301_1_seamless_S.jpg;"></a-mixin>
        <a-mixin id="sidewalk-t0" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/sidewalkhd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/sidewalkhd_Normal.jpg;"></a-mixin>

        <a-mixin id="bus-lane-t0" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/asphaltred1hd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/asphaltred1hd_Normal.jpg;"></a-mixin>
        <a-mixin id="bus-lane-t1" geometry="width:3;height:150;primitive:plane" material="repeat:0.3 25;offset:0.55 0;color:#e5534c;src:materials/TexturesCom_Roads0086_1_seamless_S_rotate.jpg;"></a-mixin>

        <a-mixin id="divider-t1" geometry="width:0.3;height:150;primitive:plane" material="repeat:1 150;offset:0.415 0;normalTextureOffset:0.415 0;src:materials/hatched_Base_Color.jpg;normalTextureRepeat:0.21 150;normalMap:materials/hatched_Normal.jpg"></a-mixin>

        <a-mixin id="separator-dashed-t1" geometry="width:0.4;height:150;primitive:plane" material="repeat:0.25 25;offset:0.38 0;src:materials/separator-short-dash_1024.png;transparent: true;"></a-mixin>
        <a-mixin id="separator-solid-t1" geometry="width:0.4;height:150;primitive:plane" material="repeat:0.25 25;offset:0.38 0;src:materials/separator-solid_1024.png;transparent: true;"></a-mixin>
        <a-mixin id="separator-doubleyellow-t1" geometry="width:0.5;height:150;primitive:plane" material="repeat:0.25 25;offset:0.38 0;src:materials/separator-double-yellow_512.png;transparent: true;"></a-mixin>

        <a-mixin id="markings" atlas-uvs="totalRows: 4; totalColumns: 4" scale="2 2 2" material="src: materials/lane-markings-atlas_2048.png;alphaTest: 0;transparent:true;" geometry="primitive: plane; buffer: false; skipCache: true"></a-mixin>
        <a-mixin id="right" atlas-uvs="column: 3; row: 2"></a-mixin>
        <a-mixin id="left" atlas-uvs="column: 3; row: 3"></a-mixin>
        <a-mixin id="both" atlas-uvs="column: 2; row: 1"></a-mixin>
        <a-mixin id="all" atlas-uvs="column: 3; row: 1"></a-mixin>
        <a-mixin id="left-straight" atlas-uvs="column: 2; row: 3"></a-mixin>
        <a-mixin id="right-straight" atlas-uvs="column: 2; row: 2"></a-mixin>
        <a-mixin id="straight" atlas-uvs="column: 2; row: 4"></a-mixin>
        <a-mixin id="sharrow" atlas-uvs="totalRows: 4; totalColumns: 8; column: 2; row: 3" scale="1.5 3 1"></a-mixin>
        <a-mixin id="marking-bike-lane" atlas-uvs="totalRows: 2; totalColumns: 8; column: 1; row: 2" scale="1 4 1"></a-mixin>


        <a-mixin id="bus" gltf-model="#xd40" scale="1.55 1.55 1.55"></a-mixin>
        <a-mixin id="car" gltf-model="#carmodel"></a-mixin>

        <a-mixin id="bus-shadow" geometry="width: 12; height: 3; primitive: plane"  material="src: url(materials/bus-shadow.png); alphaTest: 0;transparent:true; roughness: 1;" ></a-mixin>
        <a-mixin id="car-shadow" geometry="width: 4.7; height: 2.5; primitive: plane"  material="src: url(materials/bus-shadow.png); alphaTest: 0;transparent:true; roughness: 1;" ></a-mixin>

        <a-mixin id="lamp-modern" gltf-model="#lamp-modern-glb" scale="0.5 0.5 0.5"></a-mixin>
        <a-mixin id="lamp-traditional" gltf-model="#lamp-traditional-glb" scale="0.2 0.2 0.2" ></a-mixin>
        <a-mixin id="pride-flag" position="0.409 3.345 0" rotation="0 0 0" scale="0.5 0.75 0" geometry="width:2;height:2;primitive:plane" material="side:double; src:materials/rainbow-flag-poles_512.png;transparent: true;"></a-mixin>

        <a-mixin id="fence" gltf-model="#fence-model" scale="0.1 0.1 0.1"></a-mixin>

        <image id="subtitle" src="materials/subtitle.png" />
      </a-assets>

      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="0.5 1 -1"></a-entity>

      <a-entity id="cam-parent">
        <a-entity id="camera" orbit-controls="target: 0 0 0;initialPosition:0 2 10;minDistance:3;maxDistance:100;"></a-entity>
      </a-entity>

      <!-- Label text -->
      <!-- <a-entity position="0 2 0" geometry="primitive: plane; width: 10; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                text="color: yellow; align: left; value: San Francisco; width: 10; ">
        <a-entity position="-5.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.46" material="color: white;"></a-entity>
      </a-entity>
      <a-entity position="5 1 0" geometry="primitive: plane; width: 20; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                text="color: yellow; align: left; value: Harrison Street; width: 20; ">
        <a-entity position="-10.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.92" material="color: white;"></a-entity>
      </a-entity> -->

      <!-- static entities for debugging textures without parsing json -->
      <!-- <a-entity id="static-textured" position="0 0.1 0">
        <a-entity class="sidewalk" mixin="sidewalk-t1" position="-5.521 0.21 -0.282" rotation="270 0 0"></a-entity>
        <a-entity class="bike-lane" mixin="bike-lane-t1" position="-3.17 0.11 -0.282" rotation="270 0 0"> </a-entity>
        <a-entity class="separator-dashed" mixin="separator-dashed-t1" position="-2.1 0.12 -0.282" rotation="270 0 0"> </a-entity>
        <a-entity class="drive-lane" mixin="drive-lane-t1" position="-0.776 0.11 -0.285" rotation="270 0 0" ></a-entity>
        <a-entity class="divider" mixin="divider-t1" position="0.869 0.11 -0.282" rotation="270 0 0" ></a-entity>
        <a-entity class="drive-lane" mixin="drive-lane-t1" position="2.546 0.11 -0.285" rotation="270 0 0" ></a-entity>
        <a-entity class="bike-lane" mixin="bike-lane-t1" position="4.967 0.11 -0.282" rotation="270 0 0"></a-entity>
        <a-entity class="sidewalk" mixin="sidewalk-t1" position="7.318 0.21 -0.282" rotation="270 0 0"></a-entity>
      </a-entity> -->

      <!-- <a-entity id="ford-crown-vic-bounding" geometry="depth: 5.3; height: 1.448; width: 1.99" position="0.92059 0.74 0"></a-entity>
      <a-entity id="newflyer-XD40-bounding" geometry="depth: 12; height: 3.2; width: 2.59" position="-3.97 1.59 0"></a-entity> -->

      <a-sky position="0 -140 0" rotation="0 240 0" material="fog: false;src:#sky"></a-sky>

      <a-entity id="street-parent" position="0 0 0" rotation="0 0 0">
        <a-entity id="streets"></a-entity>
      </a-entity>

      <a-entity id="buildings"></a-entity>

    </a-scene>
    <div id="intro" class="intro" >
      <div class="row">
        <div class="col-md-12"><span class="big">Streetmix3D</span></div>
      </div>
      <div class="row">
        <div class="col-md-4">&#9312; Go to <a href="//streetmix.net">Streetmix.net</a>, login with Twitter, and copy a street URL.</div>
        <div class="col-md-4">&#9313; Paste Streetmix URL here: <input id="input-url" type="text" class="form-control" onfocus="this.select();" ></div>
        <div class="col-md-4">&#9314; Press <code>enter</code> or click button: <a onclick="processURLChange()" class="btn btn-success btn-block">Load Street in 3D</a></div>
      </div>
    </div>
    <a onclick="toggle()"><div id="arrow" class="menu-overlay btn btn-outline-secondary"></div></a>

    <script>
    var toggle = function() {
      var introEl = document.getElementById("intro");
      introEl.classList.toggle("shown");
    }
    </script>

     <!--githubcorner-->
    <a href="https://github.com/kfarr/streetmix3d" class="github-corner">
      <svg width="80" height="80" viewBox="0 0 250 250" style="fill: #111; color: #EFEFEF; position: fixed; bottom: 0; border: 0; left: 0; transform: rotate(180deg); opacity: 0.8">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
      </svg>
    </a>
    <style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
    </style>

  </body>
</html>
