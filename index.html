<html>
  <head>
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-atlas-uvs-component@2.1.0/dist/aframe-atlas-uvs-component.min.js"></script>
    <script src="https://unpkg.com/aframe-orbit-controls@1.2.0/dist/aframe-orbit-controls.min.js"></script>

    <!-- <script src="js/offline/aframe.min.js"></script>
    <script src="js/offline/aframe-atlas-uvs-component.min.js"></script>
    <script src="js/offline/aframe-orbit-controls.min.js"></script> -->

    <script src="https://unpkg.com/aframe-ground-component@0.0.4/dist/aframe-ground-component.min.js"></script>
    <script src="https://unpkg.com/aframe-alongpath-component@1.0.5/dist/aframe-alongpath-component.min.js"></script>
    <script src="https://unpkg.com/aframe-curve-component@0.1.3/dist/aframe-curve-component.min.js"></script>

    <script src="js/streetmix-utils.js"></script>
    <script src="js/aframe-streetmix.js"></script>
    <script src="js/ocean-plane.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
      .rs-base {
        left: 20px;
        top: 80px;
      }
    </style>

  </head>
  <body>
    <!-- https://www.codeply.com/go/sbfCXYgqoO -->
    <nav class="navbar fixed-top navbar-expand navbar-dark bg-dark" >
        <div class="d-flex flex-grow-1">
            <a href="https://github.com/kfarr/streetmix3d/" class="navbar-brand" title="View Github README">Streetmix3D</a>
            <form class="mr-2 my-auto w-100 d-inline-block order-1">
                <div class="input-group">
                    <!-- <input type="text" class="form-control border border-right-0" placeholder="Paste Streetmix URL" /> -->
                    <input id="input-url" type="text" class="form-control d-none d-lg-block" onfocus="this.select();" title="Paste in Streetmix.net URL such as 'https://streetmix.net/kfarr/3'" />
                    <span class="input-group-append">
                        <button class="btn btn-outline-light border" type="button" onclick="processURLChange()" title="Clear Scene and Re-Render">
                            <i class="fa fa-refresh"></i>
                        </button>
                        <button class="btn btn-outline-light border" type="button" onclick="openStreetmixURL()" title="Edit Street in Streetmix2D">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button class="btn btn-outline-light border" type="button" onclick="openJSONURL()" title="View Raw Streetmix JSON">
                            <i class="fa fa-code"></i>
                        </button>
                    </span>
                </div>
            </form>
        </div>
    </nav>
    <a-scene renderer="colorManagement: true; highRefreshRate: true; foveationLevel: 3; physicallyCorrectLights: true; logarithmicDepthBuffer: false;" fogoff="type: linear; color: #D5C69B; far: 200" gltf-model="dracoDecoderPath: js/;">
      <a-assets>
        <!-- sidewalk props -->
        <a-asset-item id="treemodel3" src="assets/objects/SM_Env_Tree_03.gltf"></a-asset-item>
        <a-asset-item id="palmtreemodel" src="assets/objects/PalmTree.gltf"></a-asset-item>
        <a-asset-item id="benchmodel" src="assets/objects/SM_Prop_ParkBench_02.gltf"></a-asset-item>
        <a-asset-item id="bikerackmodel" src="assets/objects/bikerack.glb"></a-asset-item>
        <a-asset-item id="bikesharemodel" src="assets/objects/bikeshare.glb"></a-asset-item>
        <a-asset-item id="lamp-modern-glb" src="assets/objects/lamp-post-modern-centered.glb"></a-asset-item>
        <a-asset-item id="lamp-traditional-glb" src="assets/objects/lamp-post-traditional.glb"></a-asset-item>
        <a-asset-item id="bus-stop-glb" src="assets/objects/ccFO2EGGIq9-bus-stop.glb"></a-asset-item>
        <a-asset-item id="flexiguide-glb" src="assets/objects/flexiguide300.glb"></a-asset-item>

        <!-- vehicles -->
        <a-asset-item id="trammodel" src="assets/objects/tram_siemens_avenio.gltf"></a-asset-item>
        <a-asset-item id="trolleymodel" src="assets/objects/godarvilletram.gltf"></a-asset-item>
        <a-asset-item id="xd40" src="assets/objects/XD40.glb"></a-asset-item>
        <a-asset-item id="carmodel" src="assets/objects/SM_Veh_Car_Sedan_01.gltf"></a-asset-item>

        <!-- blocks -->
        <a-asset-item id="blockmodel" src="assets/objects/scenesmall2.glb"></a-asset-item>
        <a-asset-item id="fence-model" src="assets/objects/chainlink_fence_-_low_poly.glb"></a-asset-item>
        <a-asset-item id="seawall-model" src="assets/objects/seawall.gltf"></a-asset-item>

        <!-- lane objects -->
        <a-asset-item id="trackmodel" src="assets/objects/track.gltf"></a-asset-item>
        <img id="stencils-atlas" src="materials/stencils-atlas_2048.png" />

        <!-- the sky -->
        <img id="sky" position="0 -140 0" src="assets/CGSkies_0343_free_ER.jpg" />

        <!-- raw photogrammetry textures -->
        <a-mixin id="bike-lane-t0" geometry="width:1.8;height:150;primitive:plane" material="repeat:2 150;src:materials/bikelane_Base_Color.jpg;normalTextureRepeat:2 150;normalMap:materials/bikelane_Normal.jpg"></a-mixin>
        <a-mixin id="sidewalk-t0" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/sidewalkhd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/sidewalkhd_Normal.jpg;"></a-mixin>
        <a-mixin id="drive-lane-t0" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/asphalthd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/asphalthd_Normal.jpg;"></a-mixin>
        <a-mixin id="bus-lane-t0" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/asphaltred1hd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/asphaltred1hd_Normal.jpg;"></a-mixin>

        <!-- optimized textures -->
        <a-mixin id="drive-lane-t1" geometry="width:3;height:150;primitive:plane;segments-height:15" material="repeat:0.3 25;offset:0.55 0;src:materials/TexturesCom_Roads0086_1_seamless_S_rotate.jpg;"></a-mixin>
        <a-mixin id="bike-lane-t1" geometry="width:1.8;height:150;primitive:plane;segments-height:15" material="repeat:0.3 25;offset:0.55 0;roughness:1;metalness:0;src:materials/TexturesCom_Roads0086_1_seamless_S_rotate.jpg;"></a-mixin>
        <a-mixin id="sidewalk-t1" geometry="width:3;height:150;primitive:plane;segments-height:15" material="repeat:1.5 75;src:materials/TexturesCom_FloorsRegular0301_1_seamless_S.jpg;"></a-mixin>
        <a-mixin id="bus-lane-t1" geometry="width:3;height:150;primitive:plane;segments-height:15" material="repeat:0.3 25;offset:0.55 0;src:materials/TexturesCom_Roads0086_1_seamless_S_rotate.jpg;"></a-mixin>
        <a-mixin id="divider-t1" geometry="width:0.3;height:150;primitive:plane;segments-height:15" material="repeat:1 150;offset:0.415 0;normalTextureOffset:0.415 0;src:materials/hatched_Base_Color.jpg;normalTextureRepeat:0.21 150;normalMap:materials/hatched_Normal.jpg"></a-mixin>
        <a-mixin id="safehit" gltf-model="#flexiguide-glb" scale="1 1 1"></a-mixin>

        <!-- note: hex color f7d117 -->
        <!-- <a-mixin id="separators" atlas-uvs="totalRows: 4; totalColumns: 4" scale="2 2 2" material="src: #markings-atlas;alphaTest: 0;transparent:true;" geometry="primitive: plane; buffer: false; skipCache: true"></a-mixin> -->

        <a-mixin id="separator-dashed-t1" af geometry="width:0.4;height:150;primitive:plane;segments-height:15" material="repeat:0.25 25;offset:0.38 0;src:materials/separator-short-dash_1024.png;transparent: true;"></a-mixin>
        <a-mixin id="separator-solid-t1" af geometry="width:0.4;height:150;primitive:plane;segments-height:15" material="repeat:0.25 25;offset:0.38 0;src:materials/separator-solid_1024.png;transparent: true;"></a-mixin>
        <a-mixin id="separator-doubleyellow-t1" af geometry="width:0.5;height:150;primitive:plane;segments-height:15" material="repeat:0.25 25;offset:0.38 0;src:materials/separator-double-yellow_512.png;transparent: true;"></a-mixin>

        <a-mixin id="surface-green" material="color:#adff83"></a-mixin>
        <a-mixin id="surface-red" material="color:#ff9393"></a-mixin>

        <a-mixin id="stencils" atlas-uvs="totalRows: 4; totalColumns: 4" scale="2 2 2" material="src: #stencils-atlas;alphaTest: 0;transparent:true;" geometry="primitive: plane; buffer: false; skipCache: true"></a-mixin>
        <a-mixin id="right" atlas-uvs="column: 3; row: 2"></a-mixin>
        <a-mixin id="left" atlas-uvs="column: 3; row: 3"></a-mixin>
        <a-mixin id="both" atlas-uvs="column: 2; row: 1"></a-mixin>
        <a-mixin id="all" atlas-uvs="column: 3; row: 1"></a-mixin>
        <a-mixin id="left-straight" atlas-uvs="column: 2; row: 3"></a-mixin>
        <a-mixin id="right-straight" atlas-uvs="column: 2; row: 2"></a-mixin>
        <a-mixin id="straight" atlas-uvs="column: 2; row: 4"></a-mixin>
        <a-mixin id="sharrow" atlas-uvs="totalRows: 4; totalColumns: 8; column: 2; row: 3" scale="1.5 3 1"></a-mixin>
        <a-mixin id="bike-lane" af atlas-uvs="totalRows: 2; totalColumns: 8; column: 1; row: 2" scale="1 4 1"></a-mixin>

        <a-mixin id="word-bus" atlas-uvs="totalRows: 8; totalColumns: 8; column: 1; row: 4" scale="3 3 3"></a-mixin>
        <a-mixin id="word-lane" atlas-uvs="totalRows: 8; totalColumns: 8; column: 2; row: 4" scale="3 3 3"></a-mixin>
        <a-mixin id="word-taxi" atlas-uvs="totalRows: 8; totalColumns: 8; column: 1; row: 3" scale="3 3 3"></a-mixin>
        <a-mixin id="word-only" atlas-uvs="totalRows: 8; totalColumns: 8; column: 2; row: 3" scale="3 3 3"></a-mixin>

        <a-mixin id="word-yield" atlas-uvs="totalRows: 8; totalColumns: 8; column: 1; row: 2" scale="3 3 3"></a-mixin>
        <a-mixin id="word-slow" atlas-uvs="totalRows: 8; totalColumns: 8; column: 2; row: 2" scale="3 3 3"></a-mixin>
        <a-mixin id="word-xing" atlas-uvs="totalRows: 8; totalColumns: 8; column: 1; row: 1" scale="3 3 3"></a-mixin>
        <a-mixin id="word-stop" atlas-uvs="totalRows: 8; totalColumns: 8; column: 2; row: 1" scale="3 3 3"></a-mixin>

        <a-mixin id="perpendicular-stalls" atlas-uvs="totalRows: 4; totalColumns: 8; column: 5; row: 4" scale="5 10 5"></a-mixin>

        <a-mixin id="parking-delimiter" atlas-uvs="totalRows: 8; totalColumns: 8; column: 2; row: 7" scale="1.8 1.8 1.8"></a-mixin>

        <a-mixin id="bus" gltf-model="#xd40" scale="1.55 1.55 1.55"></a-mixin>
        <a-mixin id="car" gltf-model="#carmodel"></a-mixin>
        <a-mixin id="tree3" gltf-model="#treemodel3" scale="1.25 1.25 1.25"></a-mixin>
        <a-mixin id="palm-tree" gltf-model="#palmtreemodel" scale="1 1.5 1"></a-mixin>
        <a-mixin id="bench" gltf-model="#benchmodel" scale="1 1 1"></a-mixin>
        <a-mixin id="track" gltf-model="#trackmodel" scale="1 1 1"></a-mixin>
        <a-mixin id="tram" gltf-model="#trammodel" scale="1 1 1"></a-mixin>
        <a-mixin id="trolley" gltf-model="#trolleymodel" scale="1 1 1"></a-mixin>
        <a-mixin id="block" gltf-model="#blockmodel" scale="1 1 1"></a-mixin>
        <a-mixin id="seawall" gltf-model="#seawall-model" scale="1 1 1" rotation="0 0 0"></a-mixin>

        <a-mixin id="bikerack" gltf-model="#bikerackmodel" scale="0.25 0.25 0.25"></a-mixin>
        <a-mixin id="bikeshare" gltf-model="#bikesharemodel" scale="1 1 1"></a-mixin>

        <a-mixin id="bus-shadow" geometry="width: 12; height: 3; primitive: plane"  material="src: url(materials/bus-shadow.png); alphaTest: 0;transparent:true; roughness: 1;" ></a-mixin>
        <a-mixin id="car-shadow" geometry="width: 4.7; height: 2.5; primitive: plane"  material="src: url(materials/bus-shadow.png); alphaTest: 0;transparent:true; roughness: 1;" ></a-mixin>

        <a-mixin id="lamp-modern" gltf-model="#lamp-modern-glb" scale="0.5 0.5 0.5"></a-mixin>
        <a-mixin id="lamp-traditional" gltf-model="#lamp-traditional-glb" scale="0.2 0.2 0.2" ></a-mixin>
        <a-mixin id="pride-flag" position="0.409 3.345 0" rotation="0 0 0" scale="0.5 0.75 0" geometry="width:2;height:2;primitive:plane" material="side:double; src:materials/rainbow-flag-poles_512.png;transparent: true;"></a-mixin>

        <a-mixin id="bus-stop" gltf-model="#bus-stop-glb" rotation="-90 0 0" scale="0.001 0.001 0.001" ></a-mixin>

        <a-mixin id="fence" gltf-model="#fence-model" scale="0.1 0.1 0.1"></a-mixin>

        <image id="subtitle" src="materials/subtitle.png" />
      </a-assets>

      <a-entity light="type: ambient; color: #FFF; intensity: 2"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="0.5 1 -1"></a-entity>
      <a-ocean-plane height="100" width="100" position="0 -1 0" material="sphericalEnvMap: #sky;">
         <!-- <a-animation attribute="position" to="0 0 100" dur="2500" repeat="indefinitely" easing="linear"></a-animation> -->
      </a-ocean-plane>

      <a-entity id="cam-parent">
        <a-entity id="camera" camera wasd-controls="enabled: false" orbit-controls="autoRotate: true;autoRotateSpeed:0.01;target: 0 0 0;initialPosition:0 4 15;minDistance:3;maxDistance:100;enableKeys:false"></a-entity>
      </a-entity>

      <!-- Label text -->
      <!-- <a-entity position="0 2 0" geometry="primitive: plane; width: 10; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                text="color: yellow; align: left; value: San Francisco; width: 10; ">
        <a-entity position="-5.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.46" material="color: white;"></a-entity>
      </a-entity>
      <a-entity position="5 1 0" geometry="primitive: plane; width: 20; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                text="color: yellow; align: left; value: Harrison Street; width: 20; ">
        <a-entity position="-10.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.92" material="color: white;"></a-entity>
      </a-entity> -->

      <!-- static entities for debugging textures without parsing json -->
      <!-- <a-entity id="static-textured" position="0 0.1 0">
        <a-entity class="sidewalk" mixin="sidewalk-t1" position="-5.521 0.21 -0.282" rotation="270 0 0"></a-entity>
        <a-entity class="bike-lane" mixin="bike-lane-t1" position="-3.17 0.11 -0.282" rotation="270 0 0"> </a-entity>
        <a-entity class="separator-dashed" mixin="separator-dashed-t1" position="-2.1 0.12 -0.282" rotation="270 0 0"> </a-entity>
        <a-entity class="drive-lane" mixin="drive-lane-t1" position="-0.776 0.11 -0.285" rotation="270 0 0" ></a-entity>
        <a-entity class="divider" mixin="divider-t1" position="0.869 0.11 -0.282" rotation="270 0 0" ></a-entity>
        <a-entity class="drive-lane" mixin="drive-lane-t1" position="2.546 0.11 -0.285" rotation="270 0 0" ></a-entity>
        <a-entity class="bike-lane" mixin="bike-lane-t1" position="4.967 0.11 -0.282" rotation="270 0 0"></a-entity>
        <a-entity class="sidewalk" mixin="sidewalk-t1" position="7.318 0.21 -0.282" rotation="270 0 0"></a-entity>
      </a-entity> -->

      <!-- bounding boxes based on vehicle specs available online -->
      <!-- <a-entity id="ford-crown-vic-bounding" geometry="depth: 5.3; height: 1.448; width: 1.99" position="0.92059 0.74 0"></a-entity>
      <a-entity id="newflyer-XD40-bounding" geometry="depth: 12; height: 3.2; width: 2.59" position="-3.97 1.59 0"></a-entity>
      <a-entity id="siemens-avenio-bounding" geometry="depth: 30; height: 3.4; width: 2.65" position="8.8 1.7 0"></a-entity> -->

      <a-sky position="0 0 0" rotation="0 240 0" material="fog: false;src:#sky"></a-sky>

      <a-entity id="street-parent" position="0 0 0" rotation="0 0 0">
        <a-entity id="streets"></a-entity>
      </a-entity>

      <!-- <a-entity id="bus-stop-instance1" mixin="bus-stop"></a-entity> -->
      <!-- <a-entity id="tram-instance1" mixin="tram" position="8.8 0 0"></a-entity> -->
      <!-- <a-entity id="trolley-instance1" mixin="trolley" position="8.8 0 0"></a-entity> -->

      <a-entity id="buildings"></a-entity>
      <!-- <a-entity id="blockinstance" mixin="block" position="-10.7 0 10" rotation="0 -90 0"></a-entity> -->

    </a-scene>
  </body>
</html>
