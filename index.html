<html>
  <head>
    <script src="https://aframe.io/releases/0.7.1/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-sun-sky@^3.0.3/dist/aframe-sun-sky.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.5.0/velocity.js"></script>
    <script src="https://unpkg.com/aframe-orbit-controls@1.2.0/dist/aframe-orbit-controls.min.js"></script>

    <script src="js/aframe-streetmix.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>
    .intro {
      z-index: 1;
      position: absolute;
      top: 1vw;
      left: 1vw;
      width: 98vw;
      font-size: 150%;
      box-sizing: border-box;
      padding: 0.75rem;
      color: #FFF;
      background: rgba(0, 0, 0, 0.75);
      font-family: Source Sans Pro, Helvetica Neue, Helvetica, Arial, sans-serif;
    }
    .row {
      padding: 0.75rem;
    }
    .big {
      font-size: 125%;
      font-weight: bold;
    }
    .menu-overlay {
      z-index: 99999;
      position: fixed;
      top: 15px;
      right: 15px;
      box-sizing: border-box;
      padding: 1.5em;
      width: 50px;
      height: 50px;
      padding-bottom: 0px;
      background: rgba(0, 0, 0, 0.5) url(./assets/white-arrow.png) center no-repeat;
      background-size: 40px 40px;
      font-family: Source Sans Pro, Helvetica Neue, Helvetica, Arial, sans-serif;
    }
    .menu-overlay:hover {
      background: rgba(0, 0, 0, 0.2) url(./assets/white-arrow.png) center no-repeat;
      background-size: 40px 40px;
    }
    </style>

  </head>
  <body>
    <a-scene fog="type: linear; color: #dae4e4; far: 100" >
      <a-assets>
        <!-- MagicaVoxel objects -->
        <a-asset-item id="bike-lane-obj" src="assets/segments/bike-lane.obj"></a-asset-item>
        <a-asset-item id="bus-lane-obj" src="assets/segments/bus-lane.obj"></a-asset-item>
        <a-asset-item id="divider-bollard-obj" src="assets/segments/divider-bollard.obj"></a-asset-item>
        <a-asset-item id="divider-obj" src="assets/segments/divider.obj"></a-asset-item>
        <a-asset-item id="drive-lane-sharrow-obj" src="assets/segments/drive-lane-sharrow.obj"></a-asset-item>
        <a-asset-item id="drive-lane-obj" src="assets/segments/drive-lane.obj"></a-asset-item>
        <a-asset-item id="light-rail-obj" src="assets/segments/light-rail.obj"></a-asset-item>
        <a-asset-item id="parking-lane-obj" src="assets/segments/parking-lane.obj"></a-asset-item>
        <a-asset-item id="sidewalk-obj" src="assets/segments/sidewalk.obj"></a-asset-item>
        <a-asset-item id="turn-lane-both-obj" src="assets/segments/turn-lane-both.obj"></a-asset-item>
        <a-asset-item id="turn-lane-left-straight-obj" src="assets/segments/turn-lane-left-straight.obj"></a-asset-item>
        <a-asset-item id="turn-lane-left-obj" src="assets/segments/turn-lane-left.obj"></a-asset-item>
        <a-asset-item id="turn-lane-shared-obj" src="assets/segments/turn-lane-shared.obj"></a-asset-item>
        <a-asset-item id="turn-lane-straight-obj" src="assets/segments/turn-lane-straight.obj"></a-asset-item>

        <a-asset-item id="magica-mtl" src="assets/segments/magica.mtl"></a-asset-item>

        <a-asset-item id="pylon-obj" src="assets/objects/nyc-wayfinding-pylon-large-nomtl.obj"></a-asset-item>
        <!-- <a-asset-item id="pylon-mtl" src="assets/objects/nyc-wayfinding-pylon-large.mtl"></a-asset-item> -->

        <!-- Downloaded objects -->
        <a-asset-item id="palmtree2-obj" src="assets/objects/SPW_Natures_Tree_Palm_02.obj"></a-asset-item>
        <a-asset-item id="palmtree3-obj" src="assets/objects/SPW_Natures_Tree_Palm_03.obj"></a-asset-item>
        <a-asset-item id="SPW_Natures_01" src="assets/objects/SPW_Natures_01.mtl"></a-asset-item>
        <a-asset-item id="streetlight1-obj" src="assets/objects/SPW_Urban_Road Props_Street Light_01.obj"></a-asset-item>
        <a-asset-item id="streetlight2-obj" src="assets/objects/SPW_Urban_Road Props_Street Light_02.obj"></a-asset-item>
        <a-asset-item id="SPW_Urban_Road_Props_01" src="assets/objects/SPW_Urban_Road_Props_01.mtl"></a-asset-item>

        <image id="wayfinding" src="assets/objects/wayfinding.jpg" />

        <a-mixin id="bike-lane-vox" obj-model="obj:#bike-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="bus-lane-vox" obj-model="obj:#bus-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="divider-bollard-vox" obj-model="obj:#divider-bollard-obj;mtl:#magica-mtl" ></a-mixin>
        <a-mixin id="divider-vox" obj-model="obj:#divider-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="drive-lane-sharrow-vox" obj-model="obj:#drive-lane-sharrow;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="drive-lane-vox" obj-model="obj:#drive-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="light-rail-vox" obj-model="obj:#light-rail-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="parking-lane-vox" obj-model="obj:#parking-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="sidewalk-vox" obj-model="obj:#sidewalk-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="parking-lane-vox" obj-model="obj:#parking-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-both-vox" obj-model="obj:#turn-lane-both-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-left-straight-vox" obj-model="obj:#turn-lane-left-straight-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-left-vox" obj-model="obj:#turn-lane-left-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-shared-vox" obj-model="obj:#turn-lane-shared-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-straight-vox" obj-model="obj:#turn-lane-straight-obj;mtl:#magica-mtl"></a-mixin>

      </a-assets>
      <a-entity wasd-controls id="camera" orbit-controls="target: 0 0 0;initialPosition:0 2 5;minDistance:3;maxDistance:100;"></a-entity>

      <!-- <a-entity id="street-static">
        <a-entity id="bike-lane" scale="0.1 0.1 0.1" position="0 0 -1" rotation="0 0 0" obj-model="obj:#bike-lane-obj; mtl:#magica-mtl"></a-entity>
        <a-entity id="palmtree2" scale="0.005 0.005 0.005" position="0 0 -1" rotation="0 0 0" obj-model="obj:#palmtree2-obj; mtl:#SPW_Natures_01"></a-entity>
        <a-entity id="palmtree3" scale="0.005 0.005 0.005" position="0 0 0" rotation="0 0 0" obj-model="obj:#palmtree3-obj; mtl:#SPW_Natures_01"></a-entity>
        <a-entity id="streetlight1" scale="0.01 0.01 0.01" position="0 0 -1" rotation="0 0 0" obj-model="obj:#streetlight1-obj; mtl:#SPW_Urban_Road_Props_01"></a-entity>
        <a-entity id="streetlight2" scale="0.01 0.01 0.01" position="0 0 0" rotation="0 0 0" obj-model="obj:#streetlight2-obj; mtl:#SPW_Urban_Road_Props_01"></a-entity>
      </a-entity> -->
      <a-entity id="clouds" position="0 35 0" scale="7 7 7" geometry="height:7.74;radius:14;primitive:cylinder;openEnded:true" material="side:back; src:url(assets/clouds.png); transparent: true; repeat: 16; opacity: 0.4"></a-entity>

      <!-- WAYFINDING TESTING -->

      <!-- wayfinding sign using Carson's object, custom material, the backside of the sign is reversed
           this is the code used in javascript to show at every block -->
      <!-- <a-entity class="wayfinding-obj" scale="0.1 0.13 0.1" position="0 0 -1" rotation="0 270 0" obj-model="obj:#pylon-obj;" material="src:#wayfinding; side:double;"></a-entity> -->

      <!-- wayfinding sign added by a box geometry primitive, texture is visible on all sides, including squished the sides / deepth -->
      <!-- <a-entity class="wayfinding-geo" geometry="primitive: box; width: 0.8; height: 2.2; depth: 0.05" position="3 1.1 -1" material="src:#wayfinding; side:double;"></a-entity> -->

    <!-- END WAYFINDING TESTING -->

      <a-entity id="streets" position="-7 0 -12">
        <a-entity id="street0"></a-entity>
        <a-entity id="street1" position="0 0 -12.5"></a-entity>
        <a-entity id="street2" position="0 0 -25"></a-entity>
        <a-entity id="street3" position="0 0 -37.5"></a-entity>
        <a-entity id="street4" position="0 0 -50"></a-entity>
        <a-entity id="street5" position="0 0 -62.5"></a-entity>
        <a-entity id="street6" position="0 0 -75"></a-entity>

        <a-entity id="street-1" position="0 0 12.5"></a-entity>
        <a-entity id="street-2" position="0 0 25"></a-entity>
        <a-entity id="street-3" position="0 0 37.5"></a-entity>
        <a-entity id="street-4" position="0 0 50"></a-entity>
        <a-entity id="street-5" position="0 0 62.5"></a-entity>
        <a-entity id="street-6" position="0 0 75"></a-entity>

      </a-entity>
      <a-sun-sky material="sunPosition: -0.2 7.5 -5; fog: false"></a-sun-sky>
      <!-- <a-sky color="#caf9ff" material="fog: false"></a-sky> -->
    </a-scene>
    <div id="intro" class="intro">
      <div class="row">
        <div class="col-md-12"><span class="big">Streetmix3D</span></div>
      </div>
      <div class="row">
        <div class="col-md-4">&#9312; Go to <a href="//streetmix.net">Streetmix.net</a>, login with Twitter, and copy a street URL.</div>
        <div class="col-md-4">&#9313; Paste Streetmix URL here: <input id="input-url" type="text" class="form-control" onfocus="this.select();" ></div>
        <div class="col-md-4">&#9314; Press <code>enter</code> or click button: <a onclick="processURLChange()" class="btn btn-success btn-block">Load Street in 3D</a></div>
      </div>
    </div>
    <a onclick="toggle()"><div id="arrow" class="menu-overlay btn btn-outline-secondary"></div></a>

    <script>
    var toggle = function() {
      var introEl = document.getElementById("intro");
      var introOpacity = window.getComputedStyle(introEl,null).getPropertyValue("opacity");
      var newOpacity = introOpacity == 1 ? 0 : 1;
      Velocity(document.getElementById("intro"), { opacity: newOpacity }, { duration: 250 });
      Velocity(document.getElementById("arrow"), { rotateZ: "+=180deg" }, { duration: 250 });

    }
    </script>

     <!--githubcorner-->
    <a href="https://github.com/kfarr/streetmix3d" class="github-corner">
      <svg width="80" height="80" viewBox="0 0 250 250" style="fill: #111; color: #EFEFEF; position: fixed; bottom: 0; border: 0; left: 0; transform: rotate(180deg); opacity: 0.8">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
      </svg>
    </a>
    <style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
    </style>

  </body>
</html>
