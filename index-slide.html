<html>
  <head>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-sun-sky@^3.0.3/dist/aframe-sun-sky.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.5.0/velocity.js"></script>
    <script src="https://unpkg.com/aframe-orbit-controls@1.2.0/dist/aframe-orbit-controls.min.js"></script>
    <script src="https://unpkg.com/three-geo@1.2.5/dist/three-geo.min.js"></script>

    <script src="https://unpkg.com/swiper/js/swiper.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper/css/swiper.css">

    <script src="aframe-streetmix.js"></script>
    <script src="three-geo.js"></script>
    <script src="aframe-presentation-component.js"></script>

    <!-- Swiper styles -->
    <style>

    .bgcanvas {
      z-index: -1;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .swiper-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        margin-left: auto;
        margin-right: auto;
    }
    .swiper-slide {
        text-align: center;
        color: white;
        text-shadow: 4px 4px 8px #000000;
        font-size: 72px;
        font-style: italic;
        font-weight: bold;

        /* Center slide text vertically */
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: flex-end;
        -ms-flex-align: flex-end;
        -webkit-align-items: flex-end;
        align-items: flex-end;
    }
    .instructions {
      font-size: 28;
      font-style: normal;
      font-weight: normal;
    }

    #cover-spin {
        position:fixed;
        width:100%;
        left:0;right:0;top:0;bottom:0;
        background-color: rgba(36,202,255,0.7);
        z-index:999999999;
    }

    @-webkit-keyframes spin {
    	from {-webkit-transform:rotate(0deg);}
    	to {-webkit-transform:rotate(360deg);}
    }

    @keyframes spin {
    	from {transform:rotate(0deg);}
    	to {transform:rotate(360deg);}
    }

    #cover-spin::after {
        content:'';
        display:block;
        position:absolute;
        left:48%;top:40%;
        width:40px;height:40px;
        border-style:solid;
        border-color:yellow;
        border-top-color:transparent;
        border-width: 4px;
        border-radius:50%;
        -webkit-animation: spin .8s linear infinite;
        animation: spin .8s linear infinite;
    }

    </style>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>

    html {
      height: 100%;
    }

    .intro {
      z-index: 1;
      position: absolute;
      top: 1vw;
      left: 1vw;
      width: 98vw;
      font-size: 150%;
      box-sizing: border-box;
      padding: 0.75rem;
      color: #FFF;
      background: rgba(0, 0, 0, 0.75);
      font-family: Source Sans Pro, Helvetica Neue, Helvetica, Arial, sans-serif;
    }
    .row {
      padding: 0.75rem;
    }
    .big {
      font-size: 125%;
      font-weight: bold;
    }
    .menu-overlay {
      z-index: 99999;
      position: fixed;
      top: 15px;
      right: 15px;
      box-sizing: border-box;
      padding: 1.5em;
      width: 50px;
      height: 50px;
      padding-bottom: 0px;
      background: rgba(0, 0, 0, 0.5) url(./assets/white-arrow.png) center no-repeat;
      background-size: 40px 40px;
      font-family: Source Sans Pro, Helvetica Neue, Helvetica, Arial, sans-serif;
    }
    .menu-overlay:hover {
      background: rgba(0, 0, 0, 0.2) url(./assets/white-arrow.png) center no-repeat;
      background-size: 40px 40px;
    }
    </style>

  </head>
  <body>

    <a-scene canvas="#canvas" vr-mode-ui="enabled: false" fogoff="type: linear; color: #fffbcd; far: 200" >
      <a-assets>
        <a-asset-item id="15harrison" src="assets/15harrison/out-recap-sketchfab.glb"></a-asset-item>
        <!-- <a-asset-item id="harrison-obj" src="assets/model_37.7673477_-122.4136603/raw_export/model.obj"></a-asset-item>
        <a-asset-item id="harrison-mtl" src="assets/model_37.7673477_-122.4136603/raw_export/model.mtl"></a-asset-item> -->

        <!-- MagicaVoxel objects -->
        <a-asset-item id="bike-lane-obj" src="assets/segments/bike-lane.obj"></a-asset-item>
        <a-asset-item id="bus-lane-obj" src="assets/segments/bus-lane.obj"></a-asset-item>
        <a-asset-item id="divider-bollard-obj" src="assets/segments/divider-bollard.obj"></a-asset-item>
        <a-asset-item id="divider-obj" src="assets/segments/divider.obj"></a-asset-item>
        <a-asset-item id="drive-lane-sharrow-obj" src="assets/segments/drive-lane-sharrow.obj"></a-asset-item>
        <a-asset-item id="drive-lane-obj" src="assets/segments/drive-lane.obj"></a-asset-item>
        <a-asset-item id="light-rail-obj" src="assets/segments/light-rail.obj"></a-asset-item>
        <a-asset-item id="parking-lane-obj" src="assets/segments/parking-lane.obj"></a-asset-item>
        <a-asset-item id="sidewalk-obj" src="assets/segments/sidewalk.obj"></a-asset-item>
        <a-asset-item id="turn-lane-both-obj" src="assets/segments/turn-lane-both.obj"></a-asset-item>
        <a-asset-item id="turn-lane-left-straight-obj" src="assets/segments/turn-lane-left-straight.obj"></a-asset-item>
        <a-asset-item id="turn-lane-left-obj" src="assets/segments/turn-lane-left.obj"></a-asset-item>
        <a-asset-item id="turn-lane-shared-obj" src="assets/segments/turn-lane-shared.obj"></a-asset-item>
        <a-asset-item id="turn-lane-straight-obj" src="assets/segments/turn-lane-straight.obj"></a-asset-item>

        <a-asset-item id="magica-mtl" src="assets/segments/magica.mtl"></a-asset-item>

        <a-asset-item id="pylon-obj" src="assets/objects/nyc-wayfinding-pylon-large-nomtl.obj"></a-asset-item>
        <!-- <a-asset-item id="pylon-mtl" src="assets/objects/nyc-wayfinding-pylon-large.mtl"></a-asset-item> -->

        <!-- Unused objects what do they look like? -->
        <a-asset-item id="palmtree2-obj" src="assets/objects/SPW_Natures_Tree_Palm_02.obj"></a-asset-item>
        <a-asset-item id="palmtree3-obj" src="assets/objects/SPW_Natures_Tree_Palm_03.obj"></a-asset-item>
        <a-asset-item id="SPW_Natures_01" src="assets/objects/SPW_Natures_01.mtl"></a-asset-item>
        <a-asset-item id="streetlight1-obj" src="assets/objects/SPW_Urban_Road Props_Street Light_01.obj"></a-asset-item>
        <a-asset-item id="streetlight2-obj" src="assets/objects/SPW_Urban_Road Props_Street Light_02.obj"></a-asset-item>
        <a-asset-item id="SPW_Urban_Road_Props_01" src="assets/objects/SPW_Urban_Road_Props_01.mtl"></a-asset-item>

        <image id="wayfinding" src="assets/objects/wayfinding.jpg" />
        <image id="sky" src="assets/CGSkies_0343_8k_ERextended.jpg" />

        <a-mixin id="bike-lane-vox" obj-model="obj:#bike-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="bus-lane-vox" obj-model="obj:#bus-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="divider-bollard-vox" obj-model="obj:#divider-bollard-obj;mtl:#magica-mtl" ></a-mixin>
        <a-mixin id="divider-vox" obj-model="obj:#divider-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="drive-lane-sharrow-vox" obj-model="obj:#drive-lane-sharrow;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="drive-lane-vox" obj-model="obj:#drive-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="light-rail-vox" obj-model="obj:#light-rail-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="parking-lane-vox" obj-model="obj:#parking-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="sidewalk-vox" obj-model="obj:#sidewalk-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="parking-lane-vox" obj-model="obj:#parking-lane-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-both-vox" obj-model="obj:#turn-lane-both-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-left-straight-vox" obj-model="obj:#turn-lane-left-straight-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-left-vox" obj-model="obj:#turn-lane-left-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-shared-vox" obj-model="obj:#turn-lane-shared-obj;mtl:#magica-mtl"></a-mixin>
        <a-mixin id="turn-lane-straight-vox" obj-model="obj:#turn-lane-straight-obj;mtl:#magica-mtl"></a-mixin>

        <a-mixin id="drive-lane-t1" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/asphalthd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/asphalthd_Normal.jpg;"></a-mixin>
        <a-mixin id="bike-lane-t1" geometry="width:1.8;height:150;primitive:plane" material="repeat:2 150;src:materials/bikelane_Base_Color.jpg;normalTextureRepeat:2 150;normalMap:materials/bikelane_Normal.jpg"></a-mixin>
        <a-mixin id="divider-t1" geometry="width:0.3;height:150;primitive:plane" material="repeat:0.21 150;offset:0.415 0;normalTextureOffset:0.415 0;src:materials/double_yellow1__Base_Color.jpg;normalTextureRepeat:0.21 150;normalMap:materials/double_yellow1__Normal.jpg"></a-mixin>
        <a-mixin id="sidewalk-t1" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/sidewalkhd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/sidewalkhd_Normal.jpg;"></a-mixin>

        <a-mixin id="asphalt1" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/asphalthd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/asphalthd_Normal.jpg;"></a-mixin>
        <a-mixin id="asphaltbike1" geometry="width:1.8;height:150;primitive:plane" material="repeat:2 150;src:materials/bikelane_Base_Color.jpg;normalTextureRepeat:2 150;normalMap:materials/bikelane_Normal.jpg"></a-mixin>
        <a-mixin id="divider1" geometry="width:0.3;height:150;primitive:plane" material="repeat:0.21 150;offset:0.415 0;normalTextureOffset:0.415 0;src:materials/double_yellow1__Base_Color.jpg;normalTextureRepeat:0.21 150;normalMap:materials/double_yellow1__Normal.jpg"></a-mixin>
        <a-mixin id="sidewalk1" geometry="width:3;height:150;primitive:plane" material="repeat:1.5 75;src:materials/sidewalkhd_Base_Color.jpg;normalTextureRepeat:1.5 75;normalMap:materials/sidewalkhd_Normal.jpg;"></a-mixin>

        <image id="subtitle" src="materials/subtitle.png" />


      </a-assets>

      <a-entity id="rig">
        <!-- <a-entity id="camera" camera> -->
        <a-entity id="camera" orbit-controls="enableKeys: false; target: 0 0 0;initialPosition:0 2 5;minDistance:3;maxDistance:100;enableRotate:false;"></a-entity>
      </a-entity>

      <a-sky position="0 -140 0" rotation="0 155 0" material="fog: false;src:#sky"></a-sky>

      <a-entity id="streetscan" gltf-model="#15harrison" scale="0.19 0.19 0.19" rotation="0 93.310 0" position="-1.978 4.890 0.301" visible="false"></a-entity>

      <a-entity id="streets" position="11.889 0.1 -1.386" rotation="0 184.3 0" visible="false">
        <a-entity id="street0"></a-entity>
        <a-entity id="street1" position="0 0 -12.5"></a-entity>
        <a-entity id="street2" position="0 0 -25"></a-entity>
        <a-entity id="street3" position="0 0 -37.5"></a-entity>
        <a-entity id="street4" position="0 0 -50"></a-entity>
        <a-entity id="street5" position="0 0 -62.5"></a-entity>
        <a-entity id="street6" position="0 0 -75"></a-entity>

        <a-entity id="street-1" position="0 0 12.5"></a-entity>
        <a-entity id="street-2" position="0 0 25"></a-entity>
        <a-entity id="street-3" position="0 0 37.5"></a-entity>
        <a-entity id="street-4" position="0 0 50"></a-entity>
        <a-entity id="street-5" position="0 0 62.5"></a-entity>
        <a-entity id="street-6" position="0 0 75"></a-entity>
      </a-entity>

      <a-entity id="hoodmap" scale="750 1 750" position="0 -2 0"
        animation_opacity="from: 1; to:0;">

        <a-entity three-geo="token: pk.eyJ1Ijoia2llcmFuZmFyciIsImEiOiJjazB0NWh2YncwOW9rM25sd2p0YTlxemk2In0.mLl4sNGDFbz_QXk0GIK02Q;
                     lat: 37.767548;
                     lng: -122.413335;
                     radius: 0.5;
                     zoom: 19;
                     axes_on: false;
                     spinner: #cover-spin"
                rotation="-90 0 0"></a-entity>

        <a-entity geometry="primitive: plane" material="color: #24CAFF; shader: flat;" position="0 -10 0" rotation="-90 0 0"></a-entity>
      </a-entity>

      <a-entity id="lower-third" position="2.1 245 5" rotation="-90 0 0">
        <a-entity position="5 1 0" geometry="primitive: plane; width: 20; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                  text="color: yellow; align: left; value: Mission District; width: 20; ">
          <a-entity position="-10.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.92" material="color: white;"></a-entity>
        </a-entity>
        <a-entity position="0 0 0" geometry="primitive: plane; width: 10; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                  text="color: yellow; align: left; value: San Francisco; width: 10; ">
          <a-entity position="-5.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.46" material="color: white;"></a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="lower-third-2" position="-37.634 11 -4.256" rotation="-180 90 180">
        <a-entity position="5 1 0" geometry="primitive: plane; width: 20; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                  text="color: yellow; align: left; value: Harrison St; width: 20; ">
          <a-entity position="-10.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.92" material="color: white;"></a-entity>
        </a-entity>
        <a-entity position="0 0 0" geometry="primitive: plane; width: 10; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                  text="color: yellow; align: left; value: 15th to Alameda St; width: 10; ">
          <a-entity position="-5.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.46" material="color: white;"></a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="lower-third-3" position="-2 38 -4" rotation="-90 0 -180">
        <a-entity position="5 1 0" geometry="primitive: plane; width: 20; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                  text="color: red; align: left; value: 40% ; width: 20; ">
          <a-entity position="-10.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.92" material="color: white;"></a-entity>
        </a-entity>
        <a-entity position="0 0 0" geometry="primitive: plane; width: 10; height: auto" material="src: #subtitle; alphaTest: 0.; transparent: true;"
                  text="color: yellow; align: left; value: Transit First Score; width: 10; ">
          <a-entity position="-5.1 0 0.001" geometry="primitive: plane; width: 0.1; height: 0.46" material="color: white;"></a-entity>
        </a-entity>
      </a-entity>

      <a-presentation id="presentation" presentation-camera="#camera" presentation-keyboard-shortcuts="false" use-hash="false">
        <a-presentation-slide camera-position="0.5 250 1" camera-duration="2500" easing="easeInOutSine"  ></a-presentation-slide>
        <a-presentation-slide camera-position="-42.634 12.735 -13.256" show-entities="#streetscan" camera-duration="2500" easing="easeInOutSine" ></a-presentation-slide>
        <a-presentation-slide camera-position="-0.1 43 -7" hide-entities="#hoodmap" show-entities="#streets" camera-duration="2500" easing="easeInOutSine" ></a-presentation-slide>
        <a-presentation-slide camera-position="6 3 0" hide-entities="#streetscan" camera-duration="2500" easing="easeInOutSine" ></a-presentation-slide>

        <!-- <a-presentation-slide camera-duration="5000" easing="easeInOutSine" camera-position="0.5 250 1" camera-rotation="-88.63607246839707 0.11364974403152148 4.762288908833026"></a-presentation-slide>
        <a-presentation-slide camera-duration="5000" easing="easeInOutSine" camera-position="-42.634 12.735 -13.256" camera-rotation="0 -102 0"></a-presentation-slide>
        <a-presentation-slide camera-duration="5000" easing="easeInOutSine" camera-position="-0.1 43 -7" camera-rotation="-92.54480437981309 -0.1271981794462486 -177.14042000677006"></a-presentation-slide>
        <a-presentation-slide camera-duration="5000" easing="easeInOutSine" camera-position="6 3 0" camera-rotation="0 -180 0" camera-duration="2500"></a-presentation-slide> -->

      </a-presentation>

    </a-scene>



    <div id="bgcanvas">
      <canvas id="canvas"></canvas>
    </div>
    <!-- <div id="cover-spin"></div> -->
      <!-- Swiper -->
      <div class="swiper-container">
          <div class="swiper-wrapper">
              <div class="swiper-slide">
                <div class="text-wrapper">
                  <p>region</p>
                  <p class="instructions">swipe ☝️ or press ⬇️ key</p>
              </div>
            </div>
              <div class="swiper-slide">street</div>
              <div class="swiper-slide">current</div>
              <div class="swiper-slide">streetview</div>
              <!-- <div class="swiper-slide">Alternate 1</div>
              <div class="swiper-slide">Alternate 2</div>
              <div class="swiper-slide">3D Alt 1</div>
              <div class="swiper-slide">3D Alt 2</div>
              <div class="swiper-slide">Slide 9</div>
              <div class="swiper-slide">Slide 10</div> -->
          </div>
          <!-- Add Pagination -->
          <!-- <div class="swiper-pagination"></div> -->
          <!-- Add Arrows -->
          <!-- <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div> -->
      </div>

    <div id="intro" class="intro" style="opacity: 0;">
      <div class="row">
        <div class="col-md-12"><span class="big">Streetmix3D</span></div>
      </div>
      <div class="row">
        <div class="col-md-4">&#9312; Go to <a href="//streetmix.net">Streetmix.net</a>, login with Twitter, and copy a street URL.</div>
        <div class="col-md-4">&#9313; Paste Streetmix URL here: <input id="input-url" type="text" class="form-control" onfocus="this.select();" ></div>
        <div class="col-md-4">&#9314; Press <code>enter</code> or click button: <a onclick="processURLChange()" class="btn btn-success btn-block">Load Street in 3D</a></div>
      </div>
    </div>
    <a onclick="toggle()"><div id="arrow" style="rotateZ: 180;" class="menu-overlay btn btn-outline-secondary"></div></a>

    <script>
    var toggle = function() {
      var introEl = document.getElementById("intro");
      var introOpacity = window.getComputedStyle(introEl,null).getPropertyValue("opacity");
      var newOpacity = introOpacity == 1 ? 0 : 1;
      Velocity(document.getElementById("intro"), { opacity: newOpacity }, { duration: 250 });
      Velocity(document.getElementById("arrow"), { rotateZ: "+=180deg" }, { duration: 250 });
    }
    </script>

    <!-- Initialize Swiper -->
    <script>
    var swiper = new Swiper('.swiper-container', {
        direction: 'vertical',
        slidesPerView: 1,
        spaceBetween: 30,
        mousewheel: true,
        keyboard: {
          enabled: true,
        },
    });

    swiper.on('slideChange', function () {
          var dir = swiper.realIndex - swiper.previousIndex;
          if (dir == 1) {
            document.getElementById("presentation").components['presentation'].nextSlide();
          }
          if (dir == -1) {
            document.getElementById("presentation").components['presentation'].previousSlide();
          }
    });

    </script>

  </body>
</html>
