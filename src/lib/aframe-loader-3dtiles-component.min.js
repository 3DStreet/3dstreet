/*! For license information please see aframe-loader-3dtiles-component.min.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("THREE"));else if("function"==typeof define&&define.amd)define(["THREE"],e);else{var n="object"==typeof exports?e(require("THREE")):e(t.THREE);for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(this,(t=>(()=>{var e={384:()=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("textarea",{schema:{transparentBG:{type:"boolean",default:!1},cols:{type:"int",default:40},rows:{type:"int",default:20},color:{type:"color",default:"black"},backgroundColor:{type:"color",default:"white"},disabledBackgroundColor:{type:"color",default:"lightgrey"},disabled:{type:"boolean",default:!1},text:{type:"string",default:""}},init:function(){this.text=null,this.lines=[],this.lastBlink=0,this.blinkEnabled=!this.data.disabled,this.charWidth=this.charHeight=null,this.selectionStart=this.selectionEnd=0,this.endIndexInfo=this.startIndexInfo=null,this.origin={x:0,y:0},this.background=document.createElement("a-plane"),this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor),this.el.appendChild(this.background),this.data.transparentBG&&this.background.setAttribute("material",{opacity:0,transparent:!0}),this.textAnchor=document.createElement("a-entity"),this.el.appendChild(this.textAnchor),this.textAnchor.setAttribute("text",{mode:"pre",baseline:"top",anchor:"center",font:"dejavu",wrapCount:this.data.cols,height:this.data.rows,color:this.data.color}),this._initTextarea(),this.el.addEventListener("textfontset",this._updateCharMetrics.bind(this)),this.el.addEventListener("char-metrics-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("text-changed",this._updateLines.bind(this)),this.el.addEventListener("text-changed",this._updateDisplayText.bind(this)),this.el.addEventListener("selection-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("selection-changed",this._updateHorizontalOrigin.bind(this)),this.el.addEventListener("lines-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("index-info-changed",this._updateOrigin.bind(this)),this.el.addEventListener("index-info-changed",this._updateHorizontalOrigin.bind(this)),this.el.addEventListener("origin-changed",this._updateDisplayText.bind(this)),this.el.addEventListener("click",this.focus.bind(this))},update:function(t){this.data.text!==t.text&&this._updateTextarea(),this.data.backgroundColor===t.backgroundColor&&this.data.disabledBackgroundColor===t.disabledBackgroundColor||this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor),this.data.disabled!==t.disabled&&(this.blinkEnabled=!this.data.disabled,this.textarea.disabled=this.data.disabled,this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor))},focus:function(){this.textarea.focus()},_initTextarea:function(){this.textarea=document.createElement("textarea"),document.body.appendChild(this.textarea),this._updateTextarea()},_updateTextarea:function(){this.textarea.style.whiteSpace="pre",this.textarea.style.overflow="hidden",this.textarea.style.opacity="0",this.textarea.cols=this.data.cols,this.textarea.rows=this.data.rows,this.textarea.value=this.data.text,this.textarea.selectionStart=0,this.textarea.selectionEnd=0,this._updateIndexInfo()},_emit:function(t,e){this.el.emit(t,e)},_updateCharMetrics:function(t){const e=this.textAnchor.components.text.geometry.layout,n=t.detail.fontObj.widthFactor;this.charWidth=n*this.textAnchor.object3DMap.text.scale.x,this.charHeight=this.charWidth*e.lineHeight/n,this.textAnchor.setAttribute("position",{x:0,y:this.charHeight*this.data.rows/2,z:0}),this.data.transparentBG||(this.background.setAttribute("scale",{x:1.05,y:this.charHeight*this.data.rows*1.05,z:1}),this.background.setAttribute("position",{x:0,y:0,z:0})),this._emit("char-metrics-changed")},_checkAndUpdateSelection:function(){if(this.selectionStart===this.textarea.selectionStart&&this.selectionEnd===this.textarea.selectionEnd)return;const t=this.selectionStart,e=this.selectionEnd;this.selectionStart=this.textarea.selectionStart,this.selectionEnd=this.textarea.selectionEnd,this._emit("selection-changed",{start:{old:t,new:this.selectionStart,changed:this.selectionStart!==t},end:{old:e,new:this.selectionEnd,changed:this.selectionEnd!==e}})},tick:function(t){t-this.lastBlink>500&&this.blinkEnabled&&(this.lastBlink=t),this._checkAndUpdateSelection(),this._checkAndUpdateText()},_getIndexInfo:function(t,e){const n=Math.max(0,t),r=this.lines[n];return{line:r,x:(e-r.start)*this.charWidth,y:-this.charHeight*n+-this.charHeight/2}},_updateIndexInfo:function(){if(!this.lines.length)return;const t=this.startIndexInfo&&this.startIndexInfo.line.index,e=this.endIndexInfo&&this.endIndexInfo.line.index;let n;this.startIndexInfo=null,this.endIndexInfo=null;let r=!1,s=!1;for(n=0;n<=this.lines.length;n++){const i=this.lines[n-1],o=n===this.lines.length?i.start+i.length+1:this.lines[n].start;if(o>this.selectionStart&&!this.startIndexInfo&&(this.startIndexInfo=this._getIndexInfo(n-1,this.selectionStart),this.startIndexInfo.line.index!==t&&(r=!0)),o>this.selectionEnd){this.endIndexInfo=this._getIndexInfo(n-1,this.selectionEnd),this.endIndexInfo.line.index!==e&&(s=!0);break}}(r||s)&&this._emit("index-info-changed",{start:{changed:r},end:{changed:s}})},_updateOrigin:function(t){let e=!1;if(t.detail.end.changed){const t=this.origin.y+this.data.rows-1;this.endIndexInfo.line.index>t?(this.origin.y=this.endIndexInfo.line.index+1-this.data.rows,e=!0):this.endIndexInfo.line.index<this.origin.y&&(this.origin.y=this.endIndexInfo.line.index,e=!0)}t.detail.start.changed&&this.startIndexInfo.line.index<this.origin.y&&(this.origin.y=this.startIndexInfo.line.index,e=!0),e&&this._emit("origin-changed")},_updateHorizontalOrigin:function(t){if(!this.endIndexInfo)return;let e=!0;if(t.detail.end.changed){const t=this.selectionEnd-this.endIndexInfo.line.start;t>this.origin.x+this.data.cols?(this.origin.x=t-this.data.cols,e=!0):t<this.origin.x&&(this.origin.x=t,e=!0)}const n=this.selectionStart-this.startIndexInfo.line.start;t.detail.start.changed&&(n>this.origin.x+this.data.cols?(this.origin.x=n-this.data.cols,e=!0):n<this.origin.x&&(this.origin.x=n,e=!0)),e&&this._emit("origin-changed")},_updateLines:function(){this.lines=[];const t=this.text.split("\n");let e=0;for(let n=0;n<t.length;n++)this.lines[n]={index:n,length:t[n].length,start:e},e+=t[n].length+1;this._emit("lines-changed")},_getViewportText:function(){return this.text.split("\n").slice(this.origin.y,this.origin.y+this.data.rows).map(function(t){return t.substr(this.origin.x,this.data.cols)||" "}.bind(this)).join("\n")},_updateDisplayText:function(){this.textAnchor.setAttribute("text",{value:this._getViewportText()})},_checkAndUpdateText:function(){const t=this.textarea.value;t!==this.text&&(this.text=t,this._emit("text-changed"))}})},824:e=>{"use strict";e.exports=t}},n={};function r(t){var s=n[t];if(void 0!==s)return s.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{"use strict";r.r(s);var t=r(824);async function e(t,e,n,r){return r._parse(t,e,n,r)}function n(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const i=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),o="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function a(t,e){return c(t||{},e)}function c(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n>3)return e;const r={...t};for(const[t,s]of Object.entries(e))s&&"object"==typeof s&&!Array.isArray(s)?r[t]=c(r[t]||{},e[t],n+1):r[t]=e[t];return r}o&&parseFloat(o[1]);const h="latest",l=(null!==(u=globalThis._loadersgl_)&&void 0!==u&&u.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.1"),globalThis._loadersgl_.version);var u;function d(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const f="object"!=typeof process||"[object process]"!==String(process)||process.browser,m="function"==typeof importScripts,g="undefined"!=typeof window&&void 0!==window.orientation,p="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);p&&parseFloat(p[1]);class A{constructor(t,e){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=t,this.workerThread=e,this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){d(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){d(this.isRunning),this.isRunning=!1,this._reject(t)}}class y{terminate(){}}const B=new Map;function b(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function C(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(t)if(w(t))r.add(t);else if(w(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const n in t)C(t[n],e,r);return void 0===n?Array.from(r):[]}function w(t){return!!t&&(t instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)}const v=()=>{};class E{static isSupported(){return"undefined"!=typeof Worker&&f||void 0!==y&&!f}constructor(t){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";const{name:e,source:n,url:r}=t;d(n||r),this.name=e,this.source=n,this.url=r,this.onMessage=v,this.onError=t=>console.log(t),this.worker=f?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=v,this.onError=v,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||C(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=function(t){d(t.source&&!t.url||!t.source&&t.url);let e=B.get(t.source||t.url);return e||(t.url&&(e=(n=t.url).startsWith("http")?b(`try {\n  importScripts('${n}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):n,B.set(t.url,e)),t.source&&(e=b(t.source),B.set(t.source,e))),d(e),e;var n}({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new y(e,{eval:!1})}else{if(!this.source)throw new Error("no worker");t=new y(this.source,{eval:!0})}return t.on("message",(t=>{this.onMessage(t)})),t.on("error",(t=>{this.onError(t)})),t.on("exit",(t=>{})),t}}class T{static isSupported(){return E.isSupported()}constructor(t){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e,n)=>t.done(n),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(t,e)=>t.error(e);const r=new Promise((r=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:r}),this)));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new A(e.name,t);t.onMessage=t=>e.onMessage(n,t.type,t.payload),t.onError=t=>e.onError(n,t),e.onStart(n);try{await n.result}catch(t){console.error(`Worker exception: ${t}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!f||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new E({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return g?this.maxMobileConcurrency:this.maxConcurrency}}const _={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class M{static isSupported(){return E.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return M._workerFarm=M._workerFarm||new M({}),M._workerFarm.setProps(t),M._workerFarm}constructor(t){this.props=void 0,this.workerPools=new Map,this.props={..._},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:r}=t;let s=this.workerPools.get(e);return s||(s=new T({name:e,source:n,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}M._workerFarm=void 0;const I=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})),x={};async function S(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e&&(t=O(t,e,n,r)),x[t]=x[t]||R(t),await x[t]}function O(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!n.useLocalLibraries&&t.startsWith("http"))return t;r=r||t;const s=n.modules||{};return s[r]?s[r]:f?n.CDN?(d(n.CDN.startsWith("http")),`${n.CDN}/${e}@${l}/dist/libs/${r}`):m?`../src/libs/${r}`:`modules/${e}/src/libs/${r}`:`modules/${e}/dist/libs/${r}`}async function R(t){if(t.endsWith("wasm"))return await async function(t){{const e=await fetch(t);return await e.arrayBuffer()}}(t);if(!f)try{return I&&void 0}catch(t){return console.error(t),null}return m?importScripts(t):function(t,e){if(!f)return;if(m)return eval.call(globalThis,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch(e){n.text=t}return document.body.appendChild(n),null}(await async function(t){{const e=await fetch(t);return await e.text()}}(t),t)}async function F(t,e,n,r,s){const i=t.id,o=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e[t.id]||{},r=f?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=n.workerUrl;if(s||"compression"!==t.id||(s=e.workerUrl),"test"===e._workerType&&(s=f?`modules/${t.module}/dist/${r}`:`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let e=t.version;"latest"===e&&(e=h);const n=e?`@${e}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${n}/dist/${r}`}return d(s),s}(t,n),a=M.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await a.startJob("process-on-worker",D.bind(null,s));c.postMessage("process",{input:e,options:n,context:r});const l=await c.result;return await l.result}async function D(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:i,options:o}=r;try{const n=await t(i,o);e.postMessage("done",{id:s,result:n})}catch(t){const n=t instanceof Error?t.message:"unknown error";e.postMessage("error",{id:s,error:n})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function G(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let s="";for(let t=0;t<n;t++)s+=String.fromCharCode(r.getUint8(e+t));return s}function L(t){const e=t.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),n=e.reduce(((t,e)=>t+e.byteLength),0),r=new Uint8Array(n);let s=0;for(const t of e)r.set(t,s),s+=t.byteLength;return r.buffer}function U(t,e,n){const r=void 0!==n?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function N(t,e){return n(t>=0),n(e>0),t+(e-1)&~(e-1)}function P(t,e,n){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const e=t.byteOffset,n=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,e,n)}return e.set(r,n),n+N(r.byteLength,4)}function H(){let t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}class J{constructor(t,e){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=H(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(H()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class j{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach((e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>this._getOrCreate(t)))}_getOrCreate(t){const{name:e,type:n}=t;let r=this.stats[e];return r||(r=t instanceof J?t:new J(e,n),this.stats[e]=r),r}}const k={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class V{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.props=void 0,this.stats=void 0,this.activeRequestCount=0,this.requestQueue=[],this.requestMap=new Map,this.deferredUpdate=null,this.props={...k,...t},this.stats=new j({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},r=new Promise((t=>(n.resolve=t,n)));return this.requestQueue.push(n),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:e,resolve:n}=t;let r=!1;const s=()=>{r||(r=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e){const t=this.requestQueue.shift();t&&this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort(((t,e)=>t.priority-e.priority))}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0&&(t.resolve(null),1))}}const K={};function Q(t){if((e=t)&&"object"==typeof e&&e.isBuffer)return t;var e;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"==typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function q(){var t;if("undefined"!=typeof process&&void 0!==process.cwd)return process.cwd();const e=null===(t=window.location)||void 0===t?void 0:t.pathname;return(null==e?void 0:e.slice(0,e.lastIndexOf("/")+1))||""}function z(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function W(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const X=47;function Y(t,e){let n,r="",s=-1,i=0,o=!1;for(let a=0;a<=t.length;++a){if(a<t.length)n=t.charCodeAt(a);else{if(n===X)break;n=X}if(n===X){if(s===a-1||1===i);else if(s!==a-1&&2===i){if(r.length<2||!o||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){const t=r.length-1;let e=t;for(;e>=0&&r.charCodeAt(e)!==X;--e);if(e!==t){r=-1===e?"":r.slice(0,e),s=a,i=0,o=!1;continue}}else if(2===r.length||1===r.length){r="",s=a,i=0,o=!1;continue}e&&(r.length>0?r+="/..":r="..",o=!0)}else{const e=t.slice(s+1,a);r.length>0?r+=`/${e}`:r=e,o=!1}s=a,i=0}else 46===n&&-1!==i?++i:i=-1}return r}const Z=t=>"function"==typeof t,$=t=>null!==t&&"object"==typeof t,tt=t=>$(t)&&t.constructor==={}.constructor,et=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,nt=t=>"undefined"!=typeof Blob&&t instanceof Blob,rt=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||$(t)&&Z(t.tee)&&Z(t.cancel)&&Z(t.getReader))(t)||(t=>$(t)&&Z(t.read)&&Z(t.pipe)&&(t=>"boolean"==typeof t)(t.readable))(t),st=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,it=/^([-\w.]+\/[-\w.+]+)/;function ot(t){const e=st.exec(t);return e?e[1]:""}const at=/\?.*/;function ct(t){return t.replace(at,"")}function ht(t){return et(t)?t.url:nt(t)?t.name||"":"string"==typeof t?t:""}function lt(t){if(et(t)){const e=t,n=e.headers.get("content-type")||"",r=ct(e.url);return function(t){const e=it.exec(t);return e?e[1]:t}(n)||ot(r)}return nt(t)?t.type||"":"string"==typeof t?ot(t):""}async function ut(t){if(et(t))return t;const e={},n=function(t){return et(t)?t.headers["content-length"]||-1:nt(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);n>=0&&(e["content-length"]=String(n));const r=ht(t),s=lt(t);s&&(e["content-type"]=s);const i=await async function(t){if("string"==typeof t)return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const n=new FileReader;n.onload=e=>{var n;return t(null==e||null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e)}))}return t instanceof ArrayBuffer?`data:base64,${function(t){let e="";const n=new Uint8Array(t);for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return btoa(e)}(t.slice(0,5))}`:null}(t);i&&(e["x-first-bytes"]=i),"string"==typeof t&&(t=(new TextEncoder).encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function dt(t,e){if("string"==typeof t){const s=function(t){for(const e in K)if(t.startsWith(e)){const n=K[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t=`${t}`),t}(t);var n,r;return function(t){return!function(t){return t.startsWith("http:")||t.startsWith("https:")}(t)&&!function(t){return t.startsWith("data:")}(t)}(s)&&null!==(n=globalThis.loaders)&&void 0!==n&&n.fetchNode?null===(r=globalThis.loaders)||void 0===r?void 0:r.fetchNode(s,e):await fetch(s,e)}return await ut(t)}function ft(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}()}const mt=globalThis.window||globalThis.self||globalThis.global,gt=globalThis.process||{},pt="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";ft();class At{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=function(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(t){return null}}(n),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function yt(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const i=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(s,");"),"background-size:".concat(i,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Bt;var bt;function Ct(t){return"string"!=typeof t?t:(t=t.toUpperCase(),Bt[t]||Bt.WHITE)}function wt(t,e){if(!t)throw new Error(e||"Assertion failed")}function vt(){let t;var e,n;if(ft()&&mt.performance)t=null==mt||null===(e=mt.performance)||void 0===e||null===(n=e.now)||void 0===n?void 0:n.call(e);else if("hrtime"in gt){var r;const e=null==gt||null===(r=gt.hrtime)||void 0===r?void 0:r.call(gt);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}(bt=Bt||(Bt={}))[bt.BLACK=30]="BLACK",bt[bt.RED=31]="RED",bt[bt.GREEN=32]="GREEN",bt[bt.YELLOW=33]="YELLOW",bt[bt.BLUE=34]="BLUE",bt[bt.MAGENTA=35]="MAGENTA",bt[bt.CYAN=36]="CYAN",bt[bt.WHITE=37]="WHITE",bt[bt.BRIGHT_BLACK=90]="BRIGHT_BLACK",bt[bt.BRIGHT_RED=91]="BRIGHT_RED",bt[bt.BRIGHT_GREEN=92]="BRIGHT_GREEN",bt[bt.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",bt[bt.BRIGHT_BLUE=94]="BRIGHT_BLUE",bt[bt.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",bt[bt.BRIGHT_CYAN=96]="BRIGHT_CYAN",bt[bt.BRIGHT_WHITE=97]="BRIGHT_WHITE";const Et={debug:ft()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Tt={enabled:!0,level:0};function _t(){}const Mt={},It={once:!0};class xt{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};this.id=void 0,this.VERSION=pt,this._startTs=vt(),this._deltaTs=vt(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new At("__probe-".concat(this.id,"__"),Tt),this.timeStamp("".concat(this.id," started")),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),s=t;for(const n of r){const r=s[n];"function"==typeof r&&(e.find((t=>n===t))||(s[n]=r.bind(t)))}}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((vt()-this._startTs).toPrecision(10))}getDelta(){return Number((vt()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){wt(t,e)}warn(t){return this._getLogFunction(0,t,Et.warn,arguments,It)}error(t){return this._getLogFunction(0,t,Et.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,Et.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Et.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,Et.debug||Et.info,arguments,It)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||_t,n&&[n],{tag:Rt(e)}):_t}image(t){let{logLevel:e,priority:n,image:r,message:s="",scale:i=1}=t;return this._shouldLog(e||n)?ft()?function(t){let{image:e,message:n="",scale:r=1}=t;if("string"==typeof e){const t=new Image;return t.onload=()=>{const e=yt(t,n,r);console.log(...e)},t.src=e,_t}const s=e.nodeName||"";if("img"===s.toLowerCase())return console.log(...yt(e,n,r)),_t;if("canvas"===s.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...yt(t,n,r)),t.src=e.toDataURL(),_t}return _t}({image:r,message:s,scale:i}):(console.warn("removed"),_t):_t}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||_t)}group(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const r=Ot({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||_t)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=St(t)}_getLogFunction(t,e,n,r,s){if(this._shouldLog(t)){s=Ot({logLevel:t,message:e,args:r,opts:s}),wt(n=n||s.method),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=vt();const i=s.tag||s.message;if(s.once&&i){if(Mt[i])return _t;Mt[i]=vt()}return e=function(t,e,n){if("string"==typeof e){const r=n.time?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(n.total)):"";e=function(t,e,n){if(!ft&&"string"==typeof t){if(e){const n=Ct(e);t="[".concat(n,"m").concat(t,"[39m")}if(n){const e=Ct(n);t="[".concat(e+10,"m").concat(t,"[49m")}}return t}(e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),n.color,n.background)}return e}(this.id,s.message,s),n.bind(console,e,...s.args)}return _t}}function St(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return wt(Number.isFinite(e)&&e>=0),e}function Ot(t){const{logLevel:e,message:n}=t;t.logLevel=St(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":void 0!==n&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());const s=typeof t.message;return wt("string"===s||"object"===s),Object.assign(t,{args:r},t.opts)}function Rt(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}xt.VERSION=pt;const Ft=new xt({id:"@probe.gl/log"}),Dt=new xt({id:"loaders.gl"});class Gt{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const Lt={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){this.console=void 0,this.console=console}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:i,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Ut={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Nt(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}function Pt(){const t=Nt();return t.globalOptions=t.globalOptions||{...Lt},t.globalOptions}function Ht(t,e,n,r,s){const i=e||"Top level",o=e?`${e}.`:"";for(const a in t){const c=!e&&$(t[a]),h="baseUri"===a&&!e,l="workerUrl"===a&&e;if(!(a in n)&&!h&&!l)if(a in r)Dt.warn(`${i} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!c){const t=Jt(a,s);Dt.warn(`${i} loader option '${o}${a}' not recognized. ${t}`)()}}}function Jt(t,e){const n=t.toLowerCase();let r="";for(const s of e)for(const e in s.options){if(t===e)return`Did you mean '${s.id}.${e}'?`;const i=e.toLowerCase();(n.startsWith(i)||i.startsWith(n))&&(r=r||`Did you mean '${s.id}.${e}'?`)}return r}function jt(t,e){for(const n in e)if(n in e){const r=e[n];tt(r)&&tt(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function kt(t){var e;return!!t&&(Array.isArray(t)&&(t=t[0]),Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions))}function Vt(t){var e,r;let s;return n(t,"null loader"),n(kt(t),"invalid loader"),Array.isArray(t)&&(s=t[1],t=t[0],t={...t,options:{...t.options,...s}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(r=t)&&void 0!==r&&r.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}function Kt(){return(()=>{const t=Nt();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry})()}const Qt=new xt({id:"loaders.gl"}),qt=/\.([^.]+)$/;function zt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Xt(t))return null;if(e&&!Array.isArray(e))return Vt(e);let s=[];e&&(s=s.concat(e)),null!=n&&n.ignoreRegisteredLoaders||s.push(...Kt()),Zt(s);const i=Wt(t,s,n,r);if(!(i||null!=n&&n.nothrow))throw new Error(Yt(t));return i}function Wt(t,e,n,r){const s=ht(t),i=lt(t),o=ct(s)||(null==r?void 0:r.url);let a=null,c="";var h;return null!=n&&n.mimeType&&(a=$t(e,null==n?void 0:n.mimeType),c=`match forced by supplied MIME type ${null==n?void 0:n.mimeType}`),a=a||function(t,e){const n=e&&qt.exec(e),r=n&&n[1];return r?function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,r):null}(e,o),c=c||(a?`matched url ${o}`:""),a=a||$t(e,i),c=c||(a?`matched MIME type ${i}`:""),a=a||function(t,e){if(!e)return null;for(const n of t)if("string"==typeof e){if(te(e,n))return n}else if(ArrayBuffer.isView(e)){if(ee(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&ee(e,0,n))return n;return null}(e,t),c=c||(a?`matched initial data ${ne(t)}`:""),null!=n&&n.fallbackMimeType&&(a=a||$t(e,null==n?void 0:n.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c&&Qt.log(1,`selectLoader selected ${null===(h=a)||void 0===h?void 0:h.name}: ${c}.`),a}function Xt(t){return!(t instanceof Response&&204===t.status)}function Yt(t){const e=ht(t),n=lt(t);let r="No valid loader found (";r+=e?`${z(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const s=t?ne(t):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function Zt(t){for(const e of t)Vt(e)}function $t(t,e){for(const n of t){if(n.mimeTypes&&n.mimeTypes.includes(e))return n;if(e===`application/x.${n.id}`)return n}return null}function te(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function ee(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((n=>function(t,e,n,r){if(r instanceof ArrayBuffer)return function(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),s=new Uint8Array(e);for(let t=0;t<r.length;++t)if(r[t]!==s[t])return!1;return!0}(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":return r===re(t,e,r.length);default:return!1}}(t,e,0,n)))}function ne(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?re(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?re(t,0,e):""}function re(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let s="";for(let t=0;t<n;t++)s+=String.fromCharCode(r.getUint8(e+t));return s}const se=262144;function ie(t,e){return i?async function*(t,e){const n=t.getReader();let r;try{for(;;){const t=r||n.read();null!=e&&e._streamReadAhead&&(r=n.read());const{done:s,value:i}=await t;if(s)return;yield Q(i)}}catch(t){n.releaseLock()}}(t,e):async function*(t,e){for await(const e of t)yield Q(e)}(t)}const oe="Cannot convert supplied data type";async function ae(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||r)return function(t,e,n){if(e.text&&"string"==typeof t)return t;var r;if((r=t)&&"object"==typeof r&&r.isBuffer&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const r=t.byteLength||t.length;return 0===t.byteOffset&&r===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+r)),n}throw new Error(oe)}(t,e);if(nt(t)&&(t=await ut(t)),et(t)){const n=t;return await async function(t){if(!t.ok){const e=await async function(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{const n=t.headers.get("Content-Type");let r=t.statusText;null!=n&&n.includes("application/json")&&(r+=` ${await t.text()}`),e+=r,e=e.length>60?`${e.slice(0,60)}...`:e}catch(t){}return e}(t);throw new Error(e)}}(n),e.binary?await n.arrayBuffer():await n.text()}if(rt(t)&&(t=function(t,e){if("string"==typeof t)return function*(t,e){const n=(null==e?void 0:e.chunkSize)||262144;let r=0;const s=new TextEncoder;for(;r<t.length;){const e=Math.min(t.length-r,n),i=t.slice(r,r+e);r+=e,yield s.encode(i)}}(t,e);if(t instanceof ArrayBuffer)return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const{chunkSize:n=se}=e;let r=0;for(;r<t.byteLength;){const e=Math.min(t.byteLength-r,n),s=new ArrayBuffer(e),i=new Uint8Array(t,r,e);new Uint8Array(s).set(i),r+=e,yield s}}()}(t,e);if(nt(t))return async function*(t,e){const n=(null==e?void 0:e.chunkSize)||1048576;let r=0;for(;r<t.size;){const e=r+n,s=await t.slice(r,e).arrayBuffer();r=e,yield s}}(t,e);if(rt(t))return ie(t,e);if(et(t))return ie(t.body,e);throw new Error("makeIterator")}(t,n)),s=t,Boolean(s)&&"function"==typeof s[Symbol.iterator]||(t=>t&&"function"==typeof t[Symbol.asyncIterator])(t))return async function(t){const e=[];for await(const n of t)e.push(n);return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return L(e)}(...e)}(t);var s;throw new Error(oe)}function ce(t,e){const n=Pt(),r=t||n;return"function"==typeof r.fetch?r.fetch:$(r.fetch)?t=>dt(t,r.fetch):null!=e&&e.fetch?null==e?void 0:e.fetch:dt}async function he(t,e,n,r){!e||Array.isArray(e)||kt(e)||(r=void 0,n=e,e=void 0),n=n||{};const s=ht(t=await t),i=function(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...t]:t}return n&&n.length?n:void 0}(e,r),o=await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Xt(t))return null;let s=zt(t,e,{...n,nothrow:!0},r);if(s)return s;if(nt(t)&&(s=zt(t=await t.slice(0,10).arrayBuffer(),e,n,r)),!(s||null!=n&&n.nothrow))throw new Error(Yt(t));return s}(t,i,n);return o?(r=function(t,e,n){if(n)return n;const r={fetch:ce(e,t),...t};if(r.url){const t=ct(r.url);r.baseUrl=t,r.queryString=function(t){const e=t.match(at);return e&&e[0]}(r.url),r.filename=z(t),r.baseUrl=W(t)}return Array.isArray(r.loaders)||(r.loaders=null),r}({url:s,_parse:he,loaders:i},n=function(t,e,n,r){return n=n||[],function(t,e){Ht(t,null,Lt,Ut,e);for(const n of e){const r=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Ht(r,n.id,s,i,e)}}(t,n=Array.isArray(n)?n:[n]),function(t,e,n){const r={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}(r,n),null===r.log&&(r.log=new Gt),jt(r,Pt()),jt(r,e),r}(e,t,r)}(n,o,i,s),r||null),await async function(t,e,n,r){if(function(t){d(t,"no worker provided");t.version}(t),n=a(t.options,n),et(e)){const t=e,{ok:n,redirected:s,status:i,statusText:o,type:a,url:c}=t,h=Object.fromEntries(t.headers.entries());r.response={headers:h,ok:n,redirected:s,status:i,statusText:o,type:a,url:c}}e=await ae(e,t,n);const s=t;if(s.parseTextSync&&"string"==typeof e)return s.parseTextSync(e,n,r);if(function(t,e){return!!M.isSupported()&&!!(f||null!=e&&e._nodeWorkers)&&t.worker&&(null==e?void 0:e.worker)}(t,n))return await F(t,e,n,r,he);if(s.parseText&&"string"==typeof e)return await s.parseText(e,n,r);if(s.parse)return await s.parse(e,n,r);throw d(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}(o,t,n,r)):null}async function le(t,e,n,r){let s,i;Array.isArray(e)||kt(e)?(s=e,i=n):(s=[],i=e);const o=ce(i);let a=t;return"string"==typeof t&&(a=await o(t)),nt(t)&&(a=await o(t)),Array.isArray(s),await he(a,s,i)}const ue=1/Math.PI*180,de=1/180*Math.PI;globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const fe=globalThis.mathgl.config;function me(t,{precision:e=fe.precision}={}){return t=function(t){return Math.round(t/fe.EPSILON)*fe.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function ge(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function pe(t){return function(t,e){return Ce(t,(t=>t*de),void 0)}(t)}function Ae(t){return ye(t)}function ye(t,e){return Ce(t,(t=>t*ue),e)}function Be(t,e,n){return Ce(t,(t=>Math.max(e,Math.min(n,t))))}function be(t,e,n){const r=fe.EPSILON;n&&(fe.EPSILON=n);try{if(t===e)return!0;if(ge(t)&&ge(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!be(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):"number"==typeof t&&"number"==typeof e&&Math.abs(t-e)<=fe.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{fe.EPSILON=r}}function Ce(t,e,n){if(ge(t)){const r=t;n=n||function(t){return t.clone?t.clone():new Array(t.length)}(r);for(let s=0;s<n.length&&s<r.length;++s){const r="number"==typeof t?t:t[s];n[s]=e(r,s,n)}return n}return e(t)}class we extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(t=[],e=0){for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ge(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(fe)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+me(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!be(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(void 0===n)return this.lerp(this,t,e);for(let r=0;r<this.ELEMENTS;++r){const s=t[r],i="number"==typeof e?e:e[r];this[r]=s+n*(i-s)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if("number"==typeof t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(fe.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function ve(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(JSON.stringify(t)));return t}function Ee(t,e,n=""){if(fe.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}function Te(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}class _e extends we{get x(){return this[0]}set x(t){this[0]=ve(t)}get y(){return this[1]}set y(t){this[1]=ve(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-t[n];e+=r*r}return ve(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return ve(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Te(t>=0&&t<this.ELEMENTS,"index is out of range"),ve(this[t])}setComponent(t,e){return Te(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const Me=1e-6;let Ie="undefined"!=typeof Float32Array?Float32Array:Array;function xe(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[3]*s+n[6],t[1]=n[1]*r+n[4]*s+n[7],t}function Se(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[4]*s+n[12],t[1]=n[1]*r+n[5]*s+n[13],t}function Oe(t,e,n){const r=e[0],s=e[1],i=n[3]*r+n[7]*s||1;return t[0]=(n[0]*r+n[4]*s)/i,t[1]=(n[1]*r+n[5]*s)/i,t}function Re(t,e,n){const r=e[0],s=e[1],i=e[2],o=n[3]*r+n[7]*s+n[11]*i||1;return t[0]=(n[0]*r+n[4]*s+n[8]*i)/o,t[1]=(n[1]*r+n[5]*s+n[9]*i)/o,t[2]=(n[2]*r+n[6]*s+n[10]*i)/o,t}function Fe(t,e,n){const r=e[0],s=e[1],i=e[2];return t[0]=n[0]*r+n[3]*s+n[6]*i,t[1]=n[1]*r+n[4]*s+n[7]*i,t[2]=n[2]*r+n[5]*s+n[8]*i,t[3]=e[3],t}!function(){const t=new Ie(2);Ie!=Float32Array&&(t[0]=0,t[1]=0)}();class De extends _e{constructor(t=0,e=0){super(2),ge(t)&&1===arguments.length?this.copy(t):(fe.debug&&(ve(t),ve(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return fe.debug&&(ve(t.x),ve(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Se(this,this,t),this.check()}transformAsVector(t){return Oe(this,this,t),this.check()}transformByMatrix3(t){return xe(this,this,t),this.check()}transformByMatrix2x3(t){return function(t,e,n){const r=e[0],s=e[1];t[0]=n[0]*r+n[2]*s+n[4],t[1]=n[1]*r+n[3]*s+n[5]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const r=e[0],s=e[1];t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s}(this,this,t),this.check()}}function Ge(){const t=new Ie(3);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Le(t){const e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function Ue(t,e,n){const r=new Ie(3);return r[0]=t,r[1]=e,r[2]=n,r}function Ne(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Pe(t,e,n){const r=e[0],s=e[1],i=e[2],o=n[0],a=n[1],c=n[2];return t[0]=s*c-i*a,t[1]=i*o-r*c,t[2]=r*a-s*o,t}function He(t,e,n){const r=e[0],s=e[1],i=e[2];let o=n[3]*r+n[7]*s+n[11]*i+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*s+n[8]*i+n[12])/o,t[1]=(n[1]*r+n[5]*s+n[9]*i+n[13])/o,t[2]=(n[2]*r+n[6]*s+n[10]*i+n[14])/o,t}function Je(t,e,n){const r=e[0],s=e[1],i=e[2];return t[0]=r*n[0]+s*n[3]+i*n[6],t[1]=r*n[1]+s*n[4]+i*n[7],t[2]=r*n[2]+s*n[5]+i*n[8],t}function je(t,e,n){const r=n[0],s=n[1],i=n[2],o=n[3],a=e[0],c=e[1],h=e[2];let l=s*h-i*c,u=i*a-r*h,d=r*c-s*a,f=s*d-i*u,m=i*l-r*d,g=r*u-s*l;const p=2*o;return l*=p,u*=p,d*=p,f*=2,m*=2,g*=2,t[0]=a+l+f,t[1]=c+u+m,t[2]=h+d+g,t}const ke=Le;Ge();const Ve=[0,0,0];let Ke,Qe;class qe extends _e{static get ZERO(){return Ke||(Ke=new qe(0,0,0),Object.freeze(Ke)),Ke}constructor(t=0,e=0,n=0){super(-0,-0,-0),1===arguments.length&&ge(t)?this.copy(t):(fe.debug&&(ve(t),ve(e),ve(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return fe.debug&&(ve(t.x),ve(t.y),ve(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=ve(t)}angle(t){return function(t,e){const n=t[0],r=t[1],s=t[2],i=e[0],o=e[1],a=e[2],c=Math.sqrt((n*n+r*r+s*s)*(i*i+o*o+a*a)),h=c&&Ne(t,e)/c;return Math.acos(Math.min(Math.max(h,-1),1))}(this,t)}cross(t){return Pe(this,this,t),this.check()}rotateX({radians:t,origin:e=Ve}){return function(t,e,n,r){const s=[],i=[];s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2]}(this,this,e,t),this.check()}rotateY({radians:t,origin:e=Ve}){return function(t,e,n,r){const s=[],i=[];s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2]}(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=Ve}){return function(t,e,n,r){const s=[],i=[];s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2]}(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return He(this,this,t),this.check()}transformAsVector(t){return Re(this,this,t),this.check()}transformByMatrix3(t){return Je(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const r=e[0],s=e[1];t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return je(this,this,t),this.check()}}class ze extends _e{static get ZERO(){return Qe||(Qe=new ze(0,0,0,0),Object.freeze(Qe)),Qe}constructor(t=0,e=0,n=0,r=0){super(-0,-0,-0,-0),ge(t)&&1===arguments.length?this.copy(t):(fe.debug&&(ve(t),ve(e),ve(n),ve(r)),this[0]=t,this[1]=e,this[2]=n,this[3]=r)}set(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return fe.debug&&(ve(t.x),ve(t.y),ve(t.z),ve(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=ve(t)}get w(){return this[3]}set w(t){this[3]=ve(t)}transform(t){return He(this,this,t),this.check()}transformByMatrix3(t){return Fe(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const r=e[0],s=e[1];t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t[2]=e[2],t[3]=e[3]}(this,this,t),this.check()}transformByQuaternion(t){return je(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class We extends we{toString(){let t="[";if(fe.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=ve(n),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[n+t];return e}setColumn(t,e){const n=t*this.RANK;for(let t=0;t<this.RANK;++t)this[n+t]=e[t];return this}}function Xe(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=n[0],f=n[1],m=n[2],g=n[3],p=n[4],A=n[5],y=n[6],B=n[7],b=n[8];return t[0]=d*r+f*o+m*h,t[1]=d*s+f*a+m*l,t[2]=d*i+f*c+m*u,t[3]=g*r+p*o+A*h,t[4]=g*s+p*a+A*l,t[5]=g*i+p*c+A*u,t[6]=y*r+B*o+b*h,t[7]=y*s+B*a+b*l,t[8]=y*i+B*c+b*u,t}function Ye(t,e,n){const r=n[0],s=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}var Ze,$e;($e=Ze||(Ze={}))[$e.COL0ROW0=0]="COL0ROW0",$e[$e.COL0ROW1=1]="COL0ROW1",$e[$e.COL0ROW2=2]="COL0ROW2",$e[$e.COL1ROW0=3]="COL1ROW0",$e[$e.COL1ROW1=4]="COL1ROW1",$e[$e.COL1ROW2=5]="COL1ROW2",$e[$e.COL2ROW0=6]="COL2ROW0",$e[$e.COL2ROW1=7]="COL2ROW1",$e[$e.COL2ROW2=8]="COL2ROW2";const tn=Object.freeze([1,0,0,0,1,0,0,0,1]);class en extends We{static get IDENTITY(){return rn||(rn=new en,Object.freeze(rn)),rn}static get ZERO(){return nn||(nn=new en([0,0,0,0,0,0,0,0,0]),Object.freeze(nn)),nn}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Ze}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(tn)}fromObject(t){return this.check()}fromQuaternion(t){return function(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,a=r+r,c=s+s,h=n*o,l=r*o,u=r*a,d=s*o,f=s*a,m=s*c,g=i*o,p=i*a,A=i*c;t[0]=1-u-m,t[3]=l-A,t[6]=d+p,t[1]=l+A,t[4]=1-h-m,t[7]=f-g,t[2]=d-p,t[5]=f+g,t[8]=1-h-u}(this,t),this.check()}set(t,e,n,r,s,i,o,a,c){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=s,this[5]=i,this[6]=o,this[7]=a,this[8]=c,this.check()}setRowMajor(t,e,n,r,s,i,o,a,c){return this[0]=t,this[1]=r,this[2]=o,this[3]=e,this[4]=s,this[5]=a,this[6]=n,this[7]=i,this[8]=c,this.check()}determinant(){return function(t){const e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],o=t[5],a=t[6],c=t[7],h=t[8];return e*(h*i-o*c)+n*(-h*s+o*a)+r*(c*s-i*a)}(this)}transpose(){return function(t,e){if(t===e){const n=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}invert(){return function(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],h=e[7],l=e[8],u=l*o-a*h,d=-l*i+a*c,f=h*i-o*c;let m=n*u+r*d+s*f;m&&(m=1/m,t[0]=u*m,t[1]=(-l*r+s*h)*m,t[2]=(a*r-s*o)*m,t[3]=d*m,t[4]=(l*n-s*c)*m,t[5]=(-a*n+s*i)*m,t[6]=f*m,t[7]=(-h*n+r*c)*m,t[8]=(o*n-r*i)*m)}(this,this),this.check()}multiplyLeft(t){return Xe(this,t,this),this.check()}multiplyRight(t){return Xe(this,this,t),this.check()}rotate(t){return function(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=Math.sin(n),f=Math.cos(n);t[0]=f*r+d*o,t[1]=f*s+d*a,t[2]=f*i+d*c,t[3]=f*o-d*r,t[4]=f*a-d*s,t[5]=f*c-d*i,t[6]=h,t[7]=l,t[8]=u}(this,this,t),this.check()}scale(t){return Array.isArray(t)?Ye(this,this,t):Ye(this,this,[t,t]),this.check()}translate(t){return function(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=n[0],f=n[1];t[0]=r,t[1]=s,t[2]=i,t[3]=o,t[4]=a,t[5]=c,t[6]=d*r+f*o+h,t[7]=d*s+f*a+l,t[8]=d*i+f*c+u}(this,this,t),this.check()}transform(t,e){let n;switch(t.length){case 2:n=xe(e||[-0,-0],t,this);break;case 3:n=Je(e||[-0,-0,-0],t,this);break;case 4:n=Fe(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ee(n,t.length),n}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let nn,rn=null;function sn(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],p=e[13],A=e[14],y=e[15];let B=n[0],b=n[1],C=n[2],w=n[3];return t[0]=B*r+b*a+C*u+w*g,t[1]=B*s+b*c+C*d+w*p,t[2]=B*i+b*h+C*f+w*A,t[3]=B*o+b*l+C*m+w*y,B=n[4],b=n[5],C=n[6],w=n[7],t[4]=B*r+b*a+C*u+w*g,t[5]=B*s+b*c+C*d+w*p,t[6]=B*i+b*h+C*f+w*A,t[7]=B*o+b*l+C*m+w*y,B=n[8],b=n[9],C=n[10],w=n[11],t[8]=B*r+b*a+C*u+w*g,t[9]=B*s+b*c+C*d+w*p,t[10]=B*i+b*h+C*f+w*A,t[11]=B*o+b*l+C*m+w*y,B=n[12],b=n[13],C=n[14],w=n[15],t[12]=B*r+b*a+C*u+w*g,t[13]=B*s+b*c+C*d+w*p,t[14]=B*i+b*h+C*f+w*A,t[15]=B*o+b*l+C*m+w*y,t}var on;!function(){const t=new Ie(4);Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}(),function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"}(on||(on={}));const an=45*Math.PI/180,cn=1,hn=.1,ln=500,un=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class dn extends We{static get IDENTITY(){return mn||(mn=new dn,Object.freeze(mn)),mn}static get ZERO(){return fn||(fn=new dn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(fn)),fn}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return on}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,r,s,i,o,a,c,h,l,u,d,f,m,g){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=s,this[5]=i,this[6]=o,this[7]=a,this[8]=c,this[9]=h,this[10]=l,this[11]=u,this[12]=d,this[13]=f,this[14]=m,this[15]=g,this.check()}setRowMajor(t,e,n,r,s,i,o,a,c,h,l,u,d,f,m,g){return this[0]=t,this[1]=s,this[2]=c,this[3]=d,this[4]=e,this[5]=i,this[6]=h,this[7]=f,this[8]=n,this[9]=o,this[10]=l,this[11]=m,this[12]=r,this[13]=a,this[14]=u,this[15]=g,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(un)}fromObject(t){return this.check()}fromQuaternion(t){return function(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,a=r+r,c=s+s,h=n*o,l=r*o,u=r*a,d=s*o,f=s*a,m=s*c,g=i*o,p=i*a,A=i*c;t[0]=1-u-m,t[1]=l+A,t[2]=d-p,t[3]=0,t[4]=l-A,t[5]=1-h-m,t[6]=f+g,t[7]=0,t[8]=d+p,t[9]=f-g,t[10]=1-h-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:r,top:s,near:i=hn,far:o=ln}=t;return o===1/0?function(t,e,n,r,s,i){const o=2*i/(n-e),a=2*i/(s-r),c=(n+e)/(n-e),h=(s+r)/(s-r),l=-2*i;t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=h,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=l,t[15]=0}(this,e,n,r,s,i):function(t,e,n,r,s,i,o){const a=1/(n-e),c=1/(s-r),h=1/(i-o);t[0]=2*i*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*c,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(s+r)*c,t[10]=(o+i)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*h,t[15]=0}(this,e,n,r,s,i,o),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:r=[0,1,0]}=t;return function(t,e,n,r){let s,i,o,a,c,h,l,u,d,f;const m=e[0],g=e[1],p=e[2],A=r[0],y=r[1],B=r[2],b=n[0],C=n[1],w=n[2];Math.abs(m-b)<Me&&Math.abs(g-C)<Me&&Math.abs(p-w)<Me?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(u=m-b,d=g-C,f=p-w,s=1/Math.sqrt(u*u+d*d+f*f),u*=s,d*=s,f*=s,i=y*f-B*d,o=B*u-A*f,a=A*d-y*u,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),c=d*a-f*o,h=f*i-u*a,l=u*o-d*i,s=Math.sqrt(c*c+h*h+l*l),s?(s=1/s,c*=s,h*=s,l*=s):(c=0,h=0,l=0),t[0]=i,t[1]=c,t[2]=u,t[3]=0,t[4]=o,t[5]=h,t[6]=d,t[7]=0,t[8]=a,t[9]=l,t[10]=f,t[11]=0,t[12]=-(i*m+o*g+a*p),t[13]=-(c*m+h*g+l*p),t[14]=-(u*m+d*g+f*p),t[15]=1)}(this,e,n,r),this.check()}ortho(t){const{left:e,right:n,bottom:r,top:s,near:i=hn,far:o=ln}=t;return function(t,e,n,r,s,i,o){const a=1/(e-n),c=1/(r-s),h=1/(i-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*a,t[13]=(s+r)*c,t[14]=(o+i)*h,t[15]=1}(this,e,n,r,s,i,o),this.check()}orthographic(t){const{fovy:e=an,aspect:n=cn,focalDistance:r=1,near:s=hn,far:i=ln}=t;gn(e);const o=e/2,a=r*Math.tan(o),c=a*n;return this.ortho({left:-c,right:c,bottom:-a,top:a,near:s,far:i})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:r=.1,far:s=500}=t;return gn(e),function(t,e,n,r,s){const i=1/Math.tan(e/2);if(t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0){const e=1/(r-s);t[10]=(s+r)*e,t[14]=2*s*r*e}else t[10]=-1,t[14]=-2*r}(this,e,n,r,s),this.check()}determinant(){return function(t){const e=t[0],n=t[1],r=t[2],s=t[3],i=t[4],o=t[5],a=t[6],c=t[7],h=t[8],l=t[9],u=t[10],d=t[11],f=t[12],m=t[13],g=t[14],p=e*o-n*i,A=e*a-r*i,y=n*a-r*o,B=h*m-l*f,b=h*g-u*f,C=l*g-u*m;return c*(e*C-n*b+r*B)-s*(i*C-o*b+a*B)+t[15]*(h*y-l*A+u*p)-d*(f*y-m*A+g*p)}(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),r=1/n[0],s=1/n[1],i=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*s,t[2]=this[2]*i,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*s,t[6]=this[6]*i,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*s,t[10]=this[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),r=1/n[0],s=1/n[1],i=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*s,t[2]=this[2]*i,t[3]=this[4]*r,t[4]=this[5]*s,t[5]=this[6]*i,t[6]=this[8]*r,t[7]=this[9]*s,t[8]=this[10]*i,t}transpose(){return function(t,e){if(t===e){const n=e[1],r=e[2],s=e[3],i=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}invert(){return function(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],h=e[7],l=e[8],u=e[9],d=e[10],f=e[11],m=e[12],g=e[13],p=e[14],A=e[15],y=n*a-r*o,B=n*c-s*o,b=n*h-i*o,C=r*c-s*a,w=r*h-i*a,v=s*h-i*c,E=l*g-u*m,T=l*p-d*m,_=l*A-f*m,M=u*p-d*g,I=u*A-f*g,x=d*A-f*p;let S=y*x-B*I+b*M+C*_-w*T+v*E;S&&(S=1/S,t[0]=(a*x-c*I+h*M)*S,t[1]=(s*I-r*x-i*M)*S,t[2]=(g*v-p*w+A*C)*S,t[3]=(d*w-u*v-f*C)*S,t[4]=(c*_-o*x-h*T)*S,t[5]=(n*x-s*_+i*T)*S,t[6]=(p*b-m*v-A*B)*S,t[7]=(l*v-d*b+f*B)*S,t[8]=(o*I-a*_+h*E)*S,t[9]=(r*_-n*I-i*E)*S,t[10]=(m*w-g*b+A*y)*S,t[11]=(u*b-l*w-f*y)*S,t[12]=(a*T-o*M-c*E)*S,t[13]=(n*M-r*T+s*E)*S,t[14]=(g*B-m*C-p*y)*S,t[15]=(l*C-u*B+d*y)*S)}(this,this),this.check()}multiplyLeft(t){return sn(this,t,this),this.check()}multiplyRight(t){return sn(this,this,t),this.check()}rotateX(t){return function(t,e,n){const r=Math.sin(n),s=Math.cos(n),i=e[4],o=e[5],a=e[6],c=e[7],h=e[8],l=e[9],u=e[10],d=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*s+h*r,t[5]=o*s+l*r,t[6]=a*s+u*r,t[7]=c*s+d*r,t[8]=h*s-i*r,t[9]=l*s-o*r,t[10]=u*s-a*r,t[11]=d*s-c*r}(this,this,t),this.check()}rotateY(t){return function(t,e,n){const r=Math.sin(n),s=Math.cos(n),i=e[0],o=e[1],a=e[2],c=e[3],h=e[8],l=e[9],u=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s-h*r,t[1]=o*s-l*r,t[2]=a*s-u*r,t[3]=c*s-d*r,t[8]=i*r+h*s,t[9]=o*r+l*s,t[10]=a*r+u*s,t[11]=c*r+d*s}(this,this,t),this.check()}rotateZ(t){return function(t,e,n){const r=Math.sin(n),s=Math.cos(n),i=e[0],o=e[1],a=e[2],c=e[3],h=e[4],l=e[5],u=e[6],d=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s+h*r,t[1]=o*s+l*r,t[2]=a*s+u*r,t[3]=c*s+d*r,t[4]=h*s-i*r,t[5]=l*s-o*r,t[6]=u*s-a*r,t[7]=d*s-c*r}(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return function(t,e,n,r){let s,i,o,a,c,h,l,u,d,f,m,g,p,A,y,B,b,C,w,v,E,T,_,M,I=r[0],x=r[1],S=r[2],O=Math.sqrt(I*I+x*x+S*S);O<Me||(O=1/O,I*=O,x*=O,S*=O,i=Math.sin(n),s=Math.cos(n),o=1-s,a=e[0],c=e[1],h=e[2],l=e[3],u=e[4],d=e[5],f=e[6],m=e[7],g=e[8],p=e[9],A=e[10],y=e[11],B=I*I*o+s,b=x*I*o+S*i,C=S*I*o-x*i,w=I*x*o-S*i,v=x*x*o+s,E=S*x*o+I*i,T=I*S*o+x*i,_=x*S*o-I*i,M=S*S*o+s,t[0]=a*B+u*b+g*C,t[1]=c*B+d*b+p*C,t[2]=h*B+f*b+A*C,t[3]=l*B+m*b+y*C,t[4]=a*w+u*v+g*E,t[5]=c*w+d*v+p*E,t[6]=h*w+f*v+A*E,t[7]=l*w+m*v+y*E,t[8]=a*T+u*_+g*M,t[9]=c*T+d*_+p*M,t[10]=h*T+f*_+A*M,t[11]=l*T+m*_+y*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}scale(t){return function(t,e,n){const r=n[0],s=n[1],i=n[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return function(t,e,n){const r=n[0],s=n[1],i=n[2];let o,a,c,h,l,u,d,f,m,g,p,A;e===t?(t[12]=e[0]*r+e[4]*s+e[8]*i+e[12],t[13]=e[1]*r+e[5]*s+e[9]*i+e[13],t[14]=e[2]*r+e[6]*s+e[10]*i+e[14],t[15]=e[3]*r+e[7]*s+e[11]*i+e[15]):(o=e[0],a=e[1],c=e[2],h=e[3],l=e[4],u=e[5],d=e[6],f=e[7],m=e[8],g=e[9],p=e[10],A=e[11],t[0]=o,t[1]=a,t[2]=c,t[3]=h,t[4]=l,t[5]=u,t[6]=d,t[7]=f,t[8]=m,t[9]=g,t[10]=p,t[11]=A,t[12]=o*r+l*s+m*i+e[12],t[13]=a*r+u*s+g*i+e[13],t[14]=c*r+d*s+p*i+e[14],t[15]=h*r+f*s+A*i+e[15])}(this,this,t),this.check()}transform(t,e){return 4===t.length?(Ee(e=function(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3];return t[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*o,t[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*o,t[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*o,t[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*o,t}(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let r;switch(n){case 2:r=Se(e||[-0,-0],t,this);break;case 3:r=He(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ee(r,t.length),r}transformAsVector(t,e){let n;switch(t.length){case 2:n=Oe(e||[-0,-0],t,this);break;case 3:n=Re(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ee(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let fn,mn;function gn(t){if(t>2*Math.PI)throw Error("expected radians")}function pn(){const t=new Ie(4);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function An(t,e,n){n*=.5;const r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function yn(t,e,n){const r=e[0],s=e[1],i=e[2],o=e[3],a=n[0],c=n[1],h=n[2],l=n[3];return t[0]=r*l+o*a+s*h-i*c,t[1]=s*l+o*c+i*a-r*h,t[2]=i*l+o*h+r*c-s*a,t[3]=o*l-r*a-s*c-i*h,t}const Bn=function(){const t=Ge(),e=Ue(1,0,0),n=Ue(0,1,0);return function(r,s,i){const o=Ne(s,i);return o<-.999999?(Pe(t,e,s),ke(t)<1e-6&&Pe(t,n,s),function(t,e){const n=e[0],r=e[1],s=e[2];let i=n*n+r*r+s*s;i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}(t,t),An(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Pe(t,s,i),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,function(t,e){const n=e[0],r=e[1],s=e[2],i=e[3];let o=n*n+r*r+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=s*o,t[3]=i*o,t}(r,r))}}();pn(),pn(),function(){const t=new Ie(9);Ie!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1}();const bn=[0,0,0,1];class Cn extends we{constructor(t=0,e=0,n=0,r=1){super(-0,-0,-0,-0),Array.isArray(t)&&1===arguments.length?this.copy(t):this.set(t,e,n,r)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return function(t,e){const n=e[0]+e[4]+e[8];let r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,i=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*i+i]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+i]-e[3*i+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[i]=(e[3*i+n]+e[3*n+i])*r}}(this,t),this.check()}fromAxisRotation(t,e){return An(this,t,e),this.check()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=ve(t)}get y(){return this[1]}set y(t){this[1]=ve(t)}get z(){return this[2]}set z(t){this[2]=ve(t)}get w(){return this[3]}set w(t){this[3]=ve(t)}len(){return function(t){const e=t[0],n=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+n*n+r*r+s*s)}(this)}lengthSquared(){return function(t){const e=t[0],n=t[1],r=t[2],s=t[3];return e*e+n*n+r*r+s*s}(this)}dot(t){return function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}(this,t)}rotationTo(t,e){return Bn(this,t,e),this.check()}add(t){return function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3]}(this,this,t),this.check()}calculateW(){return function(t,e){const n=e[0],r=e[1],s=e[2];t[0]=n,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-s*s))}(this,this),this.check()}conjugate(){var t,e;return e=this,(t=this)[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],this.check()}invert(){return function(t,e){const n=e[0],r=e[1],s=e[2],i=e[3],o=n*n+r*r+s*s+i*i,a=o?1/o:0;t[0]=-n*a,t[1]=-r*a,t[2]=-s*a,t[3]=i*a}(this,this),this.check()}lerp(t,e,n){return void 0===n?this.lerp(this,t,e):(function(t,e,n,r){const s=e[0],i=e[1],o=e[2],a=e[3];t[0]=s+r*(n[0]-s),t[1]=i+r*(n[1]-i),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a)}(this,t,e,n),this.check())}multiplyRight(t){return yn(this,this,t),this.check()}multiplyLeft(t){return yn(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}rotateX(t){return function(t,e,n){n*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);t[0]=r*c+o*a,t[1]=s*c+i*a,t[2]=i*c-s*a,t[3]=o*c-r*a}(this,this,t),this.check()}rotateY(t){return function(t,e,n){n*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);t[0]=r*c-i*a,t[1]=s*c+o*a,t[2]=i*c+r*a,t[3]=o*c-s*a}(this,this,t),this.check()}rotateZ(t){return function(t,e,n){n*=.5;const r=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);t[0]=r*c+s*a,t[1]=s*c-r*a,t[2]=i*c+o*a,t[3]=o*c-i*a}(this,this,t),this.check()}scale(t){return function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n}(this,this,t),this.check()}slerp(t,e,n){let r,s,i;switch(arguments.length){case 1:({start:r=bn,target:s,ratio:i}=t);break;case 2:r=this,s=t,i=e;break;default:r=t,s=e,i=n}return function(t,e,n,r){const s=e[0],i=e[1],o=e[2],a=e[3];let c,h,l,u,d,f=n[0],m=n[1],g=n[2],p=n[3];c=s*f+i*m+o*g+a*p,c<0&&(c=-c,f=-f,m=-m,g=-g,p=-p),1-c>Me?(h=Math.acos(c),d=Math.sin(h),l=Math.sin((1-r)*h)/d,u=Math.sin(r*h)/d):(l=1-r,u=r),t[0]=l*s+u*f,t[1]=l*i+u*m,t[2]=l*o+u*g,t[3]=l*a+u*p}(this,r,s,i),this.check()}transformVector4(t,e=new ze){return function(t,e,n){const r=e[0],s=e[1],i=e[2],o=n[0],a=n[1],c=n[2],h=n[3],l=h*r+a*i-c*s,u=h*s+c*r-o*i,d=h*i+o*s-a*r,f=-o*r-a*s-c*i;t[0]=l*h+f*-o+u*-c-d*-a,t[1]=u*h+f*-a+d*-o-l*-c,t[2]=d*h+f*-c+l*-a-u*-o,t[3]=e[3]}(e,t,this),Ee(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}function wn(t){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vn(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=wn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=wn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==wn(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function En(t){return t}new qe;const Tn=new qe,_n={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Mn={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},In={east:new qe,north:new qe,up:new qe,west:new qe,south:new qe,down:new qe},xn=new qe,Sn=new qe,On=new qe;function Rn(t,e,n,r,s,i){const o=_n[e]&&_n[e][n];let a,c,h;Te(o&&(!r||r===o));const l=Tn.copy(s);if(be(l.x,0,1e-14)&&be(l.y,0,1e-14)){const t=Math.sign(l.z);a=xn.fromArray(Mn[e]),"east"!==e&&"west"!==e&&a.scale(t),c=Sn.fromArray(Mn[n]),"east"!==n&&"west"!==n&&c.scale(t),h=On.fromArray(Mn[r]),"east"!==r&&"west"!==r&&h.scale(t)}else{const{up:s,east:i,north:o}=In;i.set(-l.y,l.x,0).normalize(),t.geodeticSurfaceNormal(l,s),o.copy(s).cross(i);const{down:u,west:d,south:f}=In;u.copy(s).scale(-1),d.copy(i).scale(-1),f.copy(o).scale(-1),a=In[e],c=In[n],h=In[r]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=h.x,i[9]=h.y,i[10]=h.z,i[11]=0,i[12]=l.x,i[13]=l.y,i[14]=l.z,i[15]=1,i}const Fn=new qe,Dn=new qe,Gn=new qe,Ln=new qe,Un=new qe,Nn=new qe,Pn=new qe,Hn=new qe,Jn=new qe;class jn{constructor(t=0,e=0,n=0){vn(this,"radii",void 0),vn(this,"radiiSquared",void 0),vn(this,"radiiToTheFourth",void 0),vn(this,"oneOverRadii",void 0),vn(this,"oneOverRadiiSquared",void 0),vn(this,"minimumRadius",void 0),vn(this,"maximumRadius",void 0),vn(this,"centerToleranceSquared",.1),vn(this,"squaredXOverSquaredZ",void 0),Te(t>=0),Te(e>=0),Te(n>=0),this.radii=new qe(t,e,n),this.radiiSquared=new qe(t*t,e*e,n*n),this.radiiToTheFourth=new qe(t*t*t*t,e*e*e*e,n*n*n*n),this.oneOverRadii=new qe(0===t?0:1/t,0===e?0:1/e,0===n?0:1/n),this.oneOverRadiiSquared=new qe(0===t?0:1/(t*t),0===e?0:1/(e*e),0===n?0:1/(n*n)),this.minimumRadius=Math.min(t,e,n),this.maximumRadius=Math.max(t,e,n),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const n=Un,r=Nn,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,n),r.copy(this.radiiSquared).scale(n);const i=Math.sqrt(n.dot(r));return r.scale(1/i),n.scale(s),r.add(n),r.to(e)}cartesianToCartographic(t,e=[0,0,0]){Jn.from(t);const n=this.scaleToGeodeticSurface(Jn,Pn);if(!n)return;const r=this.geodeticSurfaceNormal(n,Un),s=Hn;return s.copy(Jn).subtract(n),function(t,e,n=En){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}([Math.atan2(r.y,r.x),Math.asin(r.z),Math.sign(Ne(s,Jn))*Le(s)],e,fe._cartographicRadians?En:Ae)}eastNorthUpToFixedFrame(t,e=new dn){return Rn(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,n,r,s=new dn){return Rn(this,t,e,n,r,s)}geocentricSurfaceNormal(t,e=[0,0,0]){return Ln.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const n=function(t,e=[]){return function(t,e=[],n=En){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}(t,e,fe._cartographicRadians?En:pe)}(t),r=n[0],s=n[1],i=Math.cos(s);return Ln.set(i*Math.cos(r),i*Math.sin(r),Math.sin(s)).normalize(),Ln.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return Ln.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return function(t,e,n=[]){const{oneOverRadii:r,oneOverRadiiSquared:s,centerToleranceSquared:i}=e;Fn.from(t);const o=Fn.x,a=Fn.y,c=Fn.z,h=r.x,l=r.y,u=r.z,d=o*o*h*h,f=a*a*l*l,m=c*c*u*u,g=d+f+m,p=Math.sqrt(1/g);if(!Number.isFinite(p))return;const A=Dn;if(A.copy(t).scale(p),g<i)return A.to(n);const y=s.x,B=s.y,b=s.z,C=Gn;C.set(A.x*y*2,A.y*B*2,A.z*b*2);let w,v,E,T,_=(1-p)*Fn.len()/(.5*C.len()),M=0;do{_-=M,w=1/(1+_*y),v=1/(1+_*B),E=1/(1+_*b);const t=w*w,e=v*v,n=E*E;T=d*t+f*e+m*n-1,M=T/(-2*(d*(t*w)*y+f*(e*v)*B+m*(n*E)*b))}while(Math.abs(T)>1e-12);return Fn.scale([w,v,E]).to(n)}(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){Pn.from(t);const n=Pn.x,r=Pn.y,s=Pn.z,i=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*i.x+r*r*i.y+s*s*i.z);return Pn.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return Pn.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return Pn.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,n=[0,0,0]){Te(be(this.radii.x,this.radii.y,1e-15)),Te(this.radii.z>0),Pn.from(t);const r=Pn.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-e))return Pn.set(0,0,r).to(n)}}vn(jn,"WGS84",new jn(6378137,6378137,6356752.314245179));class kn{constructor(t,e,n){this.item=void 0,this.previous=void 0,this.next=void 0,this.item=t,this.previous=e,this.next=n}}class Vn{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(t){const e=new kn(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const n=t.next;t.next=e,this.tail===t?this.tail=e:n.previous=e,e.next=n,e.previous=t,++this._length}}class Kn{constructor(){this._list=void 0,this._sentinel=void 0,this._trimTiles=void 0,this._list=new Vn,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,n){e._cacheNode||(e._cacheNode=this._list.add(e),n&&n(t,e))}unloadTile(t,e,n){const r=e._cacheNode;r&&(this._list.remove(r),e._cacheNode=null,n&&n(t,e))}unloadTiles(t,e){const n=this._trimTiles;this._trimTiles=!1;const r=this._list,s=1024*t.maximumMemoryUsage*1024,i=this._sentinel;let o=r.head;for(;o!==i&&(t.gpuMemoryUsageInBytes>s||n);){const n=o.item;o=o.next,this.unloadTile(t,n,e)}}trim(){this._trimTiles=!0}}new qe,new qe;const Qn=new qe,qn=new qe;class zn{constructor(t=[0,0,0],e=0){vn(this,"center",void 0),vn(this,"radius",void 0),this.radius=-0,this.center=new qe,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=Qn.from(e),this.center=(new qe).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new zn(this.center,this.radius)}union(t){const e=this.center,n=this.radius,r=t.center,s=t.radius,i=Qn.copy(r).subtract(e),o=i.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return t.clone();const a=.5*(n+o+s);return qn.copy(i).scale((-n+a)/o).add(e),this.center.copy(qn),this.radius=a,this}expand(t){const e=Qn.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=function(t,e){const n=e[0],r=e[1],s=e[2],i=e[4],o=e[5],a=e[6],c=e[8],h=e[9],l=e[10];return t[0]=Math.sqrt(n*n+r*r+s*s),t[1]=Math.sqrt(i*i+o*o+a*a),t[2]=Math.sqrt(c*c+h*h+l*l),t}(Qn,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=Qn.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,n=this.radius,r=t.normal.dot(e)+t.distance;return r<-n?-1:r<n?0:1}}const Wn=new qe,Xn=new qe,Yn=new qe,Zn=new qe,$n=new qe,tr=new qe,er=new qe;class nr{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){vn(this,"center",void 0),vn(this,"halfAxes",void 0),this.center=(new qe).from(t),this.halfAxes=new en(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new qe(t).len(),new qe(e).len(),new qe(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),r=new qe(t).normalize(),s=new qe(e).normalize(),i=new qe(n).normalize();return(new Cn).fromMatrix3(new en([...r,...s,...i]))}fromCenterHalfSizeQuaternion(t,e,n){const r=new Cn(n),s=(new en).fromQuaternion(r);return s[0]=s[0]*e[0],s[1]=s[1]*e[0],s[2]=s[2]*e[0],s[3]=s[3]*e[1],s[4]=s[4]*e[1],s[5]=s[5]*e[1],s[6]=s[6]*e[2],s[7]=s[7]*e[2],s[8]=s[8]*e[2],this.center=(new qe).from(t),this.halfAxes=s,this}clone(){return new nr(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new zn){const e=this.halfAxes,n=e.getColumn(0,Yn),r=e.getColumn(1,Zn),s=e.getColumn(2,$n),i=Wn.copy(n).add(r).add(s);return t.center.copy(this.center),t.radius=i.magnitude(),t}intersectPlane(t){const e=this.center,n=t.normal,r=this.halfAxes,s=n.x,i=n.y,o=n.z,a=Math.abs(s*r[0]+i*r[1]+o*r[2])+Math.abs(s*r[3]+i*r[4]+o*r[5])+Math.abs(s*r[6]+i*r[7]+o*r[8]),c=n.dot(e)+t.distance;return c<=-a?-1:c>=a?1:0}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=Xn.from(t).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,Yn),s=n.getColumn(1,Zn),i=n.getColumn(2,$n),o=r.magnitude(),a=s.magnitude(),c=i.magnitude();r.normalize(),s.normalize(),i.normalize();let h,l=0;return h=Math.abs(e.dot(r))-o,h>0&&(l+=h*h),h=Math.abs(e.dot(s))-a,h>0&&(l+=h*h),h=Math.abs(e.dot(i))-c,h>0&&(l+=h*h),l}computePlaneDistances(t,e,n=[-0,-0]){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const i=this.center,o=this.halfAxes,a=o.getColumn(0,Yn),c=o.getColumn(1,Zn),h=o.getColumn(2,$n),l=tr.copy(a).add(c).add(h).add(i),u=er.copy(l).subtract(t);let d=e.dot(u);return r=Math.min(d,r),s=Math.max(d,s),l.copy(i).add(a).add(c).subtract(h),u.copy(l).subtract(t),d=e.dot(u),r=Math.min(d,r),s=Math.max(d,s),l.copy(i).add(a).subtract(c).add(h),u.copy(l).subtract(t),d=e.dot(u),r=Math.min(d,r),s=Math.max(d,s),l.copy(i).add(a).subtract(c).subtract(h),u.copy(l).subtract(t),d=e.dot(u),r=Math.min(d,r),s=Math.max(d,s),i.copy(l).subtract(a).add(c).add(h),u.copy(l).subtract(t),d=e.dot(u),r=Math.min(d,r),s=Math.max(d,s),i.copy(l).subtract(a).add(c).subtract(h),u.copy(l).subtract(t),d=e.dot(u),r=Math.min(d,r),s=Math.max(d,s),i.copy(l).subtract(a).subtract(c).add(h),u.copy(l).subtract(t),d=e.dot(u),r=Math.min(d,r),s=Math.max(d,s),i.copy(l).subtract(a).subtract(c).subtract(h),u.copy(l).subtract(t),d=e.dot(u),r=Math.min(d,r),s=Math.max(d,s),n[0]=r,n[1]=s,n}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Yn);e.transformAsPoint(t);const n=this.halfAxes.getColumn(1,Zn);n.transformAsPoint(t);const r=this.halfAxes.getColumn(2,$n);return r.transformAsPoint(t),this.halfAxes=new en([...e,...n,...r]),this}getTransform(){throw new Error("not implemented")}}const rr=new qe,sr=new qe;class ir{constructor(t=[0,0,1],e=0){vn(this,"normal",void 0),vn(this,"distance",void 0),this.normal=new qe,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return Te(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=rr.from(t),this.normal.from(e).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,e,n,r){return this.normal.set(t,e,n),Te(be(this.normal.len(),1)),this.distance=r,this}clone(){return new ir(this.normal,this.distance)}equals(t){return be(this.distance,t.distance)&&be(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=sr.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,e)}projectPointOntoPlane(t,e=[0,0,0]){const n=rr.from(t),r=this.getPointDistance(n),s=sr.copy(this.normal).scale(r);return n.subtract(s).to(e)}}const or=[new qe([1,0,0]),new qe([0,1,0]),new qe([0,0,1])],ar=new qe,cr=new qe;class hr{constructor(t=[]){vn(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*or.length;const e=t.center,n=t.radius;let r=0;for(const t of or){let s=this.planes[r],i=this.planes[r+1];s||(s=this.planes[r]=new ir),i||(i=this.planes[r+1]=new ir);const o=ar.copy(t).scale(-n).add(e);s.fromPointNormal(o,t);const a=ar.copy(t).scale(n).add(e),c=cr.copy(t).negate();i.fromPointNormal(a,c),r+=2}return this}computeVisibility(t){let e=1;for(const n of this.planes)switch(t.intersectPlane(n)){case-1:return-1;case 0:e=0}return e}computeVisibilityWithPlaneMask(t,e){if(Te(Number.isFinite(e),"parentPlaneMask is required."),e===hr.MASK_OUTSIDE||e===hr.MASK_INSIDE)return e;let n=hr.MASK_INSIDE;const r=this.planes;for(let s=0;s<this.planes.length;++s){const i=s<31?1<<s:0;if(s<31&&0==(e&i))continue;const o=r[s],a=t.intersectPlane(o);if(-1===a)return hr.MASK_OUTSIDE;0===a&&(n|=i)}return n}}vn(hr,"MASK_OUTSIDE",4294967295),vn(hr,"MASK_INSIDE",0),vn(hr,"MASK_INDETERMINATE",2147483647);const lr=new qe,ur=new qe,dr=new qe,fr=new qe,mr=new qe;class gr{constructor(t={}){vn(this,"left",void 0),vn(this,"_left",void 0),vn(this,"right",void 0),vn(this,"_right",void 0),vn(this,"top",void 0),vn(this,"_top",void 0),vn(this,"bottom",void 0),vn(this,"_bottom",void 0),vn(this,"near",void 0),vn(this,"_near",void 0),vn(this,"far",void 0),vn(this,"_far",void 0),vn(this,"_cullingVolume",new hr([new ir,new ir,new ir,new ir,new ir,new ir])),vn(this,"_perspectiveMatrix",new dn),vn(this,"_infinitePerspective",new dn);const{near:e=1,far:n=5e8}=t;this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=e,this._near=e,this.far=n,this._far=n}clone(){return new gr({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof gr&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return this._update(),this._perspectiveMatrix}get infiniteProjectionMatrix(){return this._update(),this._infinitePerspective}computeCullingVolume(t,e,n){Te(t,"position is required."),Te(e,"direction is required."),Te(n,"up is required.");const r=this._cullingVolume.planes;n=lr.copy(n).normalize();const s=ur.copy(e).cross(n).normalize(),i=dr.copy(e).multiplyByScalar(this.near).add(t),o=fr.copy(e).multiplyByScalar(this.far).add(t);let a=mr;return a.copy(s).multiplyByScalar(this.left).add(i).subtract(t).cross(n),r[0].fromPointNormal(t,a),a.copy(s).multiplyByScalar(this.right).add(i).subtract(t).cross(n).negate(),r[1].fromPointNormal(t,a),a.copy(n).multiplyByScalar(this.bottom).add(i).subtract(t).cross(s).negate(),r[2].fromPointNormal(t,a),a.copy(n).multiplyByScalar(this.top).add(i).subtract(t).cross(s),r[3].fromPointNormal(t,a),a=(new qe).copy(e),r[4].fromPointNormal(i,a),a.negate(),r[5].fromPointNormal(o,a),this._cullingVolume}getPixelDimensions(t,e,n,r){this._update(),Te(Number.isFinite(t)&&Number.isFinite(e)),Te(t>0),Te(e>0),Te(n>0),Te(r);const s=1/this.near;let i=this.top*s;const o=2*n*i/e;i=this.right*s;const a=2*n*i/t;return r.x=a,r.y=o,r}_update(){Te(Number.isFinite(this.right)&&Number.isFinite(this.left)&&Number.isFinite(this.top)&&Number.isFinite(this.bottom)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const{top:t,bottom:e,right:n,left:r,near:s,far:i}=this;t===this._top&&e===this._bottom&&r===this._left&&n===this._right&&s===this._near&&i===this._far||(Te(this.near>0&&this.near<this.far,"near must be greater than zero and less than far."),this._left=r,this._right=n,this._top=t,this._bottom=e,this._near=s,this._far=i,this._perspectiveMatrix=(new dn).frustum({left:r,right:n,bottom:e,top:t,near:s,far:i}),this._infinitePerspective=(new dn).frustum({left:r,right:n,bottom:e,top:t,near:s,far:1/0}))}}class pr{constructor(t={}){vn(this,"_offCenterFrustum",new gr),vn(this,"fov",void 0),vn(this,"_fov",void 0),vn(this,"_fovy",void 0),vn(this,"_sseDenominator",void 0),vn(this,"aspectRatio",void 0),vn(this,"_aspectRatio",void 0),vn(this,"near",void 0),vn(this,"_near",void 0),vn(this,"far",void 0),vn(this,"_far",void 0),vn(this,"xOffset",void 0),vn(this,"_xOffset",void 0),vn(this,"yOffset",void 0),vn(this,"_yOffset",void 0);const{fov:e,aspectRatio:n,near:r=1,far:s=5e8,xOffset:i=0,yOffset:o=0}=t;this.fov=e,this.aspectRatio=n,this.near=r,this.far=s,this.xOffset=i,this.yOffset=o}clone(){return new pr({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return null!=t&&t instanceof pr&&(this._update(),t._update(),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return this._update(),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return this._update(),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return this._update(),this._fovy}get sseDenominator(){return this._update(),this._sseDenominator}computeCullingVolume(t,e,n){return this._update(),this._offCenterFrustum.computeCullingVolume(t,e,n)}getPixelDimensions(t,e,n,r){return this._update(),this._offCenterFrustum.getPixelDimensions(t,e,n,r||new De)}_update(){Te(Number.isFinite(this.fov)&&Number.isFinite(this.aspectRatio)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const t=this._offCenterFrustum;this.fov===this._fov&&this.aspectRatio===this._aspectRatio&&this.near===this._near&&this.far===this._far&&this.xOffset===this._xOffset&&this.yOffset===this._yOffset||(Te(this.fov>=0&&this.fov<Math.PI),Te(this.aspectRatio>0),Te(this.near>=0&&this.near<this.far),this._aspectRatio=this.aspectRatio,this._fov=this.fov,this._fovy=this.aspectRatio<=1?this.fov:2*Math.atan(Math.tan(.5*this.fov)/this.aspectRatio),this._near=this.near,this._far=this.far,this._sseDenominator=2*Math.tan(.5*this._fovy),this._xOffset=this.xOffset,this._yOffset=this.yOffset,t.top=this.near*Math.tan(.5*this._fovy),t.bottom=-t.top,t.right=this.aspectRatio*t.top,t.left=-t.right,t.near=this.near,t.far=this.far,t.right+=this.xOffset,t.left+=this.xOffset,t.top+=this.yOffset,t.bottom+=this.yOffset)}}new qe,new qe,new qe,new qe,new qe,new qe,new qe,new qe,new qe,new qe,new qe,new qe;const Ar=new en,yr=new en,Br=new en,br=new en,Cr=new en;const wr=[1,0,0],vr=[2,2,1];function Er(t){let e=0;for(let n=0;n<3;++n){const r=t[Ar.getElementIndex(vr[n],wr[n])];e+=2*r*r}return Math.sqrt(e)}function Tr(t,e){let n=0,r=1;for(let e=0;e<3;++e){const s=Math.abs(t[Ar.getElementIndex(vr[e],wr[e])]);s>n&&(r=e,n=s)}const s=wr[r],i=vr[r];let o=1,a=0;if(Math.abs(t[Ar.getElementIndex(i,s)])>1e-15){const e=(t[Ar.getElementIndex(i,i)]-t[Ar.getElementIndex(s,s)])/2/t[Ar.getElementIndex(i,s)];let n;n=e<0?-1/(-e+Math.sqrt(1+e*e)):1/(e+Math.sqrt(1+e*e)),o=1/Math.sqrt(1+n*n),a=n*o}return en.IDENTITY.to(e),e[Ar.getElementIndex(s,s)]=e[Ar.getElementIndex(i,i)]=o,e[Ar.getElementIndex(i,s)]=a,e[Ar.getElementIndex(s,i)]=-a,e}const _r=new qe,Mr=new qe,Ir=new qe,xr=new qe,Sr=new qe,Or=new en,Rr={diagonal:new en,unitary:new en},Fr=new qe,Dr=new qe,Gr=new hr([new ir,new ir,new ir,new ir,new ir,new ir]);function Lr(t,e){const{cameraDirection:n,cameraUp:r,height:s}=t,{metersPerUnit:i}=t.distanceScales,o=Nr(t,t.center),a=jn.WGS84.eastNorthUpToFixedFrame(o),c=t.unprojectPosition(t.cameraPosition),h=jn.WGS84.cartographicToCartesian(c,new qe),l=new qe(a.transformAsVector(new qe(n).scale(i))).normalize(),u=new qe(a.transformAsVector(new qe(r).scale(i))).normalize();!function(t){const e=t.getFrustumPlanes(),n=Ur(e.near,t.cameraPosition),r=Nr(t,n),s=Nr(t,t.cameraPosition,Dr);let i=0;Gr.planes[i++].fromPointNormal(r,Fr.copy(r).subtract(s));for(const s in e){if("near"===s)continue;const o=Nr(t,Ur(e[s],n,Dr),Dr);Gr.planes[i++].fromPointNormal(o,Fr.copy(r).subtract(o))}}(t);const d=t.constructor,{longitude:f,latitude:m,width:g,bearing:p,zoom:A}=t;return{camera:{position:h,direction:l,up:u},viewport:t,topDownViewport:new d({longitude:f,latitude:m,height:s,width:g,bearing:p,zoom:A,pitch:0}),height:s,cullingVolume:Gr,frameNumber:e,sseDenominator:1.15}}function Ur(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new qe;const r=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-r).add(e),n}function Nr(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new qe;const r=t.unprojectPosition(e);return jn.WGS84.cartographicToCartesian(r,n)}const Pr=6356752.314245179,Hr=new qe;function Jr(t,e,n){jn.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],Hr);const r=Math.sqrt(Math.pow(Hr[0]-n[0],2)+Math.pow(Hr[1]-n[1],2)+Math.pow(Hr[2]-n[2],2));return Math.log2(Pr/(r+e[2]))}let jr=((kr={})[kr.ADD=1]="ADD",kr[kr.REPLACE=2]="REPLACE",kr);var kr;let Vr=((Kr={}).EMPTY="empty",Kr.SCENEGRAPH="scenegraph",Kr.POINTCLOUD="pointcloud",Kr.MESH="mesh",Kr);var Kr;let Qr=((qr={}).I3S="I3S",qr.TILES3D="TILES3D",qr);var qr;let zr=((Wr={}).GEOMETRIC_ERROR="geometricError",Wr.MAX_SCREEN_THRESHOLD="maxScreenThreshold",Wr);var Wr;function Xr(t){return null!=t}const Yr=new qe,Zr=new qe,$r=new qe,ts=new qe,es=new qe,ns=new qe,rs=new qe,ss=new qe;function is(t,e,r){if(n(t,"3D Tile: boundingVolume must be defined"),t.box)return os(t.box,e,r);if(t.region)return function(t){const[e,n,r,s,i,o]=t,a=jn.WGS84.cartographicToCartesian([ye(e),ye(s),i],$r),c=jn.WGS84.cartographicToCartesian([ye(r),ye(n),o],ts),h=(new qe).addVectors(a,c).multiplyByScalar(.5);return jn.WGS84.cartesianToCartographic(h,es),jn.WGS84.cartographicToCartesian([ye(r),es[1],es[2]],ns),jn.WGS84.cartographicToCartesian([es[0],ye(s),es[2]],rs),jn.WGS84.cartographicToCartesian([es[0],es[1],o],ss),os([...h,...ns.subtract(h),...rs.subtract(h),...ss.subtract(h)],new dn)}(t.region);if(t.sphere)return function(t,e,n){const r=new qe(t[0],t[1],t[2]);e.transform(r,r);const s=e.getScale(Zr),i=Math.max(Math.max(s[0],s[1]),s[2]),o=t[3]*i;return Xr(n)?(n.center=r,n.radius=o,n):new zn(r,o)}(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function os(t,e,n){const r=new qe(t[0],t[1],t[2]);e.transform(r,r);let s=[];if(10===t.length){const e=t.slice(3,6),n=new Cn;n.fromArray(t,6);const r=new qe([1,0,0]),i=new qe([0,1,0]),o=new qe([0,0,1]);r.transformByQuaternion(n),r.scale(e[0]),i.transformByQuaternion(n),i.scale(e[1]),o.transformByQuaternion(n),o.scale(e[2]),s=[...r.toArray(),...i.toArray(),...o.toArray()]}else s=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const i=e.transformAsVector(s.slice(0,3)),o=e.transformAsVector(s.slice(3,6)),a=e.transformAsVector(s.slice(6,9)),c=new en([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return Xr(n)?(n.center=r,n.halfAxes=c,n):new nr(r,c)}function as(t,e){jn.WGS84.cartesianToCartographic(e,Yr),t[0][0]=Math.min(t[0][0],Yr[0]),t[0][1]=Math.min(t[0][1],Yr[1]),t[0][2]=Math.min(t[0][2],Yr[2]),t[1][0]=Math.max(t[1][0],Yr[0]),t[1][1]=Math.max(t[1][1],Yr[1]),t[1][2]=Math.max(t[1][2],Yr[2])}new qe,new qe,new dn,new qe,new qe,new qe;const cs=new qe,hs=new qe,ls=new qe,us=new qe,ds=new qe,fs=new dn,ms=new dn;function gs(t,e){const{topDownViewport:n}=e,r=t.header.mbs[1],s=t.header.mbs[0],i=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);jn.WGS84.cartographicToCartesian(c,cs),hs.copy(cs).subtract(a).normalize(),jn.WGS84.eastNorthUpToFixedFrame(a,fs),ms.copy(fs).invert(),ls.copy(cs).transform(ms);const h=Math.sqrt(ls[0]*ls[0]+ls[1]*ls[1]),l=h*h/ls[2];us.copy([ls[0],ls[1],l]);const u=us.transform(fs).subtract(a).normalize(),d=hs.cross(u).normalize().scale(o).add(a),f=jn.WGS84.cartesianToCartographic(d),m=n.project([s,r,i]),g=n.project(f);return ds.copy(m).subtract(g).magnitude()}class ps{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._map=new Map,this._array=void 0,this._length=void 0,this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return n(t<this._array.length),this._array[t]}set(t,e){n(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){n(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){n(t>=0),this.length=t}trim(t){null==t&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const As={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class ys{traversalFinished(t){return!0}constructor(t){this.options=void 0,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={},this.lastUpdate=(new Date).getTime(),this.updateDebounceTime=1e3,this._traversalStack=new ps,this._emptyTraversalStack=new ps,this._frameNumber=null,this.options={...As,...t}}traverse(t,e,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const t=n.pop();let r=!1;this.canTraverse(t,e)&&(this.updateChildTiles(t,e),r=this.updateAndPushChildren(t,e,n,t.hasRenderContent?t._selectionDepth+1:t._selectionDepth));const s=t.parent,i=Boolean(!s||s._shouldRefine),o=!r;t.hasRenderContent?t.refine===jr.ADD?(this.loadTile(t,e),this.selectTile(t,e)):t.refine===jr.REPLACE&&(this.loadTile(t,e),o&&this.selectTile(t,e)):(this.emptyTiles[t.id]=t,this.loadTile(t,e),o&&this.selectTile(t,e)),this.touchTile(t,e),t._shouldRefine=r&&i}const r=(new Date).getTime();(this.traversalFinished(e)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const n=t.children;for(const t of n)this.updateTile(t,e)}updateAndPushChildren(t,e,n,r){const{loadSiblings:s,skipLevelOfDetail:i}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const a=t.refine===jr.REPLACE&&t.hasRenderContent&&!i;let c=!1,h=!0;for(const t of o)if(t._selectionDepth=r,t.isVisibleAndInRequestVolume?(n.find(t)&&n.delete(t),n.push(t),c=!0):(a||s)&&(this.loadTile(t,e),this.touchTile(t,e)),a){let n;if(n=!!t._inRequestVolume&&(t.hasRenderContent?t.contentAvailable:this.executeEmptyTraversal(t,e)),h=h&&n,!h)return!1}return c||(h=!1),h}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:!(!r&&!t.isVisibleAndInRequestVolume)&&this.shouldRefine(t,e,n))}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t._screenSpaceError;return n&&(r=t.getScreenSpaceError(e,!0)),r>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,e){const n=[];if(this.options.viewportTraversersMap)for(const t in this.options.viewportTraversersMap)this.options.viewportTraversersMap[t]===e.viewport.id&&n.push(t);else n.push(e.viewport.id);t.updateVisibility(e,n)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let n=!1;for(const r of t.children)r.updateVisibility(e),n=n||r.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,e){let n=!0;const r=this._emptyTraversalStack;for(r.push(t);r.length>0;){const t=r.pop(),s=!t.hasRenderContent&&this.canTraverse(t,e,!1,!1),i=!t.hasRenderContent&&0===t.children.length;if(s||t.contentAvailable||i||(n=!1),this.updateTile(t,e),t.isVisibleAndInRequestVolume||(this.loadTile(t,e),this.touchTile(t,e)),s){const e=t.children;for(const t of e)r.push(t)}}return n}}const Bs=new qe;class bs{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.tileset=void 0,this.header=void 0,this.id=void 0,this.url=void 0,this.parent=void 0,this.refine=void 0,this.type=void 0,this.contentUrl=void 0,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=0,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.viewportIds=[],this.transform=new dn,this.extensions=null,this.implicitTiling=null,this.userData={},this.computedTransform=void 0,this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.traverser=new ys({}),this._cacheNode=null,this._frameNumber=null,this._expireDate=null,this._expiredContent=null,this._boundingBox=void 0,this._distanceToCamera=0,this._screenSpaceError=0,this._visibilityPlaneMask=void 0,this._visible=void 0,this._contentBoundingVolume=void 0,this._viewerRequestVolume=void 0,this._initialTransform=new dn,this._priority=0,this._selectedFrame=0,this._requestedFrame=0,this._selectionDepth=0,this._touchedFrame=0,this._centerZDepth=0,this._shouldRefine=!1,this._stackLength=0,this._visitedFrame=0,this._inRequestVolume=!1,this._lodJudge=null,this.header=e,this.tileset=t,this.id=r||e.id,this.url=e.url,this.parent=n,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return 3===this.contentState||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return 0===this.contentState}get contentExpired(){return 4===this.contentState}get contentFailed(){return 5===this.contentState}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=function(t,e){if(t.box)return function(t){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],{halfAxes:n}=t,r=new qe(n.getColumn(0)),s=new qe(n.getColumn(1)),i=new qe(n.getColumn(2));for(let n=0;n<2;n++){for(let n=0;n<2;n++){for(let n=0;n<2;n++)Yr.copy(t.center),Yr.add(r),Yr.add(s),Yr.add(i),as(e,Yr),i.negate();s.negate()}r.negate()}return e}(e);if(t.region){const[e,n,r,s,i,o]=t.region;return[[ye(e),ye(n),i],[ye(r),ye(s),o]]}if(t.sphere)return function(t){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],{center:n,radius:r}=t,s=jn.WGS84.scaleToGeodeticSurface(n,Yr);let i;i=s?jn.WGS84.geodeticSurfaceNormal(s):new qe(0,0,1);let o=new qe(i[2],-i[1],0);o.len()>0?o.normalize():o=new qe(0,1,0);const a=o.clone().cross(i);for(const t of[o,a,i]){Zr.copy(t).scale(r);for(let t=0;t<2;t++)Yr.copy(n),Yr.add(Zr),as(e,Yr),Zr.negate()}return e}(e);throw new Error("Unkown boundingVolume type")}(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case Qr.I3S:return gs(this,t);case Qr.TILES3D:return function(t,e,n){const r=t.tileset,s=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,i=n?s:t.lodMetricValue;if(0===i)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:c}=e,{viewDistanceScale:h}=r.options;let l=i*a*(h||1)/(o*c);return l-=function(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,r=t.dynamicScreenSpaceErrorFactor,s=function(t,e){const n=t*e;return 1-Math.exp(-n*n)}(e,n)*r;return s}return 0}(r,o),l}(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,n=this.refine===jr.ADD||e;if(n&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(0===this.contentState)return-1;const r=this.parent,s=!r||n&&0!==this._screenSpaceError&&!r.hasTilesetContent?this._screenSpaceError:r._screenSpaceError,i=t.root?t.root._screenSpaceError:0;return Math.max(i-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=1;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=0,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,r={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(n.id)}};return this.content=await le(e,n,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=3,this._onContentLoaded(),!0}catch(t){throw this.contentState=5,t}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=0,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const n=this.parent,r=n?n._visibilityPlaneMask:hr.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const t=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(t)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==hr.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:n}=t,{boundingVolume:r}=this;return n.computeVisibilityWithPlaneMask(r,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const n=this.boundingVolume;return Bs.subVectors(n.center,e.position),e.direction.dot(Bs)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=4,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new dn(t.transform):new dn;const e=this.parent,n=this.tileset,r=e&&e.computedTransform?e.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new dn(r).multiplyRight(this.transform);const s=e&&e._initialTransform?e._initialTransform.clone():new dn;this._initialTransform=new dn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=0,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=hr.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||jr.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=is(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=is(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=is(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dn).clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){return"i3s"===t?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:{assetGltfUpAxis:(e=this.tileset.tileset).asset&&e.asset.gltfUpAxis||"Y"};var e}}class Cs extends ys{compareDistanceToCamera(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const n=t.children[0];return this.updateTileVisibility(n,e),void(t._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))return void(t._visible=!1);const r=t.refine===jr.REPLACE,s=1===t._optimChildrenWithinParent;r&&s&&n&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}meetsScreenSpaceErrorEarly(t,e){const{parent:n}=t;return!(!n||n.hasTilesetContent||n.refine!==jr.ADD||this.shouldRefine(t,e,!0))}}class ws{constructor(){this.frameNumberMap=new Map}register(t,e){const n=this.frameNumberMap.get(t)||new Map,r=n.get(e)||0;n.set(e,r+1),this.frameNumberMap.set(t,n)}deregister(t,e){const n=this.frameNumberMap.get(t);if(!n)return;const r=n.get(e)||1;n.set(e,r-1)}isZero(t,e){var n;return 0===((null===(n=this.frameNumberMap.get(t))||void 0===n?void 0:n.get(e))||0)}}class vs{constructor(){this._statusMap=void 0,this.pendingTilesRegister=new ws,this._statusMap={}}add(t,e,n,r){if(!this._statusMap[e]){const{frameNumber:s,viewport:{id:i}}=r;this._statusMap[e]={request:t,callback:n,key:e,frameState:r,status:"REQUESTED"},this.pendingTilesRegister.register(i,s),t().then((t=>{this._statusMap[e].status="COMPLETED";const{frameNumber:n,viewport:{id:s}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(s,n),this._statusMap[e].callback(t,r)})).catch((t=>{this._statusMap[e].status="ERROR";const{frameNumber:r,viewport:{id:s}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(s,r),n(t)}))}}update(t,e){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,n);const{frameNumber:s,viewport:{id:i}}=e;this.pendingTilesRegister.register(i,s),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class Es extends ys{constructor(t){super(t),this._tileManager=void 0,this._tileManager=new vs}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=function(t,e){if(0===t.lodMetricValue||isNaN(t.lodMetricValue))return"DIG";const n=2*gs(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}updateChildTiles(t,e){const n=t.header.children||[],r=t.children,s=t.tileset;for(const i of n){const n=`${i.id}-${e.viewport.id}`,o=r&&r.find((t=>t.id===n));if(o)o&&this.updateTile(o,e);else{let r=()=>this._loadTile(i.id,s);this._tileManager.find(n)?this._tileManager.update(n,e):(s.tileset.nodePages&&(r=()=>s.tileset.nodePagesTile.formTileFromNodePages(i.id)),this._tileManager.add(r,n,(e=>this._onTileLoad(e,t,n)),e))}}return!1}async _loadTile(t,e){const{loader:n}=e,r=e.getTileUrl(`${e.url}/nodes/${t}`),s={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await le(r,n,s)}_onTileLoad(t,e,n){const r=new bs(e.tileset,t,e,n);e.children.push(r);const s=this._tileManager.find(r.id).frameState;this.updateTile(r,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,s)}}const Ts={description:"",ellipsoid:jn.WGS84,modelMatrix:new dn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},_s="Tiles In Tileset(s)",Ms="Tiles In Memory",Is="Tiles In View",xs="Tiles To Render",Ss="Tiles Loaded",Os="Tiles Loading",Rs="Tiles Unloaded",Fs="Failed Tile Loads",Ds="Points/Vertices",Gs="Tile Memory Use",Ls="Maximum Screen Space Error";class Us{constructor(t,e){this.options=void 0,this.loadOptions=void 0,this.type=void 0,this.tileset=void 0,this.loader=void 0,this.url=void 0,this.basePath=void 0,this.modelMatrix=void 0,this.ellipsoid=void 0,this.lodMetricType=void 0,this.lodMetricValue=void 0,this.refine=void 0,this.root=null,this.roots={},this.asset={},this.description="",this.properties=void 0,this.extras=null,this.attributions={},this.credits={},this.stats=void 0,this.contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.dynamicScreenSpaceErrorComputedDensity=0,this.maximumMemoryUsage=32,this.gpuMemoryUsageInBytes=0,this.memoryAdjustedScreenSpaceError=0,this._cacheBytes=0,this._cacheOverflowBytes=0,this._frameNumber=0,this._queryParams={},this._extensionsUsed=[],this._tiles={},this._pendingCount=0,this.selectedTiles=[],this.traverseCounter=0,this.geometricError=0,this.lastUpdatedVieports=null,this._requestedTiles=[],this._emptyTiles=[],this.frameStateData={},this._traverser=void 0,this._cache=new Kn,this._requestScheduler=void 0,this.updatePromise=null,this.tilesetInitializationPromise=void 0,this.options={...Ts,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||W(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new V({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=1024*this.options.maximumMemoryUsage*1024,this._cacheOverflowBytes=1024*this.options.memoryCacheOverflow*1024,this.stats=new j({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let e=t;return this.queryParams.length&&(e=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),e}hasExtension(t){return Boolean(this._extensionsUsed.indexOf(t)>-1)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tilesetInitializationPromise.then((()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)}))}async selectTiles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise((t=>{setTimeout((()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null}),this.options.debounceTime)}))),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const n=[];for(const t of e){const e=t.id;this._needTraverse(e)?n.push(e):this.traverseCounter--}for(const t of e){const e=t.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null)),!n.includes(e))continue;const r=Lr(t,this._frameNumber);this._traverser.traverse(this.roots[e],r,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[e],r=Object.values(this._traverser.selectedTiles),[s,i]=function(t,e,n){if(0===n||t.length<=n)return[t,[]];const r=[],{longitude:s,latitude:i}=e.viewport;for(const[e,n]of t.entries()){const[t,o]=n.header.mbs,a=Math.abs(s-t),c=Math.abs(i-o),h=Math.sqrt(c*c+a*a);r.push([e,h])}const o=r.sort(((t,e)=>t[1]-e[1])),a=[];for(let e=0;e<n;e++)a.push(t[o[e][0]]);const c=[];for(let e=n;e<o.length;e++)c.push(t[o[e][0]]);return[a,c]}(r,t,this.options.maximumTilesSelected);n.selectedTiles=s;for(const t of i)t.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const n=new Set(t.map((t=>t.id))),r=new Set(e.map((t=>t.id)));let s=t.filter((t=>!r.has(t.id))).length>0;return s=s||e.filter((t=>!n.has(t.id))).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,((t,e)=>t._unloadTile(e)))}_updateStats(){let t=0,e=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?e+=n.content.pointCount:e+=n.content.vertexCount);this.stats.get(Is).count=this.selectedTiles.length,this.stats.get(xs).count=t,this.stats.get(Ds).count=e,this.stats.get(Ls).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===Qr.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Qr.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Qr.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:t,xmax:n,ymin:r,ymax:s,zmin:i,zmax:o}=e;return this.cartographicCenter=new qe(t+(n-t)/2,r+(s-r)/2,i+(o-i)/2),this.cartesianCenter=new qe,jn.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=Jr(e,this.cartographicCenter,this.cartesianCenter))}const n=null===(t=this.tileset.store)||void 0===t?void 0:t.extent;if(n){const[t,e,r,s]=n;return this.cartographicCenter=new qe(t+(r-t)/2,e+(s-e)/2,0),this.cartesianCenter=new qe,jn.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=function(t,e,n){const[r,s,i,o]=t;return Jr({xmin:r,xmax:i,ymin:s,ymax:o,zmin:0,zmax:0},e,n)}(n,this.cartographicCenter,this.cartesianCenter))}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new qe,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new qe,void(this.zoom=1);0!==e[0]||0!==e[1]||0!==e[2]?(this.cartographicCenter=new qe,jn.WGS84.cartesianToCartographic(e,this.cartographicCenter)):this.cartographicCenter=new qe(0,0,-jn.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=function(t,e){if(t instanceof nr){const{halfAxes:n}=t,r=function(t){t.getColumn(0,Hr);const e=t.getColumn(1),n=t.getColumn(2);return Hr.add(e).add(n).len()}(n);return Math.log2(Pr/(r+e[2]))}if(t instanceof zn){const{radius:n}=t;return Math.log2(Pr/(n+e[2]))}if(t.width&&t.height){const{width:e,height:n}=t;return(Math.log2(6378137/e)+Math.log2(6378137/n))/2}return 1}(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(_s),this.stats.get(Os),this.stats.get(Ms),this.stats.get(Is),this.stats.get(xs),this.stats.get(Ss),this.stats.get(Rs),this.stats.get(Fs),this.stats.get(Ds),this.stats.get(Gs,"memory"),this.stats.get(Ls)}_initializeTileHeaders(t,e){const n=new bs(this,t.root,e);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===Qr.TILES3D){const t=[];for(t.push(n);t.length>0;){const e=t.pop();this.stats.get(_s).incrementCount();const n=e.header.children||[];for(const s of n){var r;const n=new bs(this,s,e);if(null!==(r=n.contentUrl)&&void 0!==r&&r.includes("?session=")){const t=new URL(n.contentUrl).searchParams.get("session");t&&(this._queryParams.session=t)}e.children.push(n),n.depth=e.depth+1,t.push(n)}}}return n}_initializeTraverser(){let t;switch(this.type){case Qr.TILES3D:t=Cs;break;case Qr.I3S:t=Es;break;default:t=ys}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(e){this._onTileLoadError(t,e instanceof Error?e:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(Fs).incrementCount();const n=e.message||e.toString(),r=t.url;console.error(`A 3D tile failed to load: ${t.url} ${n}`),this.options.onTileError(t,n,r)}_onTileLoad(t,e){if(e){if(this.type===Qr.I3S){var r,s;const t=(null===(r=this.tileset)||void 0===r||null===(s=r.nodePagesTile)||void 0===s?void 0:s.nodesInNodePages)||0;this.stats.get(_s).reset(),this.stats.get(_s).addCount(t)}t&&t.content&&function(t,e){n(t),n(e);const{rtcCenter:r,gltfUpAxis:s}=e,{computedTransform:i,boundingVolume:{center:o}}=t;let a=new dn(i);switch(r&&a.translate(r),s){case"Z":break;case"Y":const t=(new dn).rotateX(Math.PI/2);a=a.multiplyRight(t);break;case"X":const e=(new dn).rotateY(-Math.PI/2);a=a.multiplyRight(e)}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const c=new qe(o);e.cartesianModelMatrix=a,e.cartesianOrigin=c;const h=jn.WGS84.cartesianToCartographic(c,new qe),l=jn.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=l.multiplyRight(a),e.cartographicOrigin=h,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===Qr.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===Qr.TILES3D){var e;const{extensionsRemoved:n=[]}=(null===(e=t.content)||void 0===e?void 0:e.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Os).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Os).decrementCount()}_addTileToCache(t){this._cache.add(this,t,(e=>e._updateCacheStats(t)))}_updateCacheStats(t){this.stats.get(Ss).incrementCount(),this.stats.get(Ms).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(Gs).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(Ms).decrementCount(),this.stats.get(Rs).incrementCount(),this.stats.get(Gs).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const n of e.children)t.push(n);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,n=[];for(n.push(e);n.length>0;){t=n.pop();for(const e of t.children)n.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),n=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const Ns="4.1.1",Ps="cmpt",Hs="pnts",Js="b3dm",js="i3dm",ks="glTF";function Vs(t,e,r){n(t instanceof ArrayBuffer);const s=new TextDecoder("utf8"),i=new Uint8Array(t,e,r);return s.decode(i)}function Ks(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=new DataView(t);return`${String.fromCharCode(n.getUint8(e+0))}${String.fromCharCode(n.getUint8(e+1))}${String.fromCharCode(n.getUint8(e+2))}${String.fromCharCode(n.getUint8(e+3))}`}const Qs={name:"Draco",id:"draco",module:"draco",version:"4.1.1",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function qs(t,e,n){return function(t,e,n){const r=function(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}(e.value),s=n||function(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:s}}(t,e,n?zs(n.metadata):void 0)}function zs(t){Object.entries(t);const e={};for(const n in t)e[`${n}.string`]=JSON.stringify(t[n]);return e}const Ws={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Xs={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class Ys{constructor(t){this.draco=void 0,this.decoder=void 0,this.metadataQuerier=void 0,this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const r=this.decoder.GetEncodedGeometryType(n),s=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let t;switch(r){case this.draco.TRIANGULAR_MESH:t=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:t=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!t.ok()||!s.ptr){const e=`DRACO decompression failed: ${t.error_msg()}`;throw new Error(e)}const i=this._getDracoLoaderData(s,r,e),o=this._getMeshData(s,i,e),a=function(t){let e=1/0,n=1/0,r=1/0,s=-1/0,i=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],c=a&&a.length;for(let t=0;t<c;t+=3){const c=a[t],h=a[t+1],l=a[t+2];e=c<e?c:e,n=h<n?h:n,r=l<r?l:r,s=c>s?c:s,i=h>i?h:i,o=l>o?l:o}return[[e,n,r],[s,i,o]]}(o.attributes),c=function(t,e,n){const r=zs(e.metadata),s=[],i=function(t){const e={};for(const n in t){const r=t[n];e[r.name||"undefined"]=r}return e}(e.attributes);for(const e in t){const n=qs(e,t[e],i[e]);s.push(n)}if(n){const t=qs("indices",n);s.push(t)}return{fields:s,metadata:r}}(o.attributes,i,o.indices);return{loader:"draco",loaderData:i,header:{vertexCount:s.num_points(),boundingBox:a},...o,schema:c}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,e,n){const r=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,n);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:r,attributes:s}}_getDracoAttributes(t,e){const n={};for(let r=0;r<t.num_attributes();r++){const s=this.decoder.GetAttribute(t,r),i=this._getAttributeMetadata(t,r);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:r,metadata:i};const o=this._getQuantizationTransform(s,e);o&&(n[s.unique_id()].quantization_transform=o);const a=this._getOctahedronTransform(s,e);a&&(n[s.unique_id()].octahedron_transform=a)}return n}_getMeshData(t,e,n){const r=this._getMeshAttributes(e,t,n);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");return t instanceof this.draco.Mesh?"triangle-strip"===n.topology?{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(t),size:1}}:{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(t),size:1}}:{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(t,e,n){const r={};for(const s of Object.values(t.attributes)){const t=this._deduceAttributeName(s,n);s.name=t;const{value:i,size:o}=this._getAttributeValues(e,s);r[t]={value:i,size:o,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return r}_getTriangleListIndices(t){const e=3*t.num_faces(),n=4*e,r=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(t,n,r),new Uint32Array(this.draco.HEAPF32.buffer,r,e).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),function(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const n=Xs[e.data_type],r=e.num_components,s=t.num_points()*r,i=s*n.BYTES_PER_ELEMENT,o=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}(this.draco,n);let a;const c=this.draco._malloc(i);try{const r=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,r,o,i,c),a=new n(this.draco.HEAPF32.buffer,c,s).slice()}finally{this.draco._free(c)}return{value:a,size:r}}_deduceAttributeName(t,e){const n=t.unique_id;for(const[t,r]of Object.entries(e.extraAttributes||{}))if(r===n)return t;const r=t.attribute_type;for(const t in Ws)if(this.draco[t]===r)return Ws[t];const s=e.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const n=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},n=this.metadataQuerier.NumEntries(t);for(let r=0;r<n;r++){const n=this.metadataQuerier.GetEntryName(t,r);e[n]=this._getDracoMetadataField(t,n)}return e}_getDracoMetadataField(t,e){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,n);const r=function(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}(n);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:r}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:n=[]}=t,r=[...e,...n];for(const t of r)this.decoder.SkipAttributeTransform(this.draco[t])}_getQuantizationTransform(t,e){const{quantizedAttributes:n=[]}=e,r=t.attribute_type();if(n.map((t=>this.decoder[t])).includes(r)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits(),range:e.range(),min_values:new Float32Array([1,2,3]).map((t=>e.min_value(t)))}}finally{this.draco.destroy(e)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:n=[]}=e,r=t.attribute_type();if(n.map((t=>this.decoder[t])).includes(r)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits()}}finally{this.draco.destroy(e)}}return null}}const Zs="https://www.gstatic.com/draco/versioned/decoders/1.5.6",$s="draco_wasm_wrapper.js",ti="draco_decoder.wasm",ei="draco_decoder.js",ni="draco_encoder.js",ri={[$s]:`${Zs}/draco_wasm_wrapper.js`,[ti]:`${Zs}/draco_decoder.wasm`,[ei]:`${Zs}/draco_decoder.js`,[ni]:"https://raw.githubusercontent.com/google/draco/1.4.1/javascript/draco_encoder.js"};let si;const ii={...Qs,parse:async function(t,e){const{draco:n}=await async function(t){const e=t.modules||{};return si=e.draco3d?si||e.draco3d.createDecoderModule({}).then((t=>({draco:t}))):si||async function(t){let e,n;return"js"===(t.draco&&t.draco.decoderType)?e=await S(ri["draco_decoder.js"],"draco",t,ei):[e,n]=await Promise.all([await S(ri["draco_wasm_wrapper.js"],"draco",t,$s),await S(ri["draco_decoder.wasm"],"draco",t,ti)]),e=e||globalThis.DracoDecoderModule,await function(t,e){const n={};return e&&(n.wasmBinary=e),new Promise((e=>{t({...n,onModuleLoaded:t=>e({draco:t})})}))}(e,n)}(t),await si}(e),r=new Ys(n);try{return r.parseSync(t,null==e?void 0:e.draco)}finally{r.destroy()}}},oi={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ai={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...oi},ci={[oi.DOUBLE]:Float64Array,[oi.FLOAT]:Float32Array,[oi.UNSIGNED_SHORT]:Uint16Array,[oi.UNSIGNED_INT]:Uint32Array,[oi.UNSIGNED_BYTE]:Uint8Array,[oi.BYTE]:Int8Array,[oi.SHORT]:Int16Array,[oi.INT]:Int32Array},hi={DOUBLE:oi.DOUBLE,FLOAT:oi.FLOAT,UNSIGNED_SHORT:oi.UNSIGNED_SHORT,UNSIGNED_INT:oi.UNSIGNED_INT,UNSIGNED_BYTE:oi.UNSIGNED_BYTE,BYTE:oi.BYTE,SHORT:oi.SHORT,INT:oi.INT},li="Failed to convert GL type";class ui{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in ci)if(ci[e]===t)return e;throw new Error(li)}static fromName(t){const e=hi[t];if(!e)throw new Error(li);return e}static getArrayType(t){switch(t){case oi.UNSIGNED_SHORT_5_6_5:case oi.UNSIGNED_SHORT_4_4_4_4:case oi.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=ci[t];if(!e)throw new Error(li);return e}}static getByteSize(t){return ui.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(ui.getArrayType(t))}static createTypedArray(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;return void 0===r&&(r=(e.byteLength-n)/ui.getByteSize(t)),new(ui.getArrayType(t))(e,n,r)}}function di(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];const n=t>>11&31,r=t>>5&63,s=31&t;return e[0]=n<<3,e[1]=r<<2,e[2]=s<<3,e}function fi(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Be(t,0,e)/e*2-1}function mi(t){return t<0?-1:1}function gi(t,e,n,r){if(function(t,e){if(!t)throw new Error("math.gl assertion failed. undefined")}(r),t<0||t>n||e<0||e>n)throw new Error(`x and y must be unsigned normalized integers between 0 and ${n}`);if(r.x=fi(t,n),r.y=fi(e,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const t=r.x;r.x=(1-Math.abs(r.y))*mi(t),r.y=(1-Math.abs(t))*mi(r.y)}return r.normalize()}new De,new qe,new De,new De;class pi{constructor(t,e){this.json=void 0,this.buffer=void 0,this.featuresLength=0,this._cachedTypedArrays={},this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ai.UNSIGNED_INT,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(t,e,n,1,r.byteOffset):r}getPropertyArray(t,e,n){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(e=ui.fromName(r.componentType)),this._getTypedArrayFromBinary(t,e,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(t,e,r)}getProperty(t,e,n,r,s){const i=this.json[t];if(!i)return i;const o=this.getPropertyArray(t,e,n);if(1===n)return o[r];for(let t=0;t<n;++t)s[t]=o[n*r+t];return s}_getTypedArrayFromBinary(t,e,n,r,s){const i=this._cachedTypedArrays;let o=i[t];return o||(o=ui.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+s,r*n),i[t]=o),o}_getTypedArrayFromArray(t,e,n){const r=this._cachedTypedArrays;let s=r[t];return s||(s=ui.createTypedArray(e,n),r[t]=s),s}}const Ai={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yi={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Bi={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}},bi=t=>void 0!==t;function Ci(t,e,n){if(!t)return;const r=t.parentCounts;return t.parentIds?n(t,e):r>0?function(t,e,n){const r=t.classIds,s=t.parentCounts,i=t.parentIds,o=t.parentIndexes,a=r.length,c=scratchVisited;c.length=Math.max(c.length,a);const h=++marker,l=scratchStack;for(l.length=0,l.push(e);l.length>0;){if(c[e=l.pop()]===h)continue;c[e]=h;const r=n(t,e);if(bi(r))return r;const a=s[e],u=o[e];for(let t=0;t<a;++t){const n=i[u+t];n!==e&&l.push(n)}}return null}(t,e,n):function(t,e,n){let r=!0;for(;r;){const s=n(t,e);if(bi(s))return s;const i=t.parentIds[e];r=i!==e,e=i}throw new Error("traverseHierarchySingleParent")}(t,e,n)}function wi(t,e,n){const r=t.parentCounts,s=t.parentIds,i=t.parentIndexes,o=t.classIds.length;if(!bi(s))return;assert(e<o,`Parent index ${e} exceeds the total number of instances: ${o}`),assert(-1===n.indexOf(e),"Circular dependency detected in the batch table hierarchy."),n.push(e);const a=bi(r)?r[e]:1,c=bi(r)?i[e]:e;for(let r=0;r<a;++r){const i=s[c+r];i!==e&&wi(t,i,n)}n.pop(e)}function vi(t){return null!=t}const Ei=(t,e)=>t,Ti={HIERARCHY:!0,extensions:!0,extras:!0};class _i{constructor(t,e,r){var s;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.json=void 0,this.binary=void 0,this.featureCount=void 0,this._extensions=void 0,this._properties=void 0,this._binaryProperties=void 0,this._hierarchy=void 0,n(r>=0),this.json=t||{},this.binary=e,this.featureCount=r,this._extensions=(null===(s=this.json)||void 0===s?void 0:s.extensions)||{},this._properties={};for(const t in this.json)Ti[t]||(this._properties[t]=this.json[t]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=function(t,e,n){if(!e)return null;let r=t.getExtension("3DTILES_batch_table_hierarchy");const s=e.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=s,r=s),r?function(t,e){let n,r,s;const i=t.instancesLength,o=t.classes;let a,c=t.classIds,h=t.parentCounts,l=t.parentIds,u=i;if(bi(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,i)),bi(h))for(bi(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,s=getBinaryAccessor(h),h=s.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,i)),a=new Uint16Array(i),u=0,n=0;n<i;++n)a[n]=u,u+=h[n];bi(l)&&bi(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,u));const d=o.length;for(n=0;n<d;++n){const t=o[n].length,r=o[n].instances,s=getBinaryProperties(t,r,e);o[n].instances=combine(s,r)}const f=new Array(d).fill(0),m=new Uint16Array(i);for(n=0;n<i;++n)r=c[n],m[n]=f[r],++f[r];const g={classes:o,classIds:c,classIndexes:m,parentCounts:h,parentIndexes:a,parentIds:l};return function(t){const e=t.classIds.length;for(let n=0;n<e;++n)wi(t,n,stack)}(g),g}(r,n):null}(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){return this._checkBatchId(t),n("string"==typeof e,e),!!this._hierarchy&&vi(Ci(this._hierarchy,t,((t,n)=>{const r=t.classIds[n];return t.classes[r].name===e})))}isExactClass(t,e){return n("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),n("string"==typeof e,e),vi(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=vi(e)?e:[]).length=0;const n=Object.keys(this._properties);return e.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),n("string"==typeof e,e),this._binaryProperties){const n=this._binaryProperties[e];if(vi(n))return this._getBinaryProperty(n,t)}const r=this._properties[e];if(vi(r))return Ei(r[t]);if(this._hierarchy){const n=this._getHierarchyProperty(t,e);if(vi(n))return n}}setProperty(t,e,r){const s=this.featureCount;if(this._checkBatchId(t),n("string"==typeof e,e),this._binaryProperties){const n=this._binaryProperties[e];if(n)return void this._setBinaryProperty(n,t,r)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,r))return;let i=this._properties[e];vi(i)||(this._properties[e]=new Array(s),i=this._properties[e]),i[t]=Ei(r)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,n){t.pack(n,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const n=this._properties[e],r=this._initializeBinaryProperty(e,n);r&&(t=t||{},t[e]=r)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const r=e;n(this.binary,`Property ${t} requires a batch table binary.`),n(r.type,`Property ${t} requires a type.`);const s=function(t,e,r,s){const{componentType:i}=t;n(t.componentType);const o="string"==typeof i?ui.fromName(i):i,a=Ai[t.type],c=yi[t.type],h=Bi[t.type];return r+=t.byteOffset,{values:ui.createTypedArray(o,e,r,a*s),type:o,size:a,unpacker:c,packer:h}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const n=Ci(this._hierarchy,t,((t,n)=>{const r=t.classIds[n];return vi(t.classes[r].instances[e])}));return vi(n)}_getPropertyNamesInHierarchy(t,e){Ci(this._hierarchy,t,((t,n)=>{const r=t.classIds[n],s=t.classes[r].instances;for(const t in s)s.hasOwnProperty(t)&&-1===e.indexOf(t)&&e.push(t)}))}_getHierarchyProperty(t,e){return Ci(this._hierarchy,t,((t,n)=>{const r=t.classIds[n],s=t.classes[r],i=t.classIndexes[n],o=s.instances[e];return vi(o)?vi(o.typedArray)?this._getBinaryProperty(o,i):Ei(o[i]):null}))}_setHierarchyProperty(t,e,r,s){const i=Ci(this._hierarchy,e,((t,i)=>{const o=t.classIds[i],a=t.classes[o],c=t.classIndexes[i],h=a.instances[r];return!!vi(h)&&(n(i===e,`Inherited property "${r}" is read-only.`),vi(h.typedArray)?this._setBinaryProperty(h,c,s):h[c]=Ei(s),!0)}));return vi(i)}}function Mi(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=new DataView(e);if(t.magic=r.getUint32(n,!0),n+=4,t.version=r.getUint32(n,!0),n+=4,t.byteLength=r.getUint32(n,!0),n+=4,1!==t.version)throw new Error(`3D Tile Version ${t.version} not supported`);return n}const Ii="b3dm tile in legacy format.";function xi(t,e,n){const r=new DataView(e);let s;t.header=t.header||{};let i=r.getUint32(n,!0);n+=4;let o=r.getUint32(n,!0);n+=4;let a=r.getUint32(n,!0);n+=4;let c=r.getUint32(n,!0);return n+=4,a>=570425344?(n-=8,s=i,a=o,c=0,i=0,o=0,console.warn(Ii)):c>=570425344&&(n-=4,s=a,a=i,c=o,i=0,o=0,console.warn(Ii)),t.header.featureTableJsonByteLength=i,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=c,t.header.batchLength=s,n}function Si(t,e,n,r){return n=function(t,e,n,r){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:i,batchLength:o}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:o||0},s&&s>0){const r=Vs(e,n,s);t.featureTableJson=JSON.parse(r)}return n+=s||0,t.featureTableBinary=new Uint8Array(e,n,i),n+(i||0)}(t,e,n),n=function(t,e,n,r){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:i}=t.header||{};if(s&&s>0){const r=Vs(e,n,s);t.batchTableJson=JSON.parse(r),n+=s,i&&i>0&&(t.batchTableBinary=new Uint8Array(e,n,i),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=i)}return n}(t,e,n),n}function Oi(t,e,n){if(!(e||t&&t.batchIds&&n))return null;const{batchIds:r,isRGB565:s,pointCount:i=0}=t;if(r&&n){const t=new Uint8ClampedArray(3*i);for(let e=0;e<i;e++){const s=r[e],i=n.getProperty(s,"dimensions").map((t=>255*t));t[3*e]=i[0],t[3*e+1]=i[1],t[3*e+2]=i[2]}return{type:ai.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(e&&s){const t=new Uint8ClampedArray(3*i);for(let n=0;n<i;n++){const r=di(e[n]);t[3*n]=r[0],t[3*n+1]=r[1],t[3*n+2]=r[2]}return{type:ai.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*i?{type:ai.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:ai.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const Ri=new qe;async function Fi(t,n,r,s,i){r=Si(t,n,r=xi(t,n,r=Mi(t,n,r))),function(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}(t);const{featureTable:o,batchTable:a}=function(t){const e=new pi(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",ai.FLOAT,3);const r=function(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",ai.UNSIGNED_SHORT,1),t.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:i}=t;n=new _i(s,i,r)}return n}(t,e);return{featureTable:e,batchTable:r}}(t);return await async function(t,n,r,s,i){let o,a,c;const h=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(c=h.properties);const l=n.getExtension("3DTILES_draco_point_compression");if(l){a=l.properties;const e=l.byteOffset,n=l.byteLength;if(!a||!Number.isFinite(e)||!n)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=(t.featureTableBinary||[]).slice(e,e+n),t.hasPositions=Number.isFinite(a.POSITION),t.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),t.hasNormals=Number.isFinite(a.NORMAL),t.hasBatchIds=Number.isFinite(a.BATCH_ID),t.isTranslucent=Number.isFinite(a.RGBA)}if(!o)return!0;const u={buffer:o,properties:{...a,...c},featureTableProperties:a,batchTableProperties:c,dequantizeInShader:!1};return await async function(t,n,r,s){if(!s)return;const i={...r,draco:{...null==r?void 0:r.draco,extraAttributes:n.batchTableProperties||{}}};delete i["3d-tiles"];const o=await e(n.buffer,ii,i,s),a=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,h=o.attributes.NORMAL&&o.attributes.NORMAL.value,l=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,u=a&&o.attributes.POSITION.value.quantization,d=h&&o.attributes.NORMAL.value.quantization;if(u){const e=o.POSITION.data.quantization,n=e.range;t.quantizedVolumeScale=new qe(n,n,n),t.quantizedVolumeOffset=new qe(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}d&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const f={};if(n.batchTableProperties)for(const t of Object.keys(n.batchTableProperties))o.attributes[t]&&o.attributes[t].value&&(f[t.toLowerCase()]=o.attributes[t].value);t.attributes={positions:a,colors:Oi(t,c,void 0),normals:h,batchIds:l,...f}}(t,u,s,i)}(t,o,0,s,i),function(t,e,n){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",ai.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",ai.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ai.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ai.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=function(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const n=new qe,r=new Float32Array(3*t.pointCount);for(let s=0;s<t.pointCount;s++)n.set(e[3*s],e[3*s+1],e[3*s+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,3*s);return r}(t,e)):{type:ai.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}(t,r,n)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,o,s),function(t,e,n){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",ai.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",ai.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",ai.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=Oi(t,r,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",ai.UNSIGNED_BYTE,4))}(t,o,a),function(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",ai.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",ai.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(3*(t.pointsLength||0));for(let r=0;r<(t.pointsLength||0);r++)gi(e[2*r],e[2*r+1],255,Ri),Ri.toArray(n,3*r);return{type:ai.FLOAT,size:2,value:n}}return{type:ai.FLOAT,size:2,value:e}}(t,n)}}(t,o),r}var Di;const Gi=null===(Di=globalThis.loaders)||void 0===Di?void 0:Di.parseImageNode,Li="undefined"!=typeof Image,Ui="undefined"!=typeof ImageBitmap,Ni=Boolean(Gi),Pi=!!i||Ni;function Hi(t){switch(function(t){const e=function(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null}(t);if(!e)throw new Error("Not an image");return e}(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}const Ji=/^data:image\/svg\+xml/,ji=/\.svg((\?|#).*)?$/;function ki(t){return t&&(Ji.test(t)||ji.test(t))}function Vi(t,e){if(ki(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Ki(t,e,n){const r=function(t,e){if(ki(e)){let e=(new TextDecoder).decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(t){throw new Error(t.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return Vi(t,e)}(t,n),s=self.URL||self.webkitURL,i="string"!=typeof r&&s.createObjectURL(r);try{return await async function(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise(((t,e)=>{try{n.onload=()=>t(n),n.onerror=t=>{const n=t instanceof Error?t.message:"error";e(new Error(n))}}catch(t){e(t)}}))}(i||r,e)}finally{i&&s.revokeObjectURL(i)}}const Qi={};let qi=!0;function zi(t){for(const e in t||Qi)return!1;return!0}function Wi(t){return[...t].map((t=>t.charCodeAt(0)))}const Xi=!1,Yi=!0;function Zi(t){const e=$i(t);return function(t){const e=$i(t);return e.byteLength>=24&&2303741511===e.getUint32(0,Xi)?{mimeType:"image/png",width:e.getUint32(16,Xi),height:e.getUint32(20,Xi)}:null}(e)||function(t){const e=$i(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,Xi)&&255===e.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:r}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let s=2;for(;s+9<e.byteLength;){const t=e.getUint16(s,Xi);if(r.has(t))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Xi),width:e.getUint16(s+7,Xi)};if(!n.has(t))return null;s+=2,s+=e.getUint16(s,Xi)}return null}(e)||function(t){const e=$i(t);return e.byteLength>=10&&1195984440===e.getUint32(0,Xi)?{mimeType:"image/gif",width:e.getUint16(6,Yi),height:e.getUint16(8,Yi)}:null}(e)||function(t){const e=$i(t);return e.byteLength>=14&&16973===e.getUint16(0,Xi)&&e.getUint32(2,Yi)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Yi),height:e.getUint32(22,Yi)}:null}(e)||function(t){const e=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Wi(e);for(let e=0;e<r.length;++e)if(r[e]!==t[e+n])return!1;return!0}(n=new Uint8Array(t instanceof DataView?t.buffer:t),"ftyp",4)?0==(96&n[8])?null:function(t){switch((e=t,String.fromCharCode(...e.slice(8,12))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var e}(n):null;var n;return e?{mimeType:e.mimeType,width:0,height:0}:null}(e)}function $i(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}const to={id:"image",module:"images",name:"Images",version:"4.1.1",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(t,e,r){const s=((e=e||{}).image||{}).type||"auto",{url:i}=r||{};let o;switch(function(t){switch(t){case"auto":case"data":return function(){if(Ui)return"imagebitmap";if(Li)return"image";if(Pi)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return Ui||Li||Pi;case"imagebitmap":return Ui;case"image":return Li;case"data":return Pi;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}(t),t}}(s)){case"imagebitmap":o=await async function(t,e,n){let r;r=ki(n)?await Ki(t,e,n):Vi(t,n);const s=e&&e.imagebitmap;return await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!zi(e)&&qi||(e=null),e)try{return await createImageBitmap(t,e)}catch(t){console.warn(t),qi=!1}return await createImageBitmap(t)}(r,s)}(t,e,i);break;case"image":o=await Ki(t,e,i);break;case"data":o=await async function(t,e){var r;const{mimeType:s}=Zi(t)||{},i=null===(r=globalThis.loaders)||void 0===r?void 0:r.parseImageNode;return n(i),await i(t,s)}(t);break;default:n(!1)}return"data"===s&&(o=Hi(o)),o},tests:[t=>Boolean(Zi(new DataView(t)))],options:{image:{type:"auto",decode:!0}}},eo={};function no(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const ro={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},so={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},io=["SCALAR","VEC2","VEC3","VEC4"],oo=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ao=new Map(oo),co={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ho={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},lo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function uo(t){return io[t-1]||io[0]}function fo(t){const e=ao.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function mo(t,e){const n=lo[t.componentType],r=co[t.type],s=ho[t.componentType],i=t.count*r,o=t.count*r*s;return no(o>=0&&o<=e.byteLength),{ArrayType:n,length:i,byteLength:o,componentByteSize:so[t.componentType],numberOfComponentsInElement:ro[t.type]}}function go(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const r=e.map((t=>t.bufferView));n=n.filter((t=>!r.includes(t)));const s=n.reduce(((t,e)=>t+e.byteLength),0),i=e.reduce(((t,e)=>{const{width:n,height:r}=e.image;return t+n*r}),0);return s+Math.ceil(4*i*1.33)}class po{constructor(t){this.gltf=void 0,this.sourceBuffers=void 0,this.byteLength=void 0,this.gltf={json:(null==t?void 0:t.json)||{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:(null==t?void 0:t.buffers)||[],images:(null==t?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const e=this.getUsedExtensions().find((e=>e===t)),n=this.getRequiredExtensions().find((e=>e===t));return"string"==typeof e||"string"==typeof n}getExtension(t){const e=this.getUsedExtensions().find((e=>e===t)),n=this.json.extensions||{};return e?n[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find((e=>e===t))?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if("object"==typeof e)return e;const n=this.json[t]&&this.json[t][e];if(!n)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return n}getTypedArrayForBufferView(t){const e=(t=this.getBufferView(t)).buffer,n=this.gltf.buffers[e];no(n);const r=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,t.byteLength)}getTypedArrayForAccessor(t){const e=this.getAccessor(t);return function(t,e,n){var r,s;const i="number"==typeof n?null===(r=t.accessors)||void 0===r?void 0:r[n]:n;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const o=null===(s=t.bufferViews)||void 0===s?void 0:s[i.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:a,byteOffset:c}=e[o.buffer],h=(c||0)+(i.byteOffset||0)+(o.byteOffset||0),{ArrayType:l,length:u,componentByteSize:d,numberOfComponentsInElement:f}=mo(i,o),m=d*f,g=o.byteStride||m;if(void 0===o.byteStride||o.byteStride===m)return new l(a,h,u);const p=new l(u);for(let t=0;t<i.count;t++){const e=new l(a,h+t*g,f);p.set(e,t*f)}return p}(this.gltf.json,this.gltf.buffers,e)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),n=this.getBuffer(e.buffer).data,r=e.byteOffset||0;return new Uint8Array(n,r,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,n){return t.extensions=t.extensions||{},t.extensions[e]=n,this.registerUsedExtension(e),this}setObjectExtension(t,e,n){(t.extensions||{})[e]=n}removeObjectExtension(t,e){const n=(null==t?void 0:t.extensions)||{};if(n[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}delete n[e]}addExtension(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return no(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return no(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((e=>e===t))||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((e=>e===t))||this.json.extensionsRequired.push(t)}removeExtension(t){var e;if(null!==(e=this.json.extensions)&&void 0!==e&&e[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:n}=t;this.json.nodes=this.json.nodes||[];const r={mesh:e};return n&&(r.matrix=n),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:n,material:r,mode:s=4}=t,i={primitives:[{attributes:this._addAttributes(e),mode:s}]};if(n){const t=this._addIndices(n);i.primitives[0].indices=t}return Number.isFinite(r)&&(i.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const n=Zi(t),r=e||(null==n?void 0:n.mimeType),s={bufferView:this.addBufferView(t),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.byteLength;const r=t.byteLength;no(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const s={buffer:e,byteOffset:n,byteLength:r};return this.byteLength+=N(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(t,e){const n={bufferView:t,type:uo(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3};const n=this.addBufferView(t);let r={min:e.min,max:e.max};r.min&&r.max||(r=this._getAccessorMinMax(t,e.size));const s={size:e.size,componentType:fo(t),count:Math.round(t.length/e.size),min:r.min,max:r.max};return this.addAccessor(n,Object.assign(s,e))}addTexture(t){const{imageIndex:e}=t,n={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const n=this.byteLength,r=new ArrayBuffer(n),s=new Uint8Array(r);let i=0;for(const t of this.sourceBuffers||[])i=P(t,s,i);null!==(t=this.json)&&void 0!==t&&null!==(e=t.buffers)&&void 0!==e&&e[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(t,e){let n=!0;for(;n;){const r=t.indexOf(e);r>-1?t.splice(r,1):n=!1}}_addAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e={};for(const n in t){const r=t[n],s=this._getGltfAttributeName(n),i=this.addBinaryBuffer(r.value,r);e[s]=i}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const n={min:null,max:null};if(t.length<e)return n;n.min=[],n.max=[];const r=t.subarray(0,e);for(const t of r)n.min.push(t),n.max.push(t);for(let r=e;r<t.length;r+=e)for(let s=0;s<e;s++)n.min[0+s]=Math.min(n.min[0+s],t[r+s]),n.max[0+s]=Math.max(n.max[0+s],t[r+s]);return n}}function Ao(t){return(t%1+1)%1}const yo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Bo={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},bo={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Co(t,e){return bo[e]*yo[t]}function wo(t,e,n,r){if("UINT8"!==n&&"UINT16"!==n&&"UINT32"!==n&&"UINT64"!==n)return null;const s=vo(t.getTypedArrayForBufferView(e),"SCALAR",n,r+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function vo(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const s=yo[e],i=Bo[n],o=bo[n],a=r*s,c=a*o;let h=t.buffer,l=t.byteOffset;return l%o!=0&&(h=new Uint8Array(h).slice(l,l+c).buffer,l=0),new i(h,l,a)}function Eo(t,e,n){var r,s;const i=`TEXCOORD_${e.texCoord||0}`,o=n.attributes[i],a=t.getTypedArrayForAccessor(o),c=t.gltf.json,h=e.index,l=null===(r=c.textures)||void 0===r||null===(s=r[h])||void 0===s?void 0:s.source;if(void 0!==l){var u,d,f;const n=null===(u=c.images)||void 0===u||null===(d=u[l])||void 0===d?void 0:d.mimeType,r=null===(f=t.gltf.images)||void 0===f?void 0:f[l];if(r&&void 0!==r.width){const t=[];for(let s=0;s<a.length;s+=2){const i=_o(r,n,a,s,e.channels);t.push(i)}return t}}return[]}function To(t,e,n,r,s){if(null==n||!n.length)return;const i=[];for(const t of n){let e=r.findIndex((e=>e===t));-1===e&&(e=r.push(t)-1),i.push(e)}const o=new Uint32Array(i),a=t.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=t.addBufferView(o,a,0),h=t.addAccessor(c,{size:1,componentType:fo(o),count:o.length});s.attributes[e]=h}function _o(t,e,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0];const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=n[r],a=n[r+1];let c=1;!e||-1===e.indexOf("image/jpeg")&&-1===e.indexOf("image/png")||(c=4);const h=Mo(o,a,t,c);let l=0;for(const e of s){const n="number"==typeof e?Object.values(i)[e]:i[e],r=h+n.offset,s=Hi(t);if(s.data.length<=r)throw new Error(`${s.data.length} <= ${r}`);l|=s.data[r]<<n.shift}return l}function Mo(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const s=n.width,i=Ao(t)*(s-1),o=Math.round(i),a=n.height,c=Ao(e)*(a-1),h=Math.round(c),l=n.components?n.components:r,u=(h*s+o)*l;return u}function Io(t,e,n,r,s){const i=[];for(let o=0;o<e;o++){const e=n[o],a=n[o+1]-n[o];if(a+e>r)break;const c=e/s,h=a/s;i.push(t.slice(c,c+h))}return i}function xo(t,e,n){const r=[];for(let s=0;s<e;s++){const e=s*n;r.push(t.slice(e,e+n))}return r}function So(t,e,n,r){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){const n=[],s=new TextDecoder("utf8");let i=0;for(let o=0;o<t;o++){const t=r[o+1]-r[o];if(t+i<=e.length){const r=e.subarray(i,t+i),o=s.decode(r);n.push(o),i+=t}}return n}return[]}function Oo(t,e,n){var r,s;if(null==n||null===(r=n.gltf)||void 0===r||!r.loadBuffers)return;const i=null===(s=e.extensions)||void 0===s?void 0:s.EXT_mesh_features,o=null==i?void 0:i.featureIds;if(o)for(const r of o){var a;let s;if(void 0!==r.attribute){const n=`_FEATURE_ID_${r.attribute}`,i=e.attributes[n];s=t.getTypedArrayForAccessor(i)}else s=void 0!==r.texture&&null!=n&&null!==(a=n.gltf)&&void 0!==a&&a.loadImages?Eo(t,r.texture,e):[];r.data=s}}const Ro=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t,e){!function(t,e){const n=t.gltf.json;if(n.meshes)for(const r of n.meshes)for(const n of r.primitives)Oo(t,n,e)}(new po(t),e)},name:"EXT_mesh_features"},Symbol.toStringTag,{value:"Module"}));function Fo(t,e){for(const n of t)if(n.class===e)return n;return null}function Do(t,e,n,r){var s;if(!e)return;const i=null===(s=n.extensions)||void 0===s?void 0:s.EXT_structural_metadata,o=null==i?void 0:i.propertyTextures;if(o)for(const s of o)Go(t,e[s],n,r)}function Go(t,e,n,r){if(!e.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);const s=e.class;for(const o in e.properties){var i;const a=`${s}_${o}`,c=null===(i=e.properties)||void 0===i?void 0:i[o];if(!c)continue;c.data||(c.data=[]);const h=c.data,l=Eo(t,c,n);null!==l&&(To(t,a,l,h,n),c.data=h,r.dataAttributeNames.push(a))}}function Lo(t,e,n){var r;const s=null===(r=e.classes)||void 0===r?void 0:r[n.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const i=n.count;for(const r in s.properties){var o;const a=s.properties[r],c=null===(o=n.properties)||void 0===o?void 0:o[r];if(c){const n=Uo(t,e,a,i,c);c.data=n}}}function Uo(t,e,n,r,s){let i=[];const o=s.values,a=t.getTypedArrayForBufferView(o),c=function(t,e,n,r){return e.array&&void 0===e.count&&void 0!==n.arrayOffsets?wo(t,n.arrayOffsets,n.arrayOffsetType||"UINT32",r):null}(t,n,s,r),h=function(t,e,n){return void 0!==e.stringOffsets?wo(t,e.stringOffsets,e.stringOffsetType||"UINT32",n):null}(t,s,r);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":i=function(t,e,n,r){const s=t.array,i=t.count,o=Co(t.type,t.componentType),a=n.byteLength/o;let c;return c=t.componentType?vo(n,t.type,t.componentType,a):n,s?r?Io(c,e,r,n.length,o):i?xo(c,e,i):[]:c}(n,r,a,c);break;case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":i=So(r,a,c,h);break;case"ENUM":i=function(t,e,n,r,s){var i;const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=null===(i=t.enums)||void 0===i?void 0:i[o];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=a.valueType||"UINT16",h=Co(e.type,c),l=r.byteLength/h;let u=vo(r,e.type,c,l);if(u||(u=r),e.array){if(s)return function(t){const{valuesData:e,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s,elementSize:i,enumEntry:o}=t,a=[];for(let t=0;t<n;t++){const n=r[t],c=r[t+1]-r[t];if(c+n>s)break;const h=No(e,n/i,c/i,o);a.push(h)}return a}({valuesData:u,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r.length,elementSize:h,enumEntry:a});const t=e.count;return t?function(t,e,n,r){const s=[];for(let i=0;i<e;i++){const e=No(t,n*i,n,r);s.push(e)}return s}(u,n,t,a):[]}return No(u,0,n,a)}(e,n,r,a,c);break;default:throw new Error(`Unknown classProperty type ${n.type}`)}return i}function No(t,e,n,r){const s=[];for(let i=0;i<n;i++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)s.push("");else{const n=Po(r,t[e+i]);n?s.push(n.name):s.push("")}return s}function Po(t,e){for(const n of t.values)if(n.value===e)return n;return null}const Ho=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t,e){!function(t,e){var n,r;if(null===(n=e.gltf)||void 0===n||!n.loadBuffers)return;const s=t.getExtension("EXT_structural_metadata");s&&(null!==(r=e.gltf)&&void 0!==r&&r.loadImages&&function(t,e){const n=e.propertyTextures,r=t.gltf.json;if(n&&r.meshes)for(const s of r.meshes)for(const r of s.primitives)Do(t,n,r,e)}(t,s),function(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.propertyTables;if(r&&s)for(const e in r){const r=Fo(s,e);r&&Lo(t,n,r)}}(t,s))}(new po(t),e)},name:"EXT_structural_metadata"},Symbol.toStringTag,{value:"Module"}));function Jo(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function jo(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function ko(t,e,n){var r;if(!n.class)return;const s=null===(r=e.classes)||void 0===r?void 0:r[n.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const i=n.count;for(const e in s.properties){var o;const r=s.properties[e],a=null===(o=n.properties)||void 0===o?void 0:o[e];if(a){const e=Ko(t,0,r,i,a);a.data=e}}}function Vo(t,e,n){const r=e.class;for(const i in n.properties){var s;const n=null==e||null===(s=e.properties)||void 0===s?void 0:s[i];if(n){const e=Qo(t,n,r);n.data=e}}}function Ko(t,e,n,r,s){let i=[];const o=s.bufferView,a=t.getTypedArrayForBufferView(o),c=function(t,e,n,r){return"ARRAY"===e.type&&void 0===e.componentCount&&void 0!==n.arrayOffsetBufferView?wo(t,n.arrayOffsetBufferView,n.offsetType||"UINT32",r):null}(t,n,s,r),h=function(t,e,n,r){return void 0!==n.stringOffsetBufferView?wo(t,n.stringOffsetBufferView,n.offsetType||"UINT32",r):null}(t,0,s,r);return"STRING"===n.type||"STRING"===n.componentType?i=So(r,a,c,h):function(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||void 0!==t.componentType&&e.includes(t.componentType)}(n)&&(i=function(t,e,n,r){const s="ARRAY"===t.type,i=t.componentCount,o="SCALAR",a=t.componentType||t.type,c=Co(o,a),h=vo(n,o,a,n.byteLength/c);return s?r?Io(h,e,r,n.length,c):i?xo(h,e,i):[]:h}(n,r,a,c)),i}function Qo(t,e,n){const r=t.gltf.json;if(!r.meshes)return[];const s=[];for(const i of r.meshes)for(const r of i.primitives)qo(t,n,e,s,r);return s}function qo(t,e,n,r,s){const i=Eo(t,{channels:n.channels,...n.texture},s);i&&To(t,e,i,r,s)}const zo=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t,e){!function(t,e){var n,r;if(null===(n=e.gltf)||void 0===n||!n.loadBuffers)return;const s=t.getExtension("EXT_feature_metadata");s&&(null!==(r=e.gltf)&&void 0!==r&&r.loadImages&&function(t,e){const n=e.schema;if(!n)return;const r=n.classes,{featureTextures:s}=e;if(r&&s)for(const e in r){const n=r[e],i=jo(s,e);i&&Vo(t,i,n)}}(t,s),function(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.featureTables;if(r&&s)for(const e in r){const r=Jo(s,e);r&&ko(t,n,r)}}(t,s))}(new po(t),e)},name:"EXT_feature_metadata"},Symbol.toStringTag,{value:"Module"}));let Wo,Xo;async function Yo(t){const e=t.modules||{};return e.basis?e.basis:(Wo=Wo||async function(t){let e=null,n=null;return[e,n]=await Promise.all([await S("basis_transcoder.js","textures",t),await S("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await function(t,e){const n={};return e&&(n.wasmBinary=e),new Promise((e=>{t(n).then((t=>{const{BasisFile:n,initializeBasis:r}=t;r(),e({BasisFile:n})}))}))}(e,n)}(t),await Wo)}async function Zo(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Xo=Xo||async function(t){let e=null,n=null;return[e,n]=await Promise.all([await S("basis_encoder.js","textures",t),await S("basis_encoder.wasm","textures",t)]),e=e||globalThis.BASIS,await function(t,e){const n={};return e&&(n.wasmBinary=e),new Promise((e=>{t(n).then((t=>{const{BasisFile:n,KTX2File:r,initializeBasis:s,BasisEncoder:i}=t;s(),e({BasisFile:n,KTX2File:r,BasisEncoder:i})}))}))}(e,n)}(t),await Xo)}const $o=["","WEBKIT_","MOZ_"],ta={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let ea=null;var na,ra,sa,ia,oa,aa,ca,ha,la;(la=na||(na={}))[la.NONE=0]="NONE",la[la.BASISLZ=1]="BASISLZ",la[la.ZSTD=2]="ZSTD",la[la.ZLIB=3]="ZLIB",function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(ra||(ra={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(sa||(sa={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(ia||(ia={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(oa||(oa={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(aa||(aa={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(ca||(ca={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(ha||(ha={}));const ua=[171,75,84,88,32,50,48,187,13,10,26,10],da={etc1:{basisFormat:0,compressed:!0,format:36196},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:33776},bc3:{basisFormat:3,compressed:!0,format:33779},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:35840},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:35842},"astc-4x4":{basisFormat:10,compressed:!0,format:37808},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function fa(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const t=r.getNumImages(),e=[];for(let s=0;s<t;s++){const t=r.getNumLevels(s),i=[];for(let e=0;e<t;e++)i.push(ma(r,s,e,n));e.push(i)}return e}finally{r.close(),r.delete()}}function ma(t,e,n,r){const s=t.getImageWidth(e,n),i=t.getImageHeight(e,n),o=t.getHasAlpha(),{compressed:a,format:c,basisFormat:h}=Aa(r,o),l=t.getImageTranscodedSizeInBytes(e,n,h),u=new Uint8Array(l);if(!t.transcodeImage(u,e,n,h,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:i,data:u,compressed:a,format:c,hasAlpha:o}}function ga(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const t=r.getLevels(),e=[];for(let s=0;s<t;s++){e.push(pa(r,s,n));break}return[e]}finally{r.close(),r.delete()}}function pa(t,e,n){const{alphaFlag:r,height:s,width:i}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=Aa(n,r),h=t.getImageTranscodedSizeInBytes(e,0,0,c),l=new Uint8Array(h);if(!t.transcodeImage(l,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:s,data:l,compressed:o,levelSize:h,hasAlpha:r,format:a}}function Aa(t,e){let n=t&&t.basis&&t.basis.format;return"auto"===n&&(n=ya()),"object"==typeof n&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),da[n]}function ya(){const t=function(t){if(!ea){t=t||function(){try{return document.createElement("canvas").getContext("webgl")}catch(t){return null}}()||void 0,ea=new Set;for(const e of $o)for(const n in ta)if(t&&t.getExtension(`${e}${n}`)){const t=ta[n];ea.add(t)}}return ea}();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const Ba={name:"Basis",id:"basis",module:"textures",version:"4.1.1",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}},parse:async function(t,e){if("auto"===e.basis.containerFormat){if(function(t){const e=new Uint8Array(t);return!(e.byteLength<ua.length||e[0]!==ua[0]||e[1]!==ua[1]||e[2]!==ua[2]||e[3]!==ua[3]||e[4]!==ua[4]||e[5]!==ua[5]||e[6]!==ua[6]||e[7]!==ua[7]||e[8]!==ua[8]||e[9]!==ua[9]||e[10]!==ua[10]||e[11]!==ua[11])}(t))return ga((await Zo(e)).KTX2File,t,e);const{BasisFile:n}=await Yo(e);return fa(n,t,e)}if("encoder"===e.basis.module){const n=await Zo(e);return"ktx2"===e.basis.containerFormat?ga(n.KTX2File,t,e):fa(n.BasisFile,t,e)}{const{BasisFile:n}=await Yo(e);return fa(n,t,e)}}},ba=!0,Ca=1735152710;function wa(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function va(t,e,r){n(t.header.byteLength>20);const s=e.getUint32(r+0,ba),i=e.getUint32(r+4,ba);return r+=8,n(0===i),Ta(t,e,r,s),(r+=s)+_a(t,e,r,t.header.byteLength)}function Ea(t,e,r,s){return n(t.header.byteLength>20),function(t,e,n,r){for(;n+8<=t.header.byteLength;){const s=e.getUint32(n+0,ba),i=e.getUint32(n+4,ba);switch(n+=8,i){case 1313821514:Ta(t,e,n,s);break;case 5130562:_a(t,e,n,s);break;case 0:r.strict||Ta(t,e,n,s);break;case 1:r.strict||_a(t,e,n,s)}n+=N(s,4)}}(t,e,r,s),r+t.header.byteLength}function Ta(t,e,n,r){const s=new Uint8Array(e.buffer,n,r),i=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(i),N(r,4)}function _a(t,e,n,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:e.buffer}),N(r,4)}function Ma(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return n.substr(0,n.lastIndexOf("/")+1)+t}const Ia=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),xa=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Sa={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Oa={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};let Ra;async function Fa(){return Ra||(Ra=async function(){let t="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";WebAssembly.validate(Ia)&&(t="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",console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const r=t.charCodeAt(n);e[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let r=0;r<t.length;++r)e[n++]=e[r]<60?xa[e[r]]:64*(e[r]-60)+e[++r];return e.buffer.slice(0,n)}(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}()),Ra}function Da(t,e,n,r,s,i,o){const a=t.exports.sbrk,c=r+3&-4,h=a(c*s),l=a(i.length),u=new Uint8Array(t.exports.memory.buffer);u.set(i,l);const d=e(h,r,s,l,i.length);if(0===d&&o&&o(h,c,s),n.set(u.subarray(h,h+r*s)),a(h-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}const Ga="EXT_meshopt_compression";async function La(t,e){const n=t.getObjectExtension(e,Ga);if(n){const{byteOffset:r=0,byteLength:s=0,byteStride:i,count:o,mode:a,filter:c="NONE",buffer:h}=n,l=t.gltf.buffers[h],u=new Uint8Array(l.arrayBuffer,l.byteOffset+r,s),d=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await async function(t,e,n,r,s){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NONE";const o=await Fa();Da(o,o.exports[Oa[s]],t,e,n,r,o.exports[Sa[i||"NONE"]])}(d,o,i,u,a,c),t.removeObjectExtension(e,Ga)}}const Ua=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t,e){var n,r;const s=new po(t);if(null==e||null===(n=e.gltf)||void 0===n||!n.decompressMeshes||null===(r=e.gltf)||void 0===r||!r.loadBuffers)return;const i=[];for(const e of t.json.bufferViews||[])i.push(La(s,e));await Promise.all(i),s.removeExtension(Ga)},name:"EXT_meshopt_compression"},Symbol.toStringTag,{value:"Module"})),Na="EXT_texture_webp",Pa=Object.freeze(Object.defineProperty({__proto__:null,name:"EXT_texture_webp",preprocess:function(t,e){const n=new po(t);if(!function(t){if(void 0===eo[t]){const e=i?function(t){switch(t){case"image/avif":case"image/webp":return function(t){try{return 0===document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)}catch{return!1}}(t);default:return!0}}(t):function(t){var e,n;const r=(null===(e=globalThis.loaders)||void 0===e?void 0:e.imageFormatsNode)||["image/png","image/jpeg","image/gif"],s=null===(n=globalThis.loaders)||void 0===n?void 0:n.parseImageNode;return Boolean(s)&&r.includes(t)}(t);eo[t]=e}return eo[t]}("image/webp")){if(n.getRequiredExtensions().includes(Na))throw new Error("gltf: Required extension EXT_texture_webp not supported by browser");return}const{json:r}=n;for(const t of r.textures||[]){const e=n.getObjectExtension(t,Na);e&&(t.source=e.source),n.removeObjectExtension(t,Na)}n.removeExtension(Na)}},Symbol.toStringTag,{value:"Module"})),Ha="KHR_texture_basisu",Ja=Object.freeze(Object.defineProperty({__proto__:null,name:"KHR_texture_basisu",preprocess:function(t,e){const n=new po(t),{json:r}=n;for(const t of r.textures||[]){const e=n.getObjectExtension(t,Ha);e&&(t.source=e.source,n.removeObjectExtension(t,Ha))}n.removeExtension(Ha)}},Symbol.toStringTag,{value:"Module"}));function ja(t){const{buffer:e,size:n,count:r}=function(t){let e=t,n=1,r=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t?Array.isArray(t)?new e(t):!n||t instanceof e?t:new e(t):null}(e,Float32Array)),r=e.length/n),{buffer:e,size:n,count:r}}(t);return{value:e,size:n,byteOffset:0,count:r,type:uo(n),componentType:fo(e)}}const ka="KHR_draco_mesh_compression";async function Va(t,n,r,s){const i=t.getObjectExtension(n,ka);if(!i)return;const o=t.getTypedArrayForBufferView(i.bufferView),a=U(o.buffer,o.byteOffset),c={...r};delete c["3d-tiles"];const h=await e(a,ii,c,s),l=function(t){const e={};for(const n in t){const r=t[n];if("indices"!==n){const t=ja(r);e[n]=t}}return e}(h.attributes);for(const[e,r]of Object.entries(l))if(e in n.attributes){const s=n.attributes[e],i=t.getAccessor(s);null!=i&&i.min&&null!=i&&i.max&&(r.min=i.min,r.max=i.max)}n.attributes=l,h.indices&&(n.indices=ja(h.indices)),t.removeObjectExtension(n,ka),function(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(n)}function Ka(t,e){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,s=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=s.DracoWriter.encodeSync({attributes:t}),a=null==i||null===(n=i.parseSync)||void 0===n?void 0:n.call(i,{attributes:t}),c=s._addFauxAttributes(a.attributes),h=s.addBufferView(o),l={primitives:[{attributes:c,mode:r,extensions:{[ka]:{bufferView:h,attributes:c}}}]};return l}function*Qa(t){for(const e of t.json.meshes||[])for(const t of e.primitives)yield t}const qa=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t,e,n){var r;if(null==e||null===(r=e.gltf)||void 0===r||!r.decompressMeshes)return;const s=new po(t),i=[];for(const t of Qa(s))s.getObjectExtension(t,ka)&&i.push(Va(s,t,e,n));await Promise.all(i),s.removeExtension(ka)},encode:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new po(t);for(const t of n.json.meshes||[])Ka(t,e),n.addRequiredExtension(ka)},name:"KHR_draco_mesh_compression",preprocess:function(t,e,n){const r=new po(t);for(const t of Qa(r))r.getObjectExtension(t,ka)}},Symbol.toStringTag,{value:"Module"})),za=new qe,Wa=new en,Xa=new en;function Ya(t,e){var n,r,s;const i=[],o=null===(n=e.json.materials)||void 0===n?void 0:n[t],a=null==o||null===(r=o.pbrMetallicRoughness)||void 0===r?void 0:r.baseColorTexture;a&&Za(e,t,a,i);const c=null==o?void 0:o.emissiveTexture;c&&Za(e,t,c,i);const h=null==o?void 0:o.normalTexture;h&&Za(e,t,h,i);const l=null==o?void 0:o.occlusionTexture;l&&Za(e,t,l,i);const u=null==o||null===(s=o.pbrMetallicRoughness)||void 0===s?void 0:s.metallicRoughnessTexture;u&&Za(e,t,u,i)}function Za(t,e,n,r){const s=function(t,e){var n;const r=null===(n=t.extensions)||void 0===n?void 0:n.KHR_texture_transform,{texCoord:s=0}=t,{texCoord:i=s}=r;if(-1===e.findIndex((t=>{let[e,n]=t;return e===s&&n===i}))){const n=function(t){const{offset:e=[0,0],rotation:n=0,scale:r=[1,1]}=t,s=(new en).set(1,0,0,0,1,0,e[0],e[1],1),i=Wa.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=Xa.set(r[0],0,0,0,r[1],0,0,0,1);return s.multiplyRight(i).multiplyRight(o)}(r);return s!==i&&(t.texCoord=i),e.push([s,i]),{originalTexCoord:s,texCoord:i,matrix:n}}return null}(n,r);if(!s)return;const i=t.json.meshes||[];for(const n of i)for(const r of n.primitives){const n=r.material;Number.isFinite(n)&&e===n&&$a(t,r,s)}}function $a(t,e,n){const{originalTexCoord:r,texCoord:s,matrix:i}=n,o=e.attributes[`TEXCOORD_${r}`];if(Number.isFinite(o)){var a;const n=null===(a=t.json.accessors)||void 0===a?void 0:a[o];if(n&&n.bufferView){var c;const o=null===(c=t.json.bufferViews)||void 0===c?void 0:c[n.bufferView];if(o){const{arrayBuffer:a,byteOffset:c}=t.buffers[o.buffer],h=(c||0)+(n.byteOffset||0)+(o.byteOffset||0),{ArrayType:l,length:u}=mo(n,o),d=so[n.componentType],f=ro[n.type],m=o.byteStride||d*f,g=new Float32Array(u);for(let t=0;t<n.count;t++){const e=new l(a,h+t*m,2);za.set(e[0],e[1],1),za.transformByMatrix3(i),g.set([za[0],za[1]],t*f)}r===s?function(t,e,n,r){t.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}(n,o,t.buffers,g):function(t,e,n,r,s){r.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const i=r.json.bufferViews;if(!i)return;i.push({buffer:r.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const o=r.json.accessors;o&&(o.push({bufferView:(null==i?void 0:i.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes[`TEXCOORD_${t}`]=o.length-1)}(s,n,e,t,g)}}}}const tc=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t,e){var n;if(!new po(t).hasExtension("KHR_texture_transform")||null===(n=e.gltf)||void 0===n||!n.loadBuffers)return;const r=t.json.materials||[];for(let e=0;e<r.length;e++)Ya(e,t)},name:"KHR_texture_transform"},Symbol.toStringTag,{value:"Module"})),ec="KHR_lights_punctual",nc=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t){const e=new po(t),{json:n}=e,r=e.getExtension(ec);r&&(e.json.lights=r.lights,e.removeExtension(ec));for(const t of n.nodes||[]){const n=e.getObjectExtension(t,ec);n&&(t.light=n.light),e.removeObjectExtension(t,ec)}},encode:async function(t){const e=new po(t),{json:n}=e;if(n.lights){const t=e.addExtension(ec);no(!t.lights),t.lights=n.lights,delete n.lights}if(e.json.lights){for(const t of e.json.lights){const n=t.node;e.addObjectExtension(n,ec,t)}delete e.json.lights}},name:"KHR_lights_punctual"},Symbol.toStringTag,{value:"Module"})),rc="KHR_materials_unlit",sc=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t){const e=new po(t),{json:n}=e;for(const t of n.materials||[])t.extensions&&t.extensions.KHR_materials_unlit&&(t.unlit=!0),e.removeObjectExtension(t,rc);e.removeExtension(rc)},encode:function(t){const e=new po(t),{json:n}=e;if(e.materials)for(const t of n.materials||[])t.unlit&&(delete t.unlit,e.addObjectExtension(t,rc,{}),e.addExtension(rc))},name:"KHR_materials_unlit"},Symbol.toStringTag,{value:"Module"})),ic="KHR_techniques_webgl";function oc(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach((e=>{t.uniforms[e].value&&!(e in n)&&(n[e]=t.uniforms[e].value)})),Object.keys(n).forEach((t=>{"object"==typeof n[t]&&void 0!==n[t].index&&(n[t].texture=e.getTexture(n[t].index))})),n}const ac=[Ho,Ro,Ua,Pa,Ja,qa,nc,sc,Object.freeze(Object.defineProperty({__proto__:null,decode:async function(t){const e=new po(t),{json:n}=e,r=e.getExtension(ic);if(r){const t=function(t,e){const{programs:n=[],shaders:r=[],techniques:s=[]}=t,i=new TextDecoder;return r.forEach((t=>{if(!Number.isFinite(t.bufferView))throw new Error("KHR_techniques_webgl: no shader code");t.code=i.decode(e.getTypedArrayForBufferView(t.bufferView))})),n.forEach((t=>{t.fragmentShader=r[t.fragmentShader],t.vertexShader=r[t.vertexShader]})),s.forEach((t=>{t.program=n[t.program]})),s}(r,e);for(const r of n.materials||[]){const n=e.getObjectExtension(r,ic);n&&(r.technique=Object.assign({},n,t[n.technique]),r.technique.values=oc(r.technique,e)),e.removeObjectExtension(r,ic)}e.removeExtension(ic)}},encode:async function(t,e){},name:"KHR_techniques_webgl"},Symbol.toStringTag,{value:"Module"})),tc,zo];function cc(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=ac.filter((t=>lc(t.name,e)));for(const i of r){var s;null===(s=i.preprocess)||void 0===s||s.call(i,t,e,n)}}async function hc(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=ac.filter((t=>lc(t.name,e)));for(const i of r){var s;await(null===(s=i.decode)||void 0===s?void 0:s.call(i,t,e,n))}}function lc(t,e){var n;const r=(null==e||null===(n=e.gltf)||void 0===n?void 0:n.excludeExtensions)||{};return!(t in r&&!r[t])}const uc="KHR_binary_glTF",dc={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},fc={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class mc{constructor(){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}},this.json=void 0}normalize(t,e){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn(`glTF: Unknown version ${n.asset.version}`)}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),function(t){const e=new po(t),{json:n}=e;for(const t of n.images||[]){const n=e.getObjectExtension(t,uc);n&&Object.assign(t,n),e.removeObjectExtension(t,uc)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(uc)}(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in dc)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const n=t[e];if(n&&!Array.isArray(n)){t[e]=[];for(const r in n){const s=n[r];s.id=s.id||r;const i=t[e].length;t[e].push(s),this.idToIndexMap[e][r]=i}}}_convertObjectIdsToArrayIndices(t){for(const e in dc)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:t,indices:n,material:r}=e;for(const e in t)t[e]=this._convertIdToIndex(t[e],"accessor");n&&(e.indices=this._convertIdToIndex(n,"accessor")),r&&(e.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map((t=>this._convertIdToIndex(t,"node")))),t.meshes&&(t.meshes=t.meshes.map((t=>this._convertIdToIndex(t,"mesh"))))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map((t=>this._convertIdToIndex(t,"node"))))}_convertIdsToIndices(t,e){t[e]||(console.warn(`gltf v1: json doesn't contain attribute ${e}`),t[e]=[]);for(const n of t[e])for(const t in n){const e=n[t],r=this._convertIdToIndex(e,t);n[t]=r}}_convertIdToIndex(t,e){const n=fc[e];if(n in this.idToIndexMap){const r=this.idToIndexMap[n][t];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${e} with id ${t}`);return r}return t}_updateObjects(t){for(const t of this.json.buffers)delete t.type}_updateMaterial(t){for(const s of t.materials){var e,n,r;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=(null===(e=s.values)||void 0===e?void 0:e.tex)||(null===(n=s.values)||void 0===n?void 0:n.texture2d_0)||(null===(r=s.values)||void 0===r?void 0:r.diffuseTex),o=t.textures.findIndex((t=>t.id===i));-1!==o&&(s.pbrMetallicRoughness.baseColorTexture={index:o})}}}function gc(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new mc).normalize(t,e)}async function pc(t,e){var n,r,s;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return Ac(t,e,i,o),gc(t,{normalize:null==o||null===(n=o.gltf)||void 0===n?void 0:n.normalize}),cc(t,o,a),null!=o&&null!==(r=o.gltf)&&void 0!==r&&r.loadBuffers&&t.json.buffers&&await yc(t,o,a),null!=o&&null!==(s=o.gltf)&&void 0!==s&&s.loadImages&&await Bc(t,o,a),await hc(t,o,a),t}function Ac(t,e,n,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new DataView(t),{magic:s=Ca}=n,i=r.getUint32(e,!1);return i===s||i===Ca}(e,n,r)&&(e=(new TextDecoder).decode(e)),"string"==typeof e)t.json=function(t){try{return JSON.parse(t)}catch(e){throw new Error(`Failed to parse JSON from data starting with "${function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?G(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?G(t,0,e):""}(t)}"`)}}(e);else if(e instanceof ArrayBuffer){const s={};n=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=new DataView(e),s=wa(r,n+0),i=r.getUint32(n+4,ba),o=r.getUint32(n+8,ba);switch(Object.assign(t,{header:{byteOffset:n,byteLength:o,hasBinChunk:!1},type:s,version:i,json:{},binChunks:[]}),n+=12,t.version){case 1:return va(t,r,n);case 2:return Ea(t,r,n,{});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}(s,e,n,r.glb),no("glTF"===s.type,`Invalid GLB magic string ${s.type}`),t._glb=s,t.json=s.json}else no(!1,"GLTF: must be ArrayBuffer or string");const s=t.json.buffers||[];if(t.buffers=new Array(s.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:e}=t._glb;t.buffers[0]={arrayBuffer:e[0].arrayBuffer,byteOffset:e[0].byteOffset,byteLength:e[0].byteLength}}const i=t.json.images||[];t.images=new Array(i.length).fill({})}async function yc(t,e,n){const r=t.json.buffers||[];for(let o=0;o<r.length;++o){const a=r[o];if(a.uri){var s,i;const{fetch:r}=n;no(r);const c=Ma(a.uri,e),h=await(null==n||null===(s=n.fetch)||void 0===s?void 0:s.call(n,c)),l=await(null==h||null===(i=h.arrayBuffer)||void 0===i?void 0:i.call(h));t.buffers[o]={arrayBuffer:l,byteOffset:0,byteLength:l.byteLength},delete a.uri}else null===t.buffers[o]&&(t.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function Bc(t,e,n){const r=function(t){const e=new Set,n=t.json.textures||[];for(const t of n)void 0!==t.source&&e.add(t.source);return Array.from(e).sort()}(t),s=t.json.images||[],i=[];for(const o of r)i.push(bc(t,s[o],o,e,n));return await Promise.all(i)}async function bc(t,n,r,s,i){let o;if(n.uri&&!n.hasOwnProperty("bufferView")){const t=Ma(n.uri,s),{fetch:e}=i,r=await e(t);o=await r.arrayBuffer(),n.bufferView={data:o}}if(Number.isFinite(n.bufferView)){const e=function(t,e,n){const r=t.bufferViews[n];no(r);const s=e[r.buffer];no(s);const i=(r.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,r.byteLength)}(t.json,t.buffers,n.bufferView);o=U(e.buffer,e.byteOffset,e.byteLength)}no(o,"glTF image has no data");let a=await e(o,[to,Ba],{...s,mimeType:n.mimeType,basis:s.basis||{format:ya()}},i);a&&a[0]&&(a={compressed:!0,mipmaps:!1,width:a[0].width,height:a[0].height,data:a[0]}),t.images=t.images||[],t.images[r]=a}const Cc={name:"glTF",id:"gltf",module:"gltf",version:"4.1.1",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e={...Cc.options,...e},e.gltf={...Cc.options.gltf,...e.gltf};const{byteOffset:r=0}=e,s={};return await pc(s,t,r,e,n)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}},wc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vc={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ec={magFilter:10240,minFilter:10241,wrapS:10242,wrapT:10243},Tc={10240:9729,10241:9986,10242:10497,10243:10497};class _c{constructor(){this.baseUri="",this.jsonUnprocessed=void 0,this.json=void 0,this.buffers=[],this.images=[]}postProcess(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{json:n,buffers:r=[],images:s=[]}=t,{baseUri:i=""}=t;return no(n),this.baseUri=i,this.buffers=r,this.images=s,this.jsonUnprocessed=n,this.json=this._resolveTree(t.json,e),this.json}_resolveTree(t){const e={...t};return this.json=e,t.bufferViews&&(e.bufferViews=t.bufferViews.map(((t,e)=>this._resolveBufferView(t,e)))),t.images&&(e.images=t.images.map(((t,e)=>this._resolveImage(t,e)))),t.samplers&&(e.samplers=t.samplers.map(((t,e)=>this._resolveSampler(t,e)))),t.textures&&(e.textures=t.textures.map(((t,e)=>this._resolveTexture(t,e)))),t.accessors&&(e.accessors=t.accessors.map(((t,e)=>this._resolveAccessor(t,e)))),t.materials&&(e.materials=t.materials.map(((t,e)=>this._resolveMaterial(t,e)))),t.meshes&&(e.meshes=t.meshes.map(((t,e)=>this._resolveMesh(t,e)))),t.nodes&&(e.nodes=t.nodes.map(((t,e)=>this._resolveNode(t,e))),e.nodes=e.nodes.map(((t,e)=>this._resolveNodeChildren(t)))),t.skins&&(e.skins=t.skins.map(((t,e)=>this._resolveSkin(t,e)))),t.scenes&&(e.scenes=t.scenes.map(((t,e)=>this._resolveScene(t,e)))),"number"==typeof this.json.scene&&e.scenes&&(e.scene=e.scenes[this.json.scene]),e}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,e){if("object"==typeof e)return e;const n=t&&t[e];return n||console.warn(`glTF file error: Could not find ${t}[${e}]`),n}_resolveScene(t,e){return{...t,id:t.id||`scene-${e}`,nodes:(t.nodes||[]).map((t=>this.getNode(t)))}}_resolveNode(t,e){const n={...t,id:(null==t?void 0:t.id)||`node-${e}`};return void 0!==t.mesh&&(n.mesh=this.getMesh(t.mesh)),void 0!==t.camera&&(n.camera=this.getCamera(t.camera)),void 0!==t.skin&&(n.skin=this.getSkin(t.skin)),void 0!==t.meshes&&t.meshes.length&&(n.mesh=t.meshes.reduce(((t,e)=>{const n=this.getMesh(e);return t.id=n.id,t.primitives=t.primitives.concat(n.primitives),t}),{primitives:[]})),n}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map((t=>this.getNode(t)))),t}_resolveSkin(t,e){const n="number"==typeof t.inverseBindMatrices?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${e}`,inverseBindMatrices:n}}_resolveMesh(t,e){const n={...t,id:t.id||`mesh-${e}`,primitives:[]};return t.primitives&&(n.primitives=t.primitives.map((t=>{const e={...t,attributes:{},indices:void 0,material:void 0},n=t.attributes;for(const t in n)e.attributes[t]=this.getAccessor(n[t]);return void 0!==t.indices&&(e.indices=this.getAccessor(t.indices)),void 0!==t.material&&(e.material=this.getMaterial(t.material)),e}))),n}_resolveMaterial(t,e){const n={...t,id:t.id||`material-${e}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const t=n.pbrMetallicRoughness;t.baseColorTexture&&(t.baseColorTexture={...t.baseColorTexture},t.baseColorTexture.texture=this.getTexture(t.baseColorTexture.index)),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture={...t.metallicRoughnessTexture},t.metallicRoughnessTexture.texture=this.getTexture(t.metallicRoughnessTexture.index))}return n}_resolveAccessor(t,e){const n=(r=t.componentType,vc[r]);var r;const s=(i=t.type,wc[i]);var i;const o=n*s,a={...t,id:t.id||`accessor-${e}`,bytesPerComponent:n,components:s,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(void 0!==t.bufferView&&(a.bufferView=this.getBufferView(t.bufferView)),a.bufferView){const t=a.bufferView.buffer,{ArrayType:e,byteLength:n}=mo(a,a.bufferView),r=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+t.byteOffset;let s=t.arrayBuffer.slice(r,r+n);a.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(t,r,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new e(s)}return a}_getValueFromInterleavedBuffer(t,e,n,r,s){const i=new Uint8Array(s*r);for(let o=0;o<s;o++){const s=e+o*n;i.set(new Uint8Array(t.arrayBuffer.slice(s,s+r)),o*r)}return i.buffer}_resolveTexture(t,e){return{...t,id:t.id||`texture-${e}`,sampler:"number"==typeof t.sampler?this.getSampler(t.sampler):{id:"default-sampler",parameters:Tc},source:"number"==typeof t.source?this.getImage(t.source):void 0}}_resolveSampler(t,e){const n={id:t.id||`sampler-${e}`,...t,parameters:{}};for(const t in n){const e=this._enumSamplerParameter(t);void 0!==e&&(n.parameters[e]=n[t])}return n}_enumSamplerParameter(t){return Ec[t]}_resolveImage(t,e){const n={...t,id:t.id||`image-${e}`,image:null,bufferView:void 0!==t.bufferView?this.getBufferView(t.bufferView):void 0},r=this.images[e];return r&&(n.image=r),n}_resolveBufferView(t,e){const n=t.buffer,r=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return t.byteOffset&&(s+=t.byteOffset),{id:`bufferView-${e}`,...t,buffer:this.buffers[n],data:new Uint8Array(r,s,t.byteLength)}}_resolveCamera(t,e){const n={...t,id:t.id||`camera-${e}`};return n.perspective,n.orthographic,n}}function Mc(t,e){return(new _c).postProcess(t,e)}function Ic(t,e,n,r){t.rotateYtoZ=!0;const s=(t.byteOffset||0)+(t.byteLength||0)-n;if(0===s)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=null!=r&&r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=U(e,n,s),t.gltfByteOffset=0,t.gltfByteLength=s,n%4==0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function xc(t,n,r,s){const i=(null==r?void 0:r["3d-tiles"])||{};if(function(t,e,n){switch(e){case 0:if(t.gltfArrayBuffer){const e=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),n=(new TextDecoder).decode(e);t.gltfUrl=n.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case 1:break;default:throw new Error("b3dm: Illegal glTF format field")}}(t,n),i.loadGLTF){if(!s)return;if(t.gltfUrl){const{fetch:e}=s,n=await e(t.gltfUrl,r);t.gltfArrayBuffer=await n.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const n=await e(t.gltfArrayBuffer,Cc,r,s);t.gltf=Mc(n),t.gpuMemoryUsageInBytes=go(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}async function Sc(t,e,n,r,s){var i;n=function(t,e,n,r,s){n=Ic(t,e,n=Si(t,e,n=xi(t,e,n=Mi(t,e,n))),r);const i=new pi(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=i.getGlobalProperty("RTC_CENTER",ai.FLOAT,3),n}(t,e,n,r),await xc(t,1,r,s);const o=null==t||null===(i=t.gltf)||void 0===i?void 0:i.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),n}async function Oc(t,e,n,r,s){return n=function(t,e,n,r,s){var i;if(n=Mi(t,e,n),1!==t.version)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);n=xi(t,e,n);const o=new DataView(e);if(t.gltfFormat=o.getUint32(n,!0),n=Ic(t,e,n=Si(t,e,n+=4),r),null==t||null===(i=t.header)||void 0===i||!i.featureTableJsonByteLength||0===t.header.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new pi(t.featureTableJson,t.featureTableBinary),c=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return t.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=a.getGlobalProperty("RTC_CENTER",ai.FLOAT,3),new _i(t.batchTableJson,t.batchTableBinary,c),function(t,e,n,r){const s=new Array(r),i=new qe;new qe,new qe,new qe;const o=new en,a=new Cn,c=new qe,h={},l=new dn,u=[],d=[],f=[],m=[];for(let n=0;n<r;n++){let r;if(e.hasProperty("POSITION"))r=e.getProperty("POSITION",ai.FLOAT,3,n,i);else if(e.hasProperty("POSITION_QUANTIZED")){r=e.getProperty("POSITION_QUANTIZED",ai.UNSIGNED_SHORT,3,n,i);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ai.FLOAT,3);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const s=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ai.FLOAT,3);if(!s)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let e=0;e<3;e++)r[e]=r[e]/o*s[e]+t[e]}if(!r)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(r),h.translation=i,t.normalUp=e.getProperty("NORMAL_UP",ai.FLOAT,3,n,u),t.normalRight=e.getProperty("NORMAL_RIGHT",ai.FLOAT,3,n,d),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",ai.UNSIGNED_SHORT,2,n,u),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",ai.UNSIGNED_SHORT,2,n,d),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(jn.WGS84.eastNorthUpToFixedFrame(i,l),l.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),h.rotation=a,c.set(1,1,1);const g=e.getProperty("SCALE",ai.FLOAT,1,n,f);Number.isFinite(g)&&c.multiplyByScalar(g);const p=e.getProperty("SCALE_NON_UNIFORM",ai.FLOAT,3,n,u);p&&c.scale(p),h.scale=c;let A=e.getProperty("BATCH_ID",ai.UNSIGNED_SHORT,1,n,m);void 0===A&&(A=n);const y=(new dn).fromQuaternion(h.rotation);l.identity(),l.translate(h.translation),l.multiplyRight(y),l.scale(h.scale);const B=l.clone();s[n]={modelMatrix:B,batchId:A}}t.instances=s}(t,a,0,c),n}(t,e,n,r),await xc(t,t.gltfFormat||0,r,s),n}async function Rc(t,e,n,r,s,i){n=Mi(t,e,n);const o=new DataView(e);for(t.tilesLength=o.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-n>12;){const o={shape:"tile3d"};t.tiles.push(o),n=await i(e,n,r,s,o)}return n}async function Fc(t,n,r,s){var i,o;if(t.rotateYtoZ=!0,t.gltfUpAxis=null!=r&&null!==(i=r["3d-tiles"])&&void 0!==i&&i.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",null!=r&&null!==(o=r["3d-tiles"])&&void 0!==o&&o.loadGLTF){if(!s)return n.byteLength;const i=await e(n,Cc,r,s);t.gltf=Mc(i),t.gpuMemoryUsageInBytes=go(t.gltf)}else t.gltfArrayBuffer=n;return n.byteLength}async function Dc(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{shape:"tile3d"};switch(s.byteOffset=e,s.type=Ks(t,e),s.type){case Ps:return await Rc(s,t,e,n,r,Dc);case Js:return await Sc(s,t,e,n,r);case ks:return await Fc(s,t,n,r);case js:return await Oc(s,t,e,n,r);case Hs:return await Fi(s,t,e,n,r);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}async function Gc(t,e,n,r){const s=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if("number"!=typeof s)return;const i=t.bufferViews[s],o=t.buffers[i.buffer];if(null==r||!r.baseUrl)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(o.uri){const t=`${(null==r?void 0:r.baseUrl)||""}/${o.uri}`,n=await r.fetch(t),s=await n.arrayBuffer();return void(e.explicitBitstream=new Uint8Array(s,i.byteOffset,i.byteLength))}const a=t.buffers.slice(0,i.buffer).reduce(((t,e)=>t+e.byteLength),0);e.explicitBitstream=new Uint8Array(n.slice(a,a+o.byteLength),i.byteOffset,i.byteLength)}function Lc(t){const e=new DataView(t);return e.getUint32(0,!0)+2**32*e.getUint32(4,!0)}const Uc={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Ns,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(t,e,n){if(1952609651!==new Uint32Array(t.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(t.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");const r=Lc(t.slice(8,16)),s=new Uint8Array(t,24,r),i=new TextDecoder("utf8").decode(s),o=JSON.parse(i),a=Lc(t.slice(16,24));let c=new ArrayBuffer(0);if(a&&(c=t.slice(24+r)),await Gc(o,o.tileAvailability,c,n),Array.isArray(o.contentAvailability))for(const t of o.contentAvailability)await Gc(o,t,c,n);else await Gc(o,o.contentAvailability,c,n);return await Gc(o,o.childSubtreeAvailability,c,n),o},options:{}};var Nc=null;try{Nc=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function Pc(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function Hc(t){return!0===(t&&t.__isLong__)}function Jc(t){var e=Math.clz32(t&-t);return t?31-e:e}Pc.prototype.__isLong__,Object.defineProperty(Pc.prototype,"__isLong__",{value:!0}),Pc.isLong=Hc;var jc={},kc={};function Vc(t,e){var n,r,s;return e?(s=0<=(t>>>=0)&&t<256)&&(r=kc[t])?r:(n=Qc(t,0,!0),s&&(kc[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(r=jc[t])?r:(n=Qc(t,t<0?-1:0,!1),s&&(jc[t]=n),n)}function Kc(t,e){if(isNaN(t))return e?eh:th;if(e){if(t<0)return eh;if(t>=Yc)return oh}else{if(t<=-Zc)return ah;if(t+1>=Zc)return ih}return t<0?Kc(-t,e).neg():Qc(t%Xc|0,t/Xc|0,e)}function Qc(t,e,n){return new Pc(t,e,n)}Pc.fromInt=Vc,Pc.fromNumber=Kc,Pc.fromBits=Qc;var qc=Math.pow;function zc(t,e,n){if(0===t.length)throw Error("empty string");if("number"==typeof e?(n=e,e=!1):e=!!e,"NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return e?eh:th;if((n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return zc(t.substring(1),e,n).neg();for(var s=Kc(qc(n,8)),i=th,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+a),n);if(a<8){var h=Kc(qc(n,a));i=i.mul(h).add(Kc(c))}else i=(i=i.mul(s)).add(Kc(c))}return i.unsigned=e,i}function Wc(t,e){return"number"==typeof t?Kc(t,e):"string"==typeof t?zc(t,e):Qc(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}Pc.fromString=zc,Pc.fromValue=Wc;var Xc=4294967296,Yc=Xc*Xc,Zc=Yc/2,$c=Vc(1<<24),th=Vc(0);Pc.ZERO=th;var eh=Vc(0,!0);Pc.UZERO=eh;var nh=Vc(1);Pc.ONE=nh;var rh=Vc(1,!0);Pc.UONE=rh;var sh=Vc(-1);Pc.NEG_ONE=sh;var ih=Qc(-1,2147483647,!1);Pc.MAX_VALUE=ih;var oh=Qc(-1,-1,!0);Pc.MAX_UNSIGNED_VALUE=oh;var ah=Qc(0,-2147483648,!1);Pc.MIN_VALUE=ah;var ch=Pc.prototype;function hh(t){"X"===t&&(t="");const e=t.padEnd(16,"0");return Pc.fromString(e,!0,16)}ch.toInt=function(){return this.unsigned?this.low>>>0:this.low},ch.toNumber=function(){return this.unsigned?(this.high>>>0)*Xc+(this.low>>>0):this.high*Xc+(this.low>>>0)},ch.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(ah)){var e=Kc(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=Kc(qc(t,6),this.unsigned),i=this,o="";;){var a=i.div(s),c=(i.sub(a.mul(s)).toInt()>>>0).toString(t);if((i=a).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},ch.getHighBits=function(){return this.high},ch.getHighBitsUnsigned=function(){return this.high>>>0},ch.getLowBits=function(){return this.low},ch.getLowBitsUnsigned=function(){return this.low>>>0},ch.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ah)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},ch.isZero=function(){return 0===this.high&&0===this.low},ch.eqz=ch.isZero,ch.isNegative=function(){return!this.unsigned&&this.high<0},ch.isPositive=function(){return this.unsigned||this.high>=0},ch.isOdd=function(){return 1==(1&this.low)},ch.isEven=function(){return 0==(1&this.low)},ch.equals=function(t){return Hc(t)||(t=Wc(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},ch.eq=ch.equals,ch.notEquals=function(t){return!this.eq(t)},ch.neq=ch.notEquals,ch.ne=ch.notEquals,ch.lessThan=function(t){return this.comp(t)<0},ch.lt=ch.lessThan,ch.lessThanOrEqual=function(t){return this.comp(t)<=0},ch.lte=ch.lessThanOrEqual,ch.le=ch.lessThanOrEqual,ch.greaterThan=function(t){return this.comp(t)>0},ch.gt=ch.greaterThan,ch.greaterThanOrEqual=function(t){return this.comp(t)>=0},ch.gte=ch.greaterThanOrEqual,ch.ge=ch.greaterThanOrEqual,ch.compare=function(t){if(Hc(t)||(t=Wc(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},ch.comp=ch.compare,ch.negate=function(){return!this.unsigned&&this.eq(ah)?ah:this.not().add(nh)},ch.neg=ch.negate,ch.add=function(t){Hc(t)||(t=Wc(t));var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,i=t.high>>>16,o=65535&t.high,a=t.low>>>16,c=0,h=0,l=0,u=0;return l+=(u+=s+(65535&t.low))>>>16,h+=(l+=r+a)>>>16,c+=(h+=n+o)>>>16,c+=e+i,Qc((l&=65535)<<16|(u&=65535),(c&=65535)<<16|(h&=65535),this.unsigned)},ch.subtract=function(t){return Hc(t)||(t=Wc(t)),this.add(t.neg())},ch.sub=ch.subtract,ch.multiply=function(t){if(this.isZero())return this;if(Hc(t)||(t=Wc(t)),Nc)return Qc(Nc.mul(this.low,this.high,t.low,t.high),Nc.get_high(),this.unsigned);if(t.isZero())return this.unsigned?eh:th;if(this.eq(ah))return t.isOdd()?ah:th;if(t.eq(ah))return this.isOdd()?ah:th;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt($c)&&t.lt($c))return Kc(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,i=t.high>>>16,o=65535&t.high,a=t.low>>>16,c=65535&t.low,h=0,l=0,u=0,d=0;return u+=(d+=s*c)>>>16,l+=(u+=r*c)>>>16,u&=65535,l+=(u+=s*a)>>>16,h+=(l+=n*c)>>>16,l&=65535,h+=(l+=r*a)>>>16,l&=65535,h+=(l+=s*o)>>>16,h+=e*c+n*a+r*o+s*i,Qc((u&=65535)<<16|(d&=65535),(h&=65535)<<16|(l&=65535),this.unsigned)},ch.mul=ch.multiply,ch.divide=function(t){if(Hc(t)||(t=Wc(t)),t.isZero())throw Error("division by zero");var e,n,r;if(Nc)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?Qc((this.unsigned?Nc.div_u:Nc.div_s)(this.low,this.high,t.low,t.high),Nc.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?eh:th;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return eh;if(t.gt(this.shru(1)))return rh;r=eh}else{if(this.eq(ah))return t.eq(nh)||t.eq(sh)?ah:t.eq(ah)?nh:(e=this.shr(1).div(t).shl(1)).eq(th)?t.isNegative()?nh:sh:(n=this.sub(t.mul(e)),r=e.add(n.div(t)));if(t.eq(ah))return this.unsigned?eh:th;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=th}for(n=this;n.gte(t);){e=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),i=s<=48?1:qc(2,s-48),o=Kc(e),a=o.mul(t);a.isNegative()||a.gt(n);)a=(o=Kc(e-=i,this.unsigned)).mul(t);o.isZero()&&(o=nh),r=r.add(o),n=n.sub(a)}return r},ch.div=ch.divide,ch.modulo=function(t){return Hc(t)||(t=Wc(t)),Nc?Qc((this.unsigned?Nc.rem_u:Nc.rem_s)(this.low,this.high,t.low,t.high),Nc.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},ch.mod=ch.modulo,ch.rem=ch.modulo,ch.not=function(){return Qc(~this.low,~this.high,this.unsigned)},ch.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},ch.clz=ch.countLeadingZeros,ch.countTrailingZeros=function(){return this.low?Jc(this.low):Jc(this.high)+32},ch.ctz=ch.countTrailingZeros,ch.and=function(t){return Hc(t)||(t=Wc(t)),Qc(this.low&t.low,this.high&t.high,this.unsigned)},ch.or=function(t){return Hc(t)||(t=Wc(t)),Qc(this.low|t.low,this.high|t.high,this.unsigned)},ch.xor=function(t){return Hc(t)||(t=Wc(t)),Qc(this.low^t.low,this.high^t.high,this.unsigned)},ch.shiftLeft=function(t){return Hc(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Qc(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Qc(0,this.low<<t-32,this.unsigned)},ch.shl=ch.shiftLeft,ch.shiftRight=function(t){return Hc(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Qc(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Qc(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},ch.shr=ch.shiftRight,ch.shiftRightUnsigned=function(t){return Hc(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?Qc(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):Qc(32===t?this.high:this.high>>>t-32,0,this.unsigned)},ch.shru=ch.shiftRightUnsigned,ch.shr_u=ch.shiftRightUnsigned,ch.rotateLeft=function(t){var e;return Hc(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?Qc(this.high,this.low,this.unsigned):t<32?(e=32-t,Qc(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(e=32-(t-=32),Qc(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))},ch.rotl=ch.rotateLeft,ch.rotateRight=function(t){var e;return Hc(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?Qc(this.high,this.low,this.unsigned):t<32?(e=32-t,Qc(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(e=32-(t-=32),Qc(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))},ch.rotr=ch.rotateRight,ch.toSigned=function(){return this.unsigned?Qc(this.low,this.high,!1):this},ch.toUnsigned=function(){return this.unsigned?this:Qc(this.low,this.high,!0)},ch.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},ch.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},ch.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Pc.fromBytes=function(t,e,n){return n?Pc.fromBytesLE(t,e):Pc.fromBytesBE(t,e)},Pc.fromBytesLE=function(t,e){return new Pc(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Pc.fromBytesBE=function(t,e){return new Pc(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const lh=180/Math.PI;function uh(t,e,n){const r=1<<e;return[(t[0]+n[0])/r,(t[1]+n[1])/r]}function dh(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function fh(t){return[dh(t[0]),dh(t[1])]}function mh(t,e){let[n,r]=e;switch(t){case 0:return[1,n,r];case 1:return[-n,1,r];case 2:return[-n,-r,1];case 3:return[-1,-r,-n];case 4:return[r,-1,-n];case 5:return[r,n,-1];default:throw new Error("Invalid face")}}function gh(t){let[e,n,r]=t;const s=Math.atan2(r,Math.sqrt(e*e+n*n));return[Math.atan2(n,e)*lh,s*lh]}function ph(t,e,n,r){if(0===r){1===n&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function Ah(t){const{face:e,ij:n,level:r}=t,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(100*Math.pow(2,-r))),o=new Float64Array(4*i*2+2);let a=0,c=0;for(let t=0;t<4;t++){const h=s[t].slice(0),l=s[t+1],u=(l[0]-h[0])/i,d=(l[1]-h[1])/i;for(let t=0;t<i;t++){h[0]+=u,h[1]+=d;const t=gh(mh(e,fh(uh(n,r,h))));Math.abs(t[1])>89.999&&(t[0]=c);const s=t[0]-c;t[0]+=s>180?-360:s<-180?360:0,o[a++]=t[0],o[a++]=t[1],c=t[0]}}return o[a++]=o[0],o[a++]=o[1],o}function yh(t){const e=function(t){return t.indexOf("/")>0?t:function(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<64;)e="0"+e;const n=e.lastIndexOf("1"),r=e.substring(0,3),s=e.substring(3,n),i=s.length/2,o=Pc.fromString(r,!0,2).toString(10);let a="";if(0!==i)for(a=Pc.fromString(s,!0,2).toString(4);a.length<i;)a="0"+a;return`${o}/${a}`}(hh(t))}(t),n=function(t){if(0===t.length)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),n=parseInt(e[0],10),r=e[1],s=r.length;let i=0;const o=[0,0];for(let t=s-1;t>=0;t--){i=s-t;const e=r[t];let n=0,a=0;"1"===e?a=1:"2"===e?(n=1,a=1):"3"===e&&(n=1);const c=Math.pow(2,i-1);ph(c,o,n,a),o[0]+=c*n,o[1]+=c*a}if(n%2==1){const t=o[0];o[0]=o[1],o[1]=t}return{face:n,ij:o,level:i}}(e);return n}function Bh(t){if(t.length%2!=0)throw new Error("Invalid corners");const e=[],n=[];for(let r=0;r<t.length;r+=2)e.push(t[r]),n.push(t[r+1]);return e.sort(((t,e)=>t-e)),n.sort(((t,e)=>t-e)),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function bh(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},r=function(t,e){const n=(null==e?void 0:e.minimumHeight)||0,r=(null==e?void 0:e.maximumHeight)||0,s=function(t){let e;if(2===t.face||5===t.face){let n=null,r=0;for(let e=0;e<4;e++){const s=Ah(yh(`${t.face}/${e}`));null==n&&(n=new Float64Array(4*s.length)),n.set(s,r),r+=s.length}e=Bh(n)}else e=Bh(Ah(t));return e}(yh(t)),i=s.west,o=s.south,a=s.east,c=s.north,h=[];return h.push(new qe(i,c,n)),h.push(new qe(a,c,n)),h.push(new qe(a,o,n)),h.push(new qe(i,o,n)),h.push(new qe(i,c,r)),h.push(new qe(a,c,r)),h.push(new qe(a,o,r)),h.push(new qe(i,o,r)),h}(e,n),s=function(t){const e=fh(uh(t.ij,t.level,[.5,.5]));return gh(mh(t.face,e))}(yh(e)),i=s[0],o=s[1],a=jn.WGS84.cartographicToCartesian([i,o,n.maximumHeight]),c=new qe(a[0],a[1],a[2]);r.push(c);const h=function(t,e=new nr){if(!t||0===t.length)return e.halfAxes=new en([0,0,0,0,0,0,0,0,0]),e.center=new qe,e;const n=t.length,r=new qe(0,0,0);for(const e of t)r.add(e);const s=1/n;r.multiplyByScalar(s);let i=0,o=0,a=0,c=0,h=0,l=0;for(const e of t){const t=_r.copy(e).subtract(r);i+=t.x*t.x,o+=t.x*t.y,a+=t.x*t.z,c+=t.y*t.y,h+=t.y*t.z,l+=t.z*t.z}i*=s,o*=s,a*=s,c*=s,h*=s,l*=s;const u=Or;u[0]=i,u[1]=o,u[2]=a,u[3]=o,u[4]=c,u[5]=h,u[6]=a,u[7]=h,u[8]=l;const{unitary:d}=function(t,e={}){let n=0,r=0;const s=yr,i=Br;s.identity(),i.copy(t);const o=1e-20*function(t){let e=0;for(let n=0;n<9;++n){const r=t[n];e+=r*r}return Math.sqrt(e)}(i);for(;r<10&&Er(i)>o;)Tr(i,br),Cr.copy(br).transpose(),i.multiplyRight(br),i.multiplyLeft(Cr),s.multiplyRight(br),++n>2&&(++r,n=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=i.toTarget(e.diagonal),e}(u,Rr),f=e.halfAxes.copy(d);let m=f.getColumn(0,Ir),g=f.getColumn(1,xr),p=f.getColumn(2,Sr),A=-Number.MAX_VALUE,y=-Number.MAX_VALUE,B=-Number.MAX_VALUE,b=Number.MAX_VALUE,C=Number.MAX_VALUE,w=Number.MAX_VALUE;for(const e of t)_r.copy(e),A=Math.max(_r.dot(m),A),y=Math.max(_r.dot(g),y),B=Math.max(_r.dot(p),B),b=Math.min(_r.dot(m),b),C=Math.min(_r.dot(g),C),w=Math.min(_r.dot(p),w);m=m.multiplyByScalar(.5*(b+A)),g=g.multiplyByScalar(.5*(C+y)),p=p.multiplyByScalar(.5*(w+B)),e.center.copy(m).add(g).add(p);const v=Mr.set(A-b,y-C,B-w).multiplyByScalar(.5),E=new en([v[0],0,0,0,v[1],0,0,0,v[2]]);return e.halfAxes.multiplyRight(E),e}(r);return[...h.center,...h.halfAxes]}const Ch={QUADTREE:4,OCTREE:8};function wh(t,e,n){if(null!=t&&t.box){const r=function(t,e){const n=function(t){return t.and(t.not().add(1))}(t).shiftRightUnsigned(2);return t.add(Pc.fromNumber(2*e+1-4).multiply(n))}(hh(t.s2VolumeInfo.token),e),s=function(t){if(t.isZero())return"X";let e=t.countTrailingZeros();e=(e-e%4)/4;const n=e;e*=4;const r=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-r.length).join("0")+r}(r),i={...t.s2VolumeInfo};if(i.token=s,"OCTREE"===n){const e=t.s2VolumeInfo,n=e.maximumHeight-e.minimumHeight,r=n/2,s=e.minimumHeight+n/2;e.minimumHeight=s-r,e.maximumHeight=s+r}return{box:bh(i),s2VolumeInfo:i}}}async function vh(t){const{implicitOptions:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,s2VolumeBox:s,loaderOptions:i}=t;let{subtree:o,level:a=0,globalData:c={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;const{subdivisionScheme:h,subtreeLevels:l,maximumLevel:u,contentUrlTemplate:d,subtreesUriTemplate:f,basePath:m}=e,g={children:[],lodMetricValue:0,contentUrl:""};if(!u)return Ft.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${d} won't be loaded...`),g;const p=a+c.level;if(p>u)return g;const A=Ch[h],y=Math.log2(A),B=1&r,b=r>>1&1,C=r>>2&1,w=(A**a-1)/(A-1);let v=_h(n.mortonIndex,r,y),E=w+v,T=_h(n.x,B,1),_=_h(n.y,b,1),M=_h(n.z,C,1),I=!1;a>=l&&(I=Eh(o.childSubtreeAvailability,v));const x=_h(c.x,T,a),S=_h(c.y,_,a),O=_h(c.z,M,a);if(I){const t=Mh(`${m}/${f}`,p,x,S,O);o=await le(t,Uc,i),c={mortonIndex:v,x:T,y:_,z:M,level:a},v=0,E=0,T=0,_=0,M=0,a=0}if(!Eh(o.tileAvailability,E))return g;Eh(o.contentAvailability,E)&&(g.contentUrl=Mh(d,p,x,S,O));const R=a+1,F={mortonIndex:v,x:T,y:_,z:M};for(let t=0;t<A;t++){const n=wh(s,t,h),r=await vh({subtree:o,implicitOptions:e,loaderOptions:i,parentData:F,childIndex:t,level:R,globalData:{...c},s2VolumeBox:n});if(r.contentUrl||r.children.length){const t=Th(r,p+1,{childTileX:T,childTileY:_,childTileZ:M},e,s);g.children.push(t)}}return g}function Eh(t,e){let n;return Array.isArray(t)?(n=t[0],t.length>1&&Ft.once('Not supported extension "3DTILES_multiple_contents" has been detected')):n=t,"constant"in n?Boolean(n.constant):!!n.explicitBitstream&&function(t,e){const n=t%8;return 1==(e[Math.floor(t/8)]>>n&1)}(e,n.explicitBitstream)}function Th(t,e,n,r,s){const{basePath:i,refine:o,getRefine:a,lodMetricType:c,getTileType:h,rootLodMetricValue:l,rootBoundingVolume:u}=r,d=t.contentUrl&&t.contentUrl.replace(`${i}/`,""),f=l/2**e,m=function(t,e,n){if(e.region){const{childTileX:r,childTileY:s,childTileZ:i}=n,[o,a,c,h,l,u]=e.region,d=2**t,f=(c-o)/d,m=(h-a)/d,g=(u-l)/d,[p,A]=[o+f*r,o+f*(r+1)],[y,B]=[a+m*s,a+m*(s+1)],[b,C]=[l+g*i,l+g*(i+1)];return{region:[p,y,A,B,b,C]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${e}`)}(e,null!=s&&s.box?{box:s.box}:u,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:d},id:t.contentUrl,refine:a(o),type:h(t),lodMetricType:c,lodMetricValue:f,geometricError:f,transform:t.transform,boundingVolume:m}}function _h(t,e,n){return(t<<n)+e}function Mh(t,e,n,r,s){const i=function(t){const e={};for(const n in t)e[`{${n}}`]=t[n];return e}({level:e,x:n,y:r,z:s});return t.replace(/{level}|{x}|{y}|{z}/gi,(t=>i[t]))}function Ih(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return Vr.EMPTY;const n=e.split("?")[0],r=n.split(".").pop();switch(r){case"pnts":return Vr.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Vr.SCENEGRAPH;default:return r||Vr.EMPTY}}function xh(t){switch(t){case"REPLACE":case"replace":return jr.REPLACE;case"ADD":case"add":return jr.ADD;default:return t}}function Sh(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(t,`${e}/`);return decodeURI(n.toString())}return t.startsWith("/")?t:function(){const t=[];for(let e=0;e<arguments.length;e++)t[e]=e<0||arguments.length<=e?void 0:arguments[e];let e,n="",r=!1;for(let s=t.length-1;s>=-1&&!r;s--){let i;s>=0?i=t[s]:(void 0===e&&(e=q()),i=e),0!==i.length&&(n=`${i}/${n}`,r=i.charCodeAt(0)===X)}return n=Y(n,!r),r?`/${n}`:n.length>0?n:"."}(e,t)}function Oh(t,e){if(!t)return null;let n;if(t.content){var r;const s=t.content.uri||(null===(r=t.content)||void 0===r?void 0:r.url);void 0!==s&&(n=Sh(s,e))}return{...t,id:n,contentUrl:n,lodMetricType:zr.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:Ih(t,n),refine:xh(t.refine)}}async function Rh(t,e,n,r,s){var i,o,a;const{subdivisionScheme:c,maximumLevel:h,availableLevels:l,subtreeLevels:u,subtrees:{uri:d}}=r,f=Sh(Mh(d,0,0,0,0),n),m=await le(f,Uc,s),g=null===(i=t.content)||void 0===i?void 0:i.uri,p=g?Sh(g,n):"",A=null==e||null===(o=e.root)||void 0===o?void 0:o.refine,y=t.geometricError,B=null===(a=t.boundingVolume.extensions)||void 0===a?void 0:a["3DTILES_bounding_volume_S2"];if(B){const e={box:bh(B),s2VolumeInfo:B};t.boundingVolume=e}const b=t.boundingVolume,C={contentUrlTemplate:p,subtreesUriTemplate:d,subdivisionScheme:c,subtreeLevels:u,maximumLevel:Number.isFinite(l)?l-1:h,refine:A,basePath:n,lodMetricType:zr.GEOMETRIC_ERROR,rootLodMetricValue:y,rootBoundingVolume:b,getTileType:Ih,getRefine:xh};return await async function(t,e,n,r,s){if(!t)return null;const{children:i,contentUrl:o}=await vh({subtree:n,implicitOptions:r,loaderOptions:s});let a,c=null;return o&&(a=o,c={uri:o.replace(`${e}/`,"")}),{...t,id:a,contentUrl:a,lodMetricType:zr.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:Ih(t,a),refine:xh(t.refine),content:c||t.content,children:i}}(t,n,m,C,s)}function Fh(t){var e;return(null==t||null===(e=t.extensions)||void 0===e?void 0:e["3DTILES_implicit_tiling"])||(null==t?void 0:t.implicitTiling)}const Dh={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Ns,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=e["3d-tiles"]||{};let s;return s="auto"===r.isTileset?(null==n?void 0:n.url)&&-1!==n.url.indexOf(".json"):r.isTileset,s?Gh(t,e,n):Lh(t,e,n)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Gh(t,e,n){var r;const s=JSON.parse((new TextDecoder).decode(t)),i=(null==n?void 0:n.url)||"",o=function(t){return W(t)}(i),a=await async function(t,e,n){let r=null;const s=Fh(t.root);r=s&&t.root?await Rh(t.root,t,e,s,n):Oh(t.root,e);const i=[];for(i.push(r);i.length>0;){const r=i.pop()||{},s=r.children||[],o=[];for(const r of s){const s=Fh(r);let a;a=s?await Rh(r,t,e,s,n):Oh(r,e),a&&(o.push(a),i.push(a))}r.children=o}return r}(s,o,e||{});return{...s,shape:"tileset3d",loader:Dh,url:i,queryString:(null==n?void 0:n.queryString)||"",basePath:o,root:a||s.root,type:Qr.TILES3D,lodMetricType:zr.GEOMETRIC_ERROR,lodMetricValue:(null===(r=s.root)||void 0===r?void 0:r.geometricError)||0}}async function Lh(t,e,n){const r={shape:"tile3d",featureIds:null};return await Dc(t,0,e,n,r),r}const Uh="https://api.cesium.com/v1/assets";async function Nh(t,e){if(!e){const r=await async function(t){n(t);const e={Authorization:`Bearer ${t}`},r=await dt("https://api.cesium.com/v1/assets",{headers:e});if(!r.ok)throw new Error(r.statusText);return await r.json()}(t);for(const t of r.items)"3DTILES"===t.type&&(e=t.id)}const r=await async function(t,e){n(t,e);const r={Authorization:`Bearer ${t}`},s=`${Uh}/${e}`;let i=await dt(`${s}`,{headers:r});if(!i.ok)throw new Error(i.statusText);let o=await i.json();if(i=await dt(`${s}/endpoint`,{headers:r}),!i.ok)throw new Error(i.statusText);const a=await i.json();return o={...o,...a},o}(t,e),{type:s,url:i}=r;return n("3DTILES"===s&&i),r.headers={Authorization:`Bearer ${r.accessToken}`},r}const Ph={...Dh,id:"cesium-ion",name:"Cesium Ion",preload:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e["cesium-ion"]||{};const{accessToken:n}=e;let r=e.assetId;if(!Number.isFinite(r)){const e=t.match(/\/([0-9]+)\/tileset.json/);r=e&&e[1]}return Nh(n,r)},parse:async(t,e,n)=>((e={...e})["3d-tiles"]=e["cesium-ion"],e.loader=Ph,Dh.parse(t,e,n)),options:{"cesium-ion":{...Dh.options["3d-tiles"],accessToken:null}}};class Hh{constructor(t,e){if(this.schema=void 0,this.options=void 0,this.shape=void 0,this.length=0,this.rows=null,this.cursor=0,this._headers=[],this.options=e,this.schema=t,!Array.isArray(t)){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}rowCount(){return this.length}addArrayRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="array-row-table",this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}addObjectRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="object-row-table",this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}class Jh{constructor(t,e){if(this.schema=void 0,this.options=void 0,this.length=0,this.objectRows=null,this.arrayRows=null,this.cursor=0,this._headers=null,this.options=e,this.schema=t,t){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}rowCount(){return this.length}addArrayRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||(this._headers=function(t){const e=[];for(let n=0;n<t.length;n++){const t=`column-${n}`;e.push(t)}return e}(t)),this.options.shape){case"object-row-table":const n=function(t,e){if(!t)throw new Error("null row");const n={};if(e)for(let r=0;r<e.length;r++)n[e[r]]=t[r];else for(let e=0;e<t.length;e++)n[`column-${e}`]=t[e];return n}(t,this._headers);this.addObjectRow(n,e);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(100),this.arrayRows[this.length]=t,this.length++}}addObjectRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||(this._headers=function(t){return Object.keys(t)}(t)),this.options.shape){case"array-row-table":const n=function(t,e){if(!t)throw new Error("null row");if(e){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return n}return Object.values(t)}(t,this._headers);this.addArrayRow(n,e);break;case"object-row-table":this.objectRows=this.objectRows||new Array(100),this.objectRows[this.length]=t,this.length++}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}class jh{constructor(t,e){this.schema=void 0,this.length=0,this.allocated=0,this.columns={},this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let e=0;for(const n in this.columns)this.columns[n][this.length]=t[e++];this.length++}addObjectRow(t){this._reallocateColumns();for(const e in t)this.columns[e][this.length]=t[e];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const e in this.schema){const n=this.schema[e];t[n.name]=this.columns[n.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:100,this.columns={};for(const t in this.schema){const e=this.schema[t],n=e.type||Float32Array,r=this.columns[e.index];if(r&&ArrayBuffer.isView(r)){const t=new n(this.allocated);t.set(r),this.columns[e.index]=t}else r?(r.length=this.allocated,this.columns[e.index]=r):this.columns[e.index]=new n(this.allocated)}}}_pruneColumns(){for(const[t,e]of Object.entries(this.columns))this.columns[t]=e.slice(0,this.length)}}const kh={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0};class Vh{constructor(t,e){this.schema=void 0,this.options=void 0,this.aggregator=null,this.batchCount=0,this.bytesUsed=0,this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),this.totalLength=0,this.totalBytes=0,this.rowBytes=0,this.schema=t,this.options={...kh,...e}}limitReached(){var t,e;return!!(Boolean(null===(t=this.options)||void 0===t?void 0:t.limit)&&this.totalLength>=this.options.limit)||!!(Boolean(null===(e=this.options)||void 0===e?void 0:e._limitMB)&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),"string"==typeof t&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?8*t.length:8*Object.keys(t).length}_isFull(){if(!this.aggregator||0===this.aggregator.rowCount())return!1;if("auto"===this.options.batchSize){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return!(this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs||(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),0))}_getBatch(t){if(!this.aggregator)return null;null!=t&&t.bytesUsed&&(this.bytesUsed=t.bytesUsed);const e=this.aggregator.getBatch();return e.count=this.batchCount,e.bytesUsed=this.bytesUsed,Object.assign(e,t),this.batchCount++,this.aggregator=null,e}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return Jh;case"columnar-table":return jh;case"arrow-table":if(!Vh.ArrowBatch)throw new Error("TableBatchBuilder");return Vh.ArrowBatch;default:return Hh}}}Vh.ArrowBatch=void 0;const Kh=Number.MAX_SAFE_INTEGER;var Qh,qh=((Qh=qh||{})[Qh.BEGIN=0]="BEGIN",Qh[Qh.VALUE=1]="VALUE",Qh[Qh.OPEN_OBJECT=2]="OPEN_OBJECT",Qh[Qh.CLOSE_OBJECT=3]="CLOSE_OBJECT",Qh[Qh.OPEN_ARRAY=4]="OPEN_ARRAY",Qh[Qh.CLOSE_ARRAY=5]="CLOSE_ARRAY",Qh[Qh.TEXT_ESCAPE=6]="TEXT_ESCAPE",Qh[Qh.STRING=7]="STRING",Qh[Qh.BACKSLASH=8]="BACKSLASH",Qh[Qh.END=9]="END",Qh[Qh.OPEN_KEY=10]="OPEN_KEY",Qh[Qh.CLOSE_KEY=11]="CLOSE_KEY",Qh[Qh.TRUE=12]="TRUE",Qh[Qh.TRUE2=13]="TRUE2",Qh[Qh.TRUE3=14]="TRUE3",Qh[Qh.FALSE=15]="FALSE",Qh[Qh.FALSE2=16]="FALSE2",Qh[Qh.FALSE3=17]="FALSE3",Qh[Qh.FALSE4=18]="FALSE4",Qh[Qh.NULL=19]="NULL",Qh[Qh.NULL2=20]="NULL2",Qh[Qh.NULL3=21]="NULL3",Qh[Qh.NUMBER_DECIMAL_POINT=22]="NUMBER_DECIMAL_POINT",Qh[Qh.NUMBER_DIGIT=23]="NUMBER_DIGIT",Qh);const zh=101,Wh=/[\\"\n]/g,Xh={onready:()=>{},onopenobject:()=>{},onkey:()=>{},oncloseobject:()=>{},onopenarray:()=>{},onclosearray:()=>{},onvalue:()=>{},onerror:()=>{},onend:()=>{},onchunkparsed:()=>{}};class Yh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=Xh,this.bufferCheckPosition=Kh,this.q="",this.c="",this.p="",this.closed=!1,this.closedRoot=!1,this.sawRoot=!1,this.error=null,this.state=qh.BEGIN,this.stack=[],this.position=0,this.column=0,this.line=1,this.slashed=!1,this.unicodeI=0,this.unicodeS=null,this.depth=0,this.textNode=void 0,this.numberNode=void 0,this.options={...Xh,...t},this.textNode=void 0,this.numberNode="",this.emit("onready")}end(){return this.state===qh.VALUE&&0===this.depth||this._error("Unexpected end"),this._closeValue(),this.c="",this.closed=!0,this.emit("onend"),this}resume(){return this.error=null,this}close(){return this.write(null)}emit(t,e){var n,r;null===(n=(r=this.options)[t])||void 0===n||n.call(r,e,this)}emitNode(t,e){this._closeValue(),this.emit(t,e)}write(t){if(this.error)throw this.error;if(this.closed)return this._error("Cannot write after close. Assign an onready handler.");if(null===t)return this.end();let e=0,n=t.charCodeAt(0),r=this.p;for(;n&&(r=n,this.c=n=t.charCodeAt(e++),r!==n?this.p=r:r=this.p,n);)switch(this.position++,10===n?(this.line++,this.column=0):this.column++,this.state){case qh.BEGIN:123===n?this.state=qh.OPEN_OBJECT:91===n?this.state=qh.OPEN_ARRAY:Zh(n)||this._error("Non-whitespace before {[.");continue;case qh.OPEN_KEY:case qh.OPEN_OBJECT:if(Zh(n))continue;if(this.state===qh.OPEN_KEY)this.stack.push(qh.CLOSE_KEY);else{if(125===n){this.emit("onopenobject"),this.depth++,this.emit("oncloseobject"),this.depth--,this.state=this.stack.pop()||qh.VALUE;continue}this.stack.push(qh.CLOSE_OBJECT)}34===n?this.state=qh.STRING:this._error('Malformed object key should start with "');continue;case qh.CLOSE_KEY:case qh.CLOSE_OBJECT:if(Zh(n))continue;58===n?(this.state===qh.CLOSE_OBJECT?(this.stack.push(qh.CLOSE_OBJECT),this._closeValue("onopenobject"),this.depth++):this._closeValue("onkey"),this.state=qh.VALUE):125===n?(this.emitNode("oncloseobject"),this.depth--,this.state=this.stack.pop()||qh.VALUE):44===n?(this.state===qh.CLOSE_OBJECT&&this.stack.push(qh.CLOSE_OBJECT),this._closeValue(),this.state=qh.OPEN_KEY):this._error("Bad object");continue;case qh.OPEN_ARRAY:case qh.VALUE:if(Zh(n))continue;if(this.state===qh.OPEN_ARRAY){if(this.emit("onopenarray"),this.depth++,this.state=qh.VALUE,93===n){this.emit("onclosearray"),this.depth--,this.state=this.stack.pop()||qh.VALUE;continue}this.stack.push(qh.CLOSE_ARRAY)}34===n?this.state=qh.STRING:123===n?this.state=qh.OPEN_OBJECT:91===n?this.state=qh.OPEN_ARRAY:116===n?this.state=qh.TRUE:102===n?this.state=qh.FALSE:110===n?this.state=qh.NULL:45===n?this.numberNode+="-":48<=n&&n<=57?(this.numberNode+=String.fromCharCode(n),this.state=qh.NUMBER_DIGIT):this._error("Bad value");continue;case qh.CLOSE_ARRAY:if(44===n)this.stack.push(qh.CLOSE_ARRAY),this._closeValue("onvalue"),this.state=qh.VALUE;else if(93===n)this.emitNode("onclosearray"),this.depth--,this.state=this.stack.pop()||qh.VALUE;else{if(Zh(n))continue;this._error("Bad array")}continue;case qh.STRING:void 0===this.textNode&&(this.textNode="");let s=e-1,i=this.slashed,o=this.unicodeI;t:for(;;){for(;o>0;)if(this.unicodeS+=String.fromCharCode(n),n=t.charCodeAt(e++),this.position++,4===o?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),o=0,s=e-1):o++,!n)break t;if(34===n&&!i){this.state=this.stack.pop()||qh.VALUE,this.textNode+=t.substring(s,e-1),this.position+=e-1-s;break}if(92===n&&!i&&(i=!0,this.textNode+=t.substring(s,e-1),this.position+=e-1-s,n=t.charCodeAt(e++),this.position++,!n))break;if(i){if(i=!1,110===n?this.textNode+="\n":114===n?this.textNode+="\r":116===n?this.textNode+="\t":102===n?this.textNode+="\f":98===n?this.textNode+="\b":117===n?(o=1,this.unicodeS=""):this.textNode+=String.fromCharCode(n),n=t.charCodeAt(e++),this.position++,s=e-1,n)continue;break}Wh.lastIndex=e;const r=Wh.exec(t);if(null===r){e=t.length+1,this.textNode+=t.substring(s,e-1),this.position+=e-1-s;break}if(e=r.index+1,n=t.charCodeAt(r.index),!n){this.textNode+=t.substring(s,e-1),this.position+=e-1-s;break}}this.slashed=i,this.unicodeI=o;continue;case qh.TRUE:114===n?this.state=qh.TRUE2:this._error(`Invalid true started with t${n}`);continue;case qh.TRUE2:117===n?this.state=qh.TRUE3:this._error(`Invalid true started with tr${n}`);continue;case qh.TRUE3:n===zh?(this.emit("onvalue",!0),this.state=this.stack.pop()||qh.VALUE):this._error(`Invalid true started with tru${n}`);continue;case qh.FALSE:97===n?this.state=qh.FALSE2:this._error(`Invalid false started with f${n}`);continue;case qh.FALSE2:108===n?this.state=qh.FALSE3:this._error(`Invalid false started with fa${n}`);continue;case qh.FALSE3:115===n?this.state=qh.FALSE4:this._error(`Invalid false started with fal${n}`);continue;case qh.FALSE4:n===zh?(this.emit("onvalue",!1),this.state=this.stack.pop()||qh.VALUE):this._error(`Invalid false started with fals${n}`);continue;case qh.NULL:117===n?this.state=qh.NULL2:this._error(`Invalid null started with n${n}`);continue;case qh.NULL2:108===n?this.state=qh.NULL3:this._error(`Invalid null started with nu${n}`);continue;case qh.NULL3:108===n?(this.emit("onvalue",null),this.state=this.stack.pop()||qh.VALUE):this._error(`Invalid null started with nul${n}`);continue;case qh.NUMBER_DECIMAL_POINT:46===n?(this.numberNode+=".",this.state=qh.NUMBER_DIGIT):this._error("Leading zero not followed by .");continue;case qh.NUMBER_DIGIT:48<=n&&n<=57?this.numberNode+=String.fromCharCode(n):46===n?(-1!==this.numberNode.indexOf(".")&&this._error("Invalid number has two dots"),this.numberNode+="."):n===zh||69===n?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||this._error("Invalid number has two exponential"),this.numberNode+="e"):43===n||45===n?(r!==zh&&69!==r&&this._error("Invalid symbol in number"),this.numberNode+=String.fromCharCode(n)):(this._closeNumber(),e--,this.state=this.stack.pop()||qh.VALUE);continue;default:this._error(`Unknown state: ${this.state}`)}return this.position>=this.bufferCheckPosition&&function(t){const e=Math.max(Kh,10);let n=0;for(const r of["textNode","numberNode"]){const s=void 0===t[r]?0:t[r].length;s>e&&("text"===r||t._error(`Max buffer length exceeded: ${r}`)),n=Math.max(n,s)}t.bufferCheckPosition=Kh-n+t.position}(this),this.emit("onchunkparsed"),this}_closeValue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"onvalue";void 0!==this.textNode&&this.emit(t,this.textNode),this.textNode=void 0}_closeNumber(){this.numberNode&&this.emit("onvalue",parseFloat(this.numberNode)),this.numberNode=""}_error(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._closeValue(),t+=`\nLine: ${this.line}\nColumn: ${this.column}\nChar: ${this.c}`;const e=new Error(t);this.error=e,this.emit("onerror",e)}}function Zh(t){return 13===t||10===t||32===t||9===t}class $h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.path=void 0,this.path=["$"],t instanceof $h)this.path=[...t.path];else if(Array.isArray(t))this.path.push(...t);else if("string"==typeof t&&(this.path=t.split("."),"$"!==this.path[0]))throw new Error("JSONPaths must start with $")}clone(){return new $h(this)}toString(){return this.path.join(".")}push(t){this.path.push(t)}pop(){return this.path.pop()}set(t){this.path[this.path.length-1]=t}equals(t){if(!this||!t||this.path.length!==t.path.length)return!1;for(let e=0;e<this.path.length;++e)if(this.path[e]!==t.path[e])return!1;return!0}setFieldAtPath(t,e){const n=[...this.path];n.shift();const r=n.pop();for(const e of n)t=t[e];t[r]=e}getFieldAtPath(t){const e=[...this.path];e.shift();const n=e.pop();for(const n of e)t=t[n];return t[n]}}class tl extends class{constructor(t){this.parser=void 0,this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new $h,this.reset(),this.parser=new Yh({onready:()=>{this.jsonpath=new $h,this.previousStates.length=0,this.currentState.container.length=0},onopenobject:t=>{this._openObject({}),void 0!==t&&this.parser.emit("onkey",t)},onkey:t=>{this.jsonpath.set(t),this.currentState.key=t},oncloseobject:()=>{this._closeObject()},onopenarray:()=>{this._openArray()},onclosearray:()=>{this._closeArray()},onvalue:t=>{this._pushOrSet(t)},onerror:t=>{throw t},onend:()=>{this.result=this.currentState.container.pop()},...t})}reset(){this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new $h}write(t){this.parser.write(t)}close(){this.parser.close()}_pushOrSet(t){const{container:e,key:n}=this.currentState;null!==n?(e[n]=t,this.currentState.key=null):e.push(t)}_openArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!0,key:null}}_closeArray(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}_openObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!1,key:null}}_closeObject(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}}{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({onopenarray:()=>{if(!this.streamingArray&&this._matchJSONPath())return this.streamingJsonPath=this.getJsonPath().clone(),this.streamingArray=[],void this._openArray(this.streamingArray);this._openArray()},onopenobject:t=>{this.topLevelObject?this._openObject({}):(this.topLevelObject={},this._openObject(this.topLevelObject)),void 0!==t&&this.parser.emit("onkey",t)}}),this.jsonPaths=void 0,this.streamingJsonPath=null,this.streamingArray=null,this.topLevelObject=null;const e=t.jsonpaths||[];this.jsonPaths=e.map((t=>new $h(t)))}write(t){super.write(t);let e=[];return this.streamingArray&&(e=[...this.streamingArray],this.streamingArray.length=0),e}getPartialResult(){return this.topLevelObject}getStreamingJsonPath(){return this.streamingJsonPath}getStreamingJsonPathAsString(){return this.streamingJsonPath&&this.streamingJsonPath.toString()}getJsonPath(){return this.jsonpath}_matchJSONPath(){const t=this.getJsonPath();if(0===this.jsonPaths.length)return!0;for(const e of this.jsonPaths)if(e.equals(t))return!0;return!1}}const el={x:0,y:1,z:2};function nl(t,e={}){const{start:n=0,end:r=t.length,plane:s="xy"}=e,i=e.size||2;let o=0;const a=el[s[0]],c=el[s[1]];for(let e=n,s=r-i;e<r;e+=i)o+=(t[e+a]-t[s+a])*(t[e+c]+t[s+c]),s=e;return o/2}function rl(t,e,n,r,s,i,o){let a,c;void 0===i&&(i=nl(t,{start:e,end:n,size:r,plane:o}));let h=el[o[0]],l=el[o[1]];if(s===i<0)for(a=e;a<n;a+=r)c=El(a,t[a+h],t[a+l],c);else for(a=n-r;a>=e;a-=r)c=El(a,t[a+h],t[a+l],c);return c&&yl(c,c.next)&&(Tl(c),c=c.next),c}function sl(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!yl(r,r.next)&&0!==Al(r.prev,r,r.next))r=r.next;else{if(Tl(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function il(t,e,n,r,s,i,o){if(!t)return;!o&&i&&function(t,e,n,r){let s=t;do{0===s.z&&(s.z=fl(s.x,s.y,e,n,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){let e,n,r,s,i,o,a,c,h=1;do{for(s=t,t=null,c=null,r=0;s;){for(r++,o=s,i=0,n=0;n<h&&(i++,o=o.nextZ,o);n++);for(a=h;i>0||a>0&&o;)0!==i&&(0===a||!o||s.z<=o.z)?(e=s,s=s.nextZ,i--):(e=o,o=o.nextZ,a--),c?c.nextZ=e:t=e,e.prevZ=c,c=e;s=o}c.nextZ=null,h*=2}while(r>1)}(s)}(t,r,s,i);let a,c,h=t;for(;t.prev!==t.next;)if(a=t.prev,c=t.next,i?al(t,r,s,i):ol(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),Tl(t),t=c.next,h=c.next;else if((t=c)===h){o?1===o?il(t=cl(sl(t),e,n),e,n,r,s,i,2):2===o&&hl(t,e,n,r,s,i):il(sl(t),e,n,r,s,i,1);break}}function ol(t){const e=t.prev,n=t,r=t.next;if(Al(e,n,r)>=0)return!1;const s=e.x,i=n.x,o=r.x,a=e.y,c=n.y,h=r.y,l=s<i?s<o?s:o:i<o?i:o,u=a<c?a<h?a:h:c<h?c:h,d=s>i?s>o?s:o:i>o?i:o,f=a>c?a>h?a:h:c>h?c:h;let m=r.next;for(;m!==e;){if(m.x>=l&&m.x<=d&&m.y>=u&&m.y<=f&&gl(s,a,i,c,o,h,m.x,m.y)&&Al(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function al(t,e,n,r){const s=t.prev,i=t,o=t.next;if(Al(s,i,o)>=0)return!1;const a=s.x,c=i.x,h=o.x,l=s.y,u=i.y,d=o.y,f=a<c?a<h?a:h:c<h?c:h,m=l<u?l<d?l:d:u<d?u:d,g=a>c?a>h?a:h:c>h?c:h,p=l>u?l>d?l:d:u>d?u:d,A=fl(f,m,e,n,r),y=fl(g,p,e,n,r);let B=t.prevZ,b=t.nextZ;for(;B&&B.z>=A&&b&&b.z<=y;){if(B.x>=f&&B.x<=g&&B.y>=m&&B.y<=p&&B!==s&&B!==o&&gl(a,l,c,u,h,d,B.x,B.y)&&Al(B.prev,B,B.next)>=0)return!1;if(B=B.prevZ,b.x>=f&&b.x<=g&&b.y>=m&&b.y<=p&&b!==s&&b!==o&&gl(a,l,c,u,h,d,b.x,b.y)&&Al(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;B&&B.z>=A;){if(B.x>=f&&B.x<=g&&B.y>=m&&B.y<=p&&B!==s&&B!==o&&gl(a,l,c,u,h,d,B.x,B.y)&&Al(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;b&&b.z<=y;){if(b.x>=f&&b.x<=g&&b.y>=m&&b.y<=p&&b!==s&&b!==o&&gl(a,l,c,u,h,d,b.x,b.y)&&Al(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function cl(t,e,n){let r=t;do{const s=r.prev,i=r.next.next;!yl(s,i)&&Bl(s,r,r.next,i)&&wl(s,i)&&wl(i,s)&&(e.push(s.i/n|0),e.push(r.i/n|0),e.push(i.i/n|0),Tl(r),Tl(r.next),r=t=i),r=r.next}while(r!==t);return sl(r)}function hl(t,e,n,r,s,i){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&pl(o,t)){let a=vl(o,t);return o=sl(o,o.next),a=sl(a,a.next),il(o,e,n,r,s,i,0),void il(a,e,n,r,s,i,0)}t=t.next}o=o.next}while(o!==t)}function ll(t,e){return t.x-e.x}function ul(t,e){const n=function(t,e){let n=e;const r=t.x,s=t.y;let i,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){const t=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>o&&(o=t,i=n.x<n.next.x?n:n.next,t===r))return i}n=n.next}while(n!==e);if(!i)return null;const a=i,c=i.x,h=i.y;let l,u=1/0;n=i;do{r>=n.x&&n.x>=c&&r!==n.x&&gl(s<h?r:o,s,c,h,s<h?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),wl(n,t)&&(l<u||l===u&&(n.x>i.x||n.x===i.x&&dl(i,n)))&&(i=n,u=l)),n=n.next}while(n!==a);return i}(t,e);if(!n)return e;const r=vl(n,t);return sl(r,r.next),sl(n,n.next)}function dl(t,e){return Al(t.prev,t,e.prev)<0&&Al(e.next,t,t.next)<0}function fl(t,e,n,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ml(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function gl(t,e,n,r,s,i,o,a){return(s-o)*(e-a)>=(t-o)*(i-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(i-a)>=(s-o)*(r-a)}function pl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Bl(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(wl(t,e)&&wl(e,t)&&function(t,e){let n=t,r=!1;const s=(t.x+e.x)/2,i=(t.y+e.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&s<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Al(t.prev,t,e.prev)||Al(t,e.prev,e))||yl(t,e)&&Al(t.prev,t,t.next)>0&&Al(e.prev,e,e.next)>0)}function Al(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function yl(t,e){return t.x===e.x&&t.y===e.y}function Bl(t,e,n,r){const s=Cl(Al(t,e,n)),i=Cl(Al(t,e,r)),o=Cl(Al(n,r,t)),a=Cl(Al(n,r,e));return s!==i&&o!==a||!(0!==s||!bl(t,n,e))||!(0!==i||!bl(t,r,e))||!(0!==o||!bl(n,t,r))||!(0!==a||!bl(n,e,r))}function bl(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Cl(t){return t>0?1:t<0?-1:0}function wl(t,e){return Al(t.prev,t,t.next)<0?Al(t,e,t.next)>=0&&Al(t,t.prev,e)>=0:Al(t,e,t.prev)<0||Al(t,t.next,e)<0}function vl(t,e){const n=new _l(t.i,t.x,t.y),r=new _l(e.i,e.x,e.y),s=t.next,i=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function El(t,e,n,r){const s=new _l(t,e,n);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Tl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}class _l{constructor(t,e,n){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=n}}function Ml(t,e,n){const r=function(t){const e={};for(const s of t)if(s.properties)for(const t in s.properties){const i=s.properties[t];e[t]=(n=i,(r=e[t])!==Array&&Number.isFinite(n)?r===Float64Array||Math.fround(n)!==n?Float64Array:Float32Array:Array)}var n,r;return e}(t),s=Object.keys(r).filter((t=>r[t]!==Array));return function(t,e,n){const{pointPositionsCount:r,pointFeaturesCount:s,linePositionsCount:i,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:c,polygonObjectsCount:h,polygonRingsCount:l,polygonFeaturesCount:u,propArrayTypes:d,coordLength:f}=e,{numericPropKeys:m=[],PositionDataType:g=Float32Array,triangulate:p=!0}=n,A=t[0]&&"id"in t[0],y=t.length>65535?Uint32Array:Uint16Array,B={type:"Point",positions:new g(r*f),globalFeatureIds:new y(r),featureIds:s>65535?new Uint32Array(r):new Uint16Array(r),numericProps:{},properties:[],fields:[]},b={type:"LineString",pathIndices:i>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new g(i*f),globalFeatureIds:new y(i),featureIds:a>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},C={type:"Polygon",polygonIndices:c>65535?new Uint32Array(h+1):new Uint16Array(h+1),primitivePolygonIndices:c>65535?new Uint32Array(l+1):new Uint16Array(l+1),positions:new g(c*f),globalFeatureIds:new y(c),featureIds:u>65535?new Uint32Array(c):new Uint16Array(c),numericProps:{},properties:[],fields:[]};p&&(C.triangles=[]);for(const t of[B,b,C])for(const e of m){const n=d[e];t.numericProps[e]=new n(t.positions.length/f)}b.pathIndices[o]=i,C.polygonIndices[h]=c,C.primitivePolygonIndices[l]=c;const w={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const e of t){const t=e.geometry,n=e.properties||{};switch(t.type){case"Point":Il(t,B,w,f,n),B.properties.push(Dl(n,m)),A&&B.fields.push({id:e.id}),w.pointFeature++;break;case"LineString":xl(t,b,w,f,n),b.properties.push(Dl(n,m)),A&&b.fields.push({id:e.id}),w.lineFeature++;break;case"Polygon":Sl(t,C,w,f,n),C.properties.push(Dl(n,m)),A&&C.fields.push({id:e.id}),w.polygonFeature++;break;default:throw new Error("Invalid geometry type")}w.feature++}return function(t,e,n,r){const s={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:r},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:Rl(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:r},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:Rl(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:r},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:Rl(n.numericProps,1)}};return s.polygons&&n.triangles&&(s.polygons.triangles={value:new Uint32Array(n.triangles),size:1}),s}(B,b,C,f)}(t,{propArrayTypes:r,...e},{numericPropKeys:n&&n.numericPropKeys||s,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:!n||n.triangulate})}function Il(t,e,n,r,s){e.positions.set(t.data,n.pointPosition*r);const i=t.data.length/r;Fl(e,s,n.pointPosition,i),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+i),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+i),n.pointPosition+=i}function xl(t,e,n,r,s){e.positions.set(t.data,n.linePosition*r);const i=t.data.length/r;Fl(e,s,n.linePosition,i),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+i),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+i);for(let s=0,i=t.indices.length;s<i;++s){const o=t.indices[s],a=s===i-1?t.data.length:t.indices[s+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(a-o)/r}}function Sl(t,e,n,r,s){e.positions.set(t.data,n.polygonPosition*r);const i=t.data.length/r;Fl(e,s,n.polygonPosition,i),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+i),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+i);for(let s=0,i=t.indices.length;s<i;++s){const i=n.polygonPosition;e.polygonIndices[n.polygonObject++]=i;const o=t.areas[s],a=t.indices[s],c=t.indices[s+1];for(let s=0,i=a.length;s<i;++s){const o=a[s],h=s===i-1?void 0===c?t.data.length:c[0]:a[s+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(h-o)/r}Ol(e,o,a,{startPosition:i,endPosition:n.polygonPosition,coordLength:r})}}function Ol(t,e,n,r){let{startPosition:s,endPosition:i,coordLength:o}=r;if(!t.triangles)return;const a=s*o,c=i*o,h=t.positions.subarray(a,c),l=n[0],u=function(t,e,n=2,r,s="xy"){const i=e&&e.length,o=i?e[0]*n:t.length;let a=rl(t,0,o,n,!0,r&&r[0],s);const c=[];if(!a||a.next===a.prev)return c;let h,l,u,d,f,m,g;if(i&&(a=function(t,e,n,r,s,i){const o=[];let a,c,h,l,u;for(a=0,c=e.length;a<c;a++)h=e[a]*r,l=a<c-1?e[a+1]*r:t.length,u=rl(t,h,l,r,!1,s&&s[a+1],i),u===u.next&&(u.steiner=!0),o.push(ml(u));for(o.sort(ll),a=0;a<o.length;a++)n=ul(o[a],n);return n}(t,e,a,n,r,s)),t.length>80*n){d=l=t[0],f=u=t[1];for(let e=n;e<o;e+=n)m=t[e],g=t[e+1],m<d&&(d=m),g<f&&(f=g),m>l&&(l=m),g>u&&(u=g);h=Math.max(l-d,u-f),h=0!==h?32767/h:0}return il(a,c,n,d,f,h,0),c}(h,n.slice(1).map((t=>(t-l)/o)),o,e);for(let e=0,n=u.length;e<n;++e)t.triangles.push(s+u[e])}function Rl(t,e){const n={};for(const r in t)n[r]={value:t[r],size:e};return n}function Fl(t,e,n,r){for(const s in t.numericProps)if(s in e){const i=e[s];t.numericProps[s].fill(i,n,n+r)}}function Dl(t,e){const n={};for(const r in t)e.includes(r)||(n[r]=t[r]);return n}function Gl(t){let e=0,n=0,r=0,s=0,i=0,o=0,a=0,c=0,h=0;const l=new Set;for(const u of t){const t=u.geometry;switch(t.type){case"Point":n++,e++,l.add(t.coordinates.length);break;case"MultiPoint":n++,e+=t.coordinates.length;for(const e of t.coordinates)l.add(e.length);break;case"LineString":i++,r+=t.coordinates.length,s++;for(const e of t.coordinates)l.add(e.length);break;case"MultiLineString":i++;for(const e of t.coordinates){r+=e.length,s++;for(const t of e)l.add(t.length)}break;case"Polygon":h++,a++,c+=t.coordinates.length;const u=t.coordinates.flat();o+=u.length;for(const t of u)l.add(t.length);break;case"MultiPolygon":h++;for(const e of t.coordinates){a++,c+=e.length;const t=e.flat();o+=t.length;for(const e of t)l.add(e.length)}break;default:throw new Error(`Unsupported geometry type: ${t.type}`)}}return{coordLength:l.size>0?Math.max(...l):2,pointPositionsCount:e,pointFeaturesCount:n,linePositionsCount:r,linePathsCount:s,lineFeaturesCount:i,polygonPositionsCount:o,polygonObjectsCount:a,polygonRingsCount:c,polygonFeaturesCount:h}}function Ll(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{coordLength:2,fixRingWinding:!0};return t.map((t=>Hl(t,e)))}function Ul(t,e,n,r){n.push(e.length),e.push(...t);for(let n=t.length;n<r.coordLength;n++)e.push(0)}function Nl(t,e,n,r){n.push(e.length);for(const n of t){e.push(...n);for(let t=n.length;t<r.coordLength;t++)e.push(0)}}function Pl(t,e,n,r,s){let i=0;const o=[],a=[];for(const n of t){let t=nl(n.map((t=>t.slice(0,2))).flat());const r=t<0;s.fixRingWinding&&(0===i&&!r||i>0&&r)&&(n.reverse(),t=-t),o.push(t),Nl(n,e,a,s),i++}i>0&&(r.push(o),n.push(a))}function Hl(t,e){const{geometry:n}=t;if("GeometryCollection"===n.type)throw new Error("GeometryCollection type not supported");const r=[],s=[];let i,o;switch(n.type){case"Point":o="Point",Ul(n.coordinates,r,s,e);break;case"MultiPoint":o="Point",n.coordinates.map((t=>Ul(t,r,s,e)));break;case"LineString":o="LineString",Nl(n.coordinates,r,s,e);break;case"MultiLineString":o="LineString",n.coordinates.map((t=>Nl(t,r,s,e)));break;case"Polygon":o="Polygon",i=[],Pl(n.coordinates,r,s,i,e);break;case"MultiPolygon":o="Polygon",i=[],n.coordinates.map((t=>Pl(t,r,s,i,e)));break;default:throw new Error(`Unknown type: ${o}`)}return{...t,geometry:{type:o,indices:s,data:r,areas:i}}}function Jl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fixRingWinding:!0,triangulate:!0};const n=Gl(t),r=n.coordLength,{fixRingWinding:s}=e,i=Ll(t,{coordLength:r,fixRingWinding:s});return Ml(i,n,{numericPropKeys:e.numericPropKeys,PositionDataType:e.PositionDataType||Float32Array,triangulate:e.triangulate})}const jl={name:"GeoJSON",id:"geojson",module:"geojson",version:"4.1.4",worker:!0,extensions:["geojson"],mimeTypes:["application/geo+json"],category:"geometry",text:!0,options:{geojson:{shape:"object-row-table"},json:{shape:"object-row-table",jsonpaths:["$","$.features"]},gis:{format:"geojson"}},parse:async function(t,e){return kl((new TextDecoder).decode(t),e)},parseTextSync:kl,parseInBatches:function(t,e){(e={...jl.options,...e}).json={...jl.options.geojson,...e.geojson};const n=async function*(t,e){const n=function(t){try{let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){const n=new TextDecoder(void 0,e);for await(const e of t)yield"string"==typeof e?e:n.decode(e,{stream:!0})}()}catch(t){return Promise.reject(t)}}(t),{metadata:r}=e,{jsonpaths:s}=e.json||{};let i=!0;const o=new Vh(null,e),a=new tl({jsonpaths:s});for await(const t of n){const n=a.write(t),s=n.length>0&&a.getStreamingJsonPathAsString();if(n.length>0&&i){if(r){var c;const t={shape:(null==e||null===(c=e.json)||void 0===c?void 0:c.shape)||"array-row-table",batchType:"partial-result",data:[],length:0,bytesUsed:0,container:a.getPartialResult(),jsonpath:s};yield t}i=!1}for(const t of n){o.addRow(t);const e=o.getFullBatch({jsonpath:s});e&&(yield e)}o.chunkComplete(t);const h=o.getFullBatch({jsonpath:s});h&&(yield h)}const h=a.getStreamingJsonPathAsString(),l=o.getFinalBatch({jsonpath:h});if(l&&(yield l),r){const t={shape:"json",batchType:"final-result",container:a.getPartialResult(),jsonpath:a.getStreamingJsonPathAsString(),data:[],length:0};yield t}}(t,e);return"binary"===e.gis.format?async function*(t){for await(const e of t)e.data=Jl(e.data),yield e}(n):n}};function kl(t,e){var n;let r;(e={...jl.options,...e}).geojson={...jl.options.geojson,...e.geojson},e.gis=e.gis||{};try{r=JSON.parse(t)}catch{r={}}const s={shape:"geojson-table",type:"FeatureCollection",features:(null===(n=r)||void 0===n?void 0:n.features)||[]};return"binary"===e.gis.format?Jl(s.features):s}function Vl(e){const n=64,r=document.createElement("canvas");r.width=n,r.height=n;const s=r.getContext("2d");s.rect(0,0,n,n);const i=s.createLinearGradient(0,0,n,n);for(let t=0;t<e.length;t++){const n=e[t];i.addColorStop(n[0],"#"+n[1].getHexString())}s.fillStyle=i,s.fill();const o=new t.CanvasTexture(r);return o.needsUpdate=!0,o.minFilter=t.LinearFilter,o.wrapS=t.RepeatWrapping,o.wrapT=t.RepeatWrapping,o.repeat.set(2,2),o}function Kl(e){e.updateMatrix(),e.updateMatrixWorld(),e.matrixWorldInverse.copy(e.matrixWorld).invert();const n=new t.Frustum;return n.setFromProjectionMatrix((new t.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),n}function Ql(e){const{boundingVolume:n}=e;let r=0;e.content&&(r=Math.min(e.content.byteLength/5e5,1));const s=new t.Color(r,1,0),i=new t.BoxGeometry(1,1,1),o=new t.Matrix4;n.halfAxes?o.copy(ql(n.halfAxes)):n.radius&&i.scale(2*n.radius,2*n.radius,2*n.radius),i.applyMatrix4(o);const a=new t.EdgesGeometry(i),c=new t.LineSegments(a,new t.LineBasicMaterial({color:s}));return c.position.copy(new t.Vector3(...n.center)),c}function ql(e){const n=e;return(new t.Matrix4).fromArray([2*n[0],2*n[1],2*n[2],0,2*n[3],2*n[4],2*n[5],0,2*n[6],2*n[7],2*n[8],0,0,0,0,1])}function zl(t){return function(t){let e=0;for(const n in t.attributes){const r=t.getAttribute(n);e+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const n=t.getIndex();return e+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,e}(t)}const Wl={SPECTRAL:[[0,new t.Color(.3686,.3098,.6353)],[.1,new t.Color(.1961,.5333,.7412)],[.2,new t.Color(.4,.7608,.6471)],[.3,new t.Color(.6706,.8667,.6431)],[.4,new t.Color(.902,.9608,.5961)],[.5,new t.Color(1,1,.749)],[.6,new t.Color(.9961,.8784,.5451)],[.7,new t.Color(.9922,.6824,.3804)],[.8,new t.Color(.9569,.4275,.2627)],[.9,new t.Color(.8353,.2431,.3098)],[1,new t.Color(.6196,.0039,.2588)]],PLASMA:[[0,new t.Color(.241,.015,.61)],[.1,new t.Color(.387,.001,.654)],[.2,new t.Color(.524,.025,.653)],[.3,new t.Color(.651,.125,.596)],[.4,new t.Color(.752,.227,.513)],[.5,new t.Color(.837,.329,.431)],[.6,new t.Color(.907,.435,.353)],[.7,new t.Color(.963,.554,.272)],[.8,new t.Color(.992,.681,.195)],[.9,new t.Color(.987,.822,.144)],[1,new t.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new t.Color(.1647,.2824,.3451)],[.1,new t.Color(.1338,.3555,.4227)],[.2,new t.Color(.061,.4319,.4864)],[.3,new t.Color(0,.5099,.5319)],[.4,new t.Color(0,.5881,.5569)],[.5,new t.Color(.137,.665,.5614)],[.6,new t.Color(.2906,.7395,.5477)],[.7,new t.Color(.4453,.8099,.5201)],[.8,new t.Color(.6102,.8748,.485)],[.9,new t.Color(.7883,.9323,.4514)],[1,new t.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new t.Color(.267,.005,.329)],[.1,new t.Color(.283,.141,.458)],[.2,new t.Color(.254,.265,.53)],[.3,new t.Color(.207,.372,.553)],[.4,new t.Color(.164,.471,.558)],[.5,new t.Color(.128,.567,.551)],[.6,new t.Color(.135,.659,.518)],[.7,new t.Color(.267,.749,.441)],[.8,new t.Color(.478,.821,.318)],[.9,new t.Color(.741,.873,.15)],[1,new t.Color(.993,.906,.144)]],INFERNO:[[0,new t.Color(.077,.042,.206)],[.1,new t.Color(.225,.036,.388)],[.2,new t.Color(.373,.074,.432)],[.3,new t.Color(.522,.128,.42)],[.4,new t.Color(.665,.182,.37)],[.5,new t.Color(.797,.255,.287)],[.6,new t.Color(.902,.364,.184)],[.7,new t.Color(.969,.516,.063)],[.8,new t.Color(.988,.683,.072)],[.9,new t.Color(.961,.859,.298)],[1,new t.Color(.988,.998,.645)]],GRAYSCALE:[[0,new t.Color(0,0,0)],[1,new t.Color(1,1,1)]],TURBO:[[0,new t.Color(.18995,.07176,.23217)],[.07,new t.Color(.25107,.25237,.63374)],[.13,new t.Color(.27628,.42118,.89123)],[.2,new t.Color(.25862,.57958,.99876)],[.27,new t.Color(.15844,.73551,.92305)],[.33,new t.Color(.09267,.86554,.7623)],[.4,new t.Color(.19659,.94901,.59466)],[.47,new t.Color(.42778,.99419,.38575)],[.53,new t.Color(.64362,.98999,.23356)],[.6,new t.Color(.80473,.92452,.20459)],[.67,new t.Color(.93301,.81236,.22667)],[.73,new t.Color(.99314,.67408,.20348)],[.8,new t.Color(.9836,.49291,.12849)],[.87,new t.Color(.92105,.31489,.05475)],[.93,new t.Color(.81608,.18462,.01809)],[1,new t.Color(.66449,.08436,.00424)]],RAINBOW:[[0,new t.Color(.278,0,.714)],[1/6,new t.Color(0,0,1)],[2/6,new t.Color(0,1,1)],[.5,new t.Color(0,1,0)],[4/6,new t.Color(1,1,0)],[5/6,new t.Color(1,.64,0)],[1,new t.Color(1,0,0)]],CONTOUR:[[0,new t.Color(0,0,0)],[.03,new t.Color(0,0,0)],[.04,new t.Color(1,1,1)],[1,new t.Color(1,1,1)]]};var Xl=(t=>(t[t.Intensity=1]="Intensity",t[t.Classification=2]="Classification",t[t.Elevation=3]="Elevation",t[t.RGB=4]="RGB",t[t.White=5]="White",t))(Xl||{}),Yl=(t=>(t[t.FlatTexture=1]="FlatTexture",t[t.ShadedTexture=2]="ShadedTexture",t[t.ShadedNoTexture=3]="ShadedNoTexture",t))(Yl||{});const Zl="undefined"!=typeof document?Vl(Wl.RAINBOW):null,$l="undefined"!=typeof document?Vl(Wl.GRAYSCALE):null,tu={throttleRequests:!0,maxRequests:64,updateInterval:.1,maxConcurrency:1,maximumScreenSpaceError:16,memoryAdjustedScreenSpaceError:!0,maximumMemoryUsage:400,memoryCacheOverflow:128,viewDistanceScale:1,skipLevelOfDetail:!1,resetTransform:!1,updateTransforms:!0,shading:Yl.FlatTexture,transparent:!1,pointCloudColoring:Xl.White,pointSize:1,worker:!0,wireframe:!1,debug:!1,gltfLoader:null,basisTranscoderPath:null,dracoDecoderPath:null,material:null,contentPostProcess:void 0,preloadTilesCount:null,collectAttributions:!1};function eu(t){var e,n,r,s;(null==(e=null==t?void 0:t.uniforms)?void 0:e.map)?null==(r=null==(n=null==t?void 0:t.uniforms)?void 0:n.map.value)||r.dispose():t.map&&(null==(s=t.map)||s.dispose()),t.dispose()}function nu(t){t.traverse((t=>{if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)eu(t.material);else for(const e of t.material)eu(e)}));for(let e=t.children.length-1;e>=0;e--){const n=t.children[e];t.remove(n)}}if(r(384),"undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");const ru={white:Xl.White,intensity:Xl.Intensity,classification:Xl.Classification,elevation:Xl.Elevation,rgb:Xl.RGB};AFRAME.registerComponent("loader-3dtiles",{schema:{url:{type:"string"},cameraEl:{type:"selector"},maximumSSE:{type:"int",default:16},maximumMem:{type:"int",default:32},distanceScale:{type:"number",default:1},pointcloudColoring:{type:"string",default:"white"},pointcloudElevationRange:{type:"array",default:["0","400"]},wireframe:{type:"boolean",default:!1},showStats:{type:"boolean",default:!1},cesiumIONToken:{type:"string"},googleApiKey:{type:"string"},lat:{type:"number"},long:{type:"number"},height:{type:"number",default:0},copyrightEl:{type:"selector"}},init:async function(){const e=this.el.sceneEl,n=this.data;if(this.camera=n.cameraEl?.object3D.children[0]??document.querySelector("a-scene").camera,!this.camera)throw new Error("3D Tiles: Please add an active camera or specify the target camera via the cameraEl property");this.viewportSize=new t.Vector2(e.clientWidth,e.clientHeight);const{model:r,runtime:s}=await this._initTileset();this.el.setObject3D("tileset",r),this.originalCamera=this.camera,e.addEventListener("camera-set-active",(t=>{this.camera=t.detail.cameraEl.object3D.children[0]??this.originalCamera})),this.el.addEventListener("cameraChange",(t=>{this.camera=t.detail,"OrthographicCamera"===this.camera.type&&(this.camera.rotation.x<-1?this.camera.position.y=100:this.camera.position.y=10)})),e.addEventListener("enter-vr",(t=>{this.originalCamera=this.camera;try{this.camera=e.renderer.xr.getCamera(this.camera),e.renderer.xr.getSession().requestAnimationFrame(((t,n)=>{const r=e.renderer.xr.getReferenceSpace(),s=n.getViewerPose(r);if(s){const t=s.views[0].projectionMatrix[5];this.camera.fov=2*Math.atan2(1,t)*180/Math.PI}}))}catch(t){console.warn("Could not get VR camera")}})),e.addEventListener("exit-vr",(t=>{this.camera=this.originalCamera})),n.showStats&&(this.stats=this._initStats()),THREE.Cache.enabled&&(console.warn("3D Tiles loader cannot work with THREE.Cache, disabling."),THREE.Cache.enabled=!1),await this._nextFrame(),this.runtime=s,this.runtime.setElevationRange(n.pointcloudElevationRange.map((t=>Number(t)))),window.addEventListener("resize",this.onWindowResize.bind(this)),AFRAME.INSPECTOR&&AFRAME.INSPECTOR.opened&&(this.camera=AFRAME.INSPECTOR.camera,this.play())},onWindowResize:function(){const t=this.el.sceneEl;this.viewportSize.set(t.clientWidth,t.clientHeight),this.camera.aspect=t.clientWidth/t.clientHeight,this.camera.updateProjectionMatrix()},update:async function(t){if(t.url!==this.data.url){this.runtime&&(this.runtime.dispose(),this.runtime=null);const{model:t,runtime:e}=await this._initTileset();this.el.setObject3D("tileset",t),await this._nextFrame(),this.runtime=e}else this.runtime&&(this.runtime.setPointCloudColoring(this._resolvePointcloudColoring(this.data.pointCloudColoring)),this.runtime.setWireframe(this.data.wireframe),this.runtime.setViewDistanceScale(this.data.distanceScale),this.runtime.setElevationRange(this.data.pointcloudElevationRange.map((t=>Number(t)))));this.data.showStats&&!this.stats&&(this.stats=this._initStats()),!this.data.showStats&&this.stats&&(this.el.sceneEl.removeChild(this.stats),this.stats=null),(this.data.lat&&this.data.long||this.data.height)&&this.runtime.orientToGeocoord({lat:Number(this.data.lat),long:Number(this.data.long),height:Number(this.data.height)})},tick:function(e,n){if(this.runtime){if(this.runtime.update(n,this.viewportSize,this.camera),this.stats){const e=new t.Vector3;this.camera.getWorldPosition(e);const n=this.runtime.getStats();this.stats.setAttribute("textarea","text",Object.values(n.stats).map((t=>`${t.name}: ${t.count}`)).join("\n"));const r=new t.Vector3;r.copy(e),r.z-=2,this.stats.setAttribute("position",r)}this.data.copyrightEl&&(this.data.copyrightEl.innerHTML=this.runtime.getDataAttributions()??"")}},remove:function(){this.runtime&&this.runtime.dispose()},_resolvePointcloudColoring(){return ru[this.data.pointcloudColoring]||(console.warn("Invalid value for point cloud coloring"),Xl.White)},_initTileset:async function(){const e=this._resolvePointcloudColoring(this.data.pointcloudColoring);return class{static async load(e){const n={...tu,...e.options},{url:r}=e,s=n.updateInterval,i={};if(n.cesiumIONToken){i["cesium-ion"]={accessToken:n.cesiumIONToken};const t=await Ph.preload(r,i);i.fetch={headers:t.headers}}n.googleApiKey&&(i.fetch={headers:{"X-GOOG-API-KEY":n.googleApiKey}},e.options.hasOwnProperty("collectAttributions")||(n.collectAttributions=!0)),e.loadingManager&&e.loadingManager.itemStart(r);const o=await le(r,Dh,{...i}),a={},c={},h=[],l=new t.Group,u=new t.Group;n.debug||(u.visible=!1);const d={pointSize:{type:"f",value:n.pointSize},gradient:{type:"t",value:Zl},grayscale:{type:"t",value:$l},rootCenter:{type:"vec3",value:new t.Vector3},rootNormal:{type:"vec3",value:new t.Vector3},coloring:{type:"i",value:n.pointCloudColoring},hideGround:{type:"b",value:!0},elevationRange:{type:"vec2",value:new t.Vector2(0,400)},maxIntensity:{type:"f",value:1},intensityContrast:{type:"f",value:1},alpha:{type:"f",value:1}},f=new t.ShaderMaterial({uniforms:d,vertexShader:"\n  varying vec3 vColor;\n  uniform sampler2D gradient;\n  uniform sampler2D grayscale;\n  attribute float intensity;\n  attribute float classification;\n  uniform vec3 rootCenter;\n  uniform vec3 rootNormal;\n  uniform vec2 elevationRange;\n  uniform int coloring;\n  uniform bool hideGround;\n  uniform float maxIntensity;\n  uniform float intensityContrast;\n  uniform float pointSize;\n\n  #ifdef USE_COLOR\n  vec3 getRGB() {\n      vec3 rgb = color;\n      return rgb;\n  }\n  #endif\n\n  vec3 getElevation(){\n    vec4 world = modelMatrix * vec4( position, 1.0 );\n    float diff = abs(dot(rootNormal, (vec3(world) - rootCenter)));\n    float w = max(diff - elevationRange.x,0.0) / max(elevationRange.y - elevationRange.x,1.0);\n    vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\n    return cElevation;\n  }\n\n  vec3 getIntensity(){\n    // TODO: real contrast enhancement. Check https://github.com/yuki-koyama/enhancer/blob/master/shaders/enhancer.fs\n    float intmod = pow(intensity, intensityContrast);\n    vec3 cIntensity = texture2D(grayscale, vec2(intmod / maxIntensity ,1.0-(intmod / maxIntensity))).rgb;\n    return cIntensity;\n  }\n\n  vec3 getClassification(){\n    float classNormalized = classification / 255.0;\n    vec3 cClassification = texture2D(gradient, vec2(classNormalized * 5.0,1.0-classNormalized * 5.0)).rgb;\n    return cClassification;\n  }\n\n  vec3 getColor(){\n      vec3 color;\n      if (hideGround && classification == 2.0) {\n         return vec3(0.0, 0.0, 0.0);               \n      }\n\n      if (coloring == 1) {\n        color = getIntensity();\n      }\n      else if (coloring == 2) {\n        color = getClassification();\n      } else if (coloring == 3) {\n        color = getElevation();\n      } \n      #ifdef USE_COLOR\n      else if (coloring == 4) {\n        color = getRGB();\n      }\n      #endif\n      else {\n        color = vec3(1.0, 1.0, 1.0);\n      }\n      return color;\n  }\n\n  void main() {\n      vColor = getColor();\n\n      gl_PointSize = pointSize;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n",fragmentShader:"\n  varying vec3 vColor;\n  uniform float alpha;\n\n  void main() {\n    if (vColor == vec3(0.0, 0.0, 0.0)) {\n      discard;\n    } else {\n      gl_FragColor = vec4( vColor, alpha);\n    }\n  }\n",transparent:n.transparent,vertexColors:!0});let m,g,p,A=null,y=new t.Vector2;n.gltfLoader?m=n.gltfLoader:(m=new t.GLTFLoader,n.basisTranscoderPath&&(g=new t.KTX2Loader,g.detectSupport(e.renderer),g.setTranscoderPath(n.basisTranscoderPath+"/"),g.setWorkerLimit(1),m.setKTX2Loader(g)),n.dracoDecoderPath&&(p=new t.DRACOLoader,p.setDecoderPath(n.dracoDecoderPath+"/"),p.setWorkerLimit(n.maxConcurrency),m.setDRACOLoader(p)));const B=new t.MeshBasicMaterial({transparent:n.transparent}),b={maximumMemoryUsage:n.maximumMemoryUsage,maximumScreenSpaceError:n.maximumScreenSpaceError,memoryAdjustedScreenSpaceError:n.memoryAdjustedScreenSpaceError,memoryCacheOverflow:n.memoryCacheOverflow,viewDistanceScale:n.viewDistanceScale,skipLevelOfDetail:n.skipLevelOfDetail,updateTransforms:n.updateTransforms,throttleRequests:n.throttleRequests,maxRequests:n.maxRequests,contentLoader:async e=>{let r=null;switch(e.type){case Vr.POINTCLOUD:r=function(e,n,r,s){const i={rtc_center:e.content.rtcCenter,points:e.content.attributes.positions,intensities:e.content.attributes.intensity,classifications:e.content.attributes.classification,rgb:null,rgba:null},{colors:o}=e.content.attributes;o&&3===o.size&&(i.rgb=o.value),o&&4===o.size&&(i.rgba=o.value);const a=new t.BufferGeometry;a.setAttribute("position",new t.Float32BufferAttribute(i.points,3));const c=(new t.Matrix4).fromArray(e.computedTransform).premultiply(s);i.rgba?a.setAttribute("color",new t.Float32BufferAttribute(i.rgba,4)):i.rgb&&a.setAttribute("color",new t.Uint8BufferAttribute(i.rgb,3,!0)),i.intensities&&a.setAttribute("intensity",new t.BufferAttribute(i.intensities,1,!0)),i.classifications&&a.setAttribute("classification",new t.Uint8BufferAttribute(i.classifications,1,!1)),e.content.geometriesByteLength=zl(a),e.content.gpuMemoryUsageInBytes=e.content.geometriesByteLength;const h=new t.Points(a,r.material||n);if(i.rtc_center){const e=i.rtc_center;c.multiply((new t.Matrix4).makeTranslation(e[0],e[1],e[2]))}return h.applyMatrix4(c),r.contentPostProcess&&r.contentPostProcess(h),h}(e,f,n,L);break;case Vr.SCENEGRAPH:case Vr.MESH:r=await async function(e,n,r,s,i){return new Promise(((o,a)=>{const c=(new t.Matrix4).makeRotationAxis(new t.Vector3(1,0,0),Math.PI/2),h="Z"!==n.content.gltfUpAxis,l=(new t.Matrix4).fromArray(n.computedTransform).premultiply(i);h&&l.multiply(c),n.content.byteLength||(n.content.byteLength=n.content.gltfArrayBuffer.byteLength),e.parse(n.content.gltfArrayBuffer,n.contentUrl?n.contentUrl.substr(0,n.contentUrl.lastIndexOf("/")+1):"",(t=>{n.userData.asset=t.asset;const e=t.scenes[0];e.applyMatrix4(l),n.content.texturesByteLength=0,n.content.geometriesByteLength=0,e.traverse((t=>{if("Mesh"==t.type){const e=t;n.content.geometriesByteLength+=zl(e.geometry);const i=e.material,o=i.map,a=function(t){let e=0;if("image/ktx2"==t.userData.mimeType&&t.mipmaps){for(let n=0;n<t.mipmaps.length;n++)e+=t.mipmaps[n].data.byteLength;return e}if(t.image){const{image:n}=t,r=4;let s=[n.width,n.height];for(;s[0]>1||s[1]>1;)e+=s[0]*s[1]*r,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return e+=1*r,e}}(o);a&&(n.content.texturesByteLength+=a),s.material?(e.material=s.material.clone(),i.dispose()):s.shading==Yl.FlatTexture&&"MeshBasicMaterial"!==e.material.type&&(e.material=r.clone(),i.dispose()),s.shading!=Yl.ShadedNoTexture?"ShaderMaterial"==e.material.type?e.material.uniforms.map={value:o}:e.material.map=o:(o&&o.dispose(),e.material.map=null),e.material.wireframe=s.wireframe,s.contentPostProcess&&s.contentPostProcess(e)}})),n.content.gpuMemoryUsageInBytes=n.content.texturesByteLength+n.content.geometriesByteLength,o(e)}),(t=>{a(new Error(`error parsing gltf in tile ${n.id}: ${t}`))}))}))}(m,e,B,n,L)}if(r&&(r.visible=!1,a[e.id]=r,l.add(a[e.id]),n.debug)){const t=Ql(e);u.add(t),c[e.id]=t}},onTileLoad:async t=>{C&&(n.resetTransform&&!T&&(null==t?void 0:t.depth)<=5&&U(t),R=!0)},onTileUnload:t=>{h.push(t)},onTileError:(t,e)=>{console.error("Tile error",t.id,e)},onTraversalComplete:t=>(n.collectAttributions&&(_=function(t){const e=new Map;return t.forEach((t=>{var n,r;const s=null==(r=null==(n=null==t?void 0:t.userData)?void 0:n.asset)?void 0:r.copyright;s&&s.split(/;/g).map((t=>t.trim())).forEach((t=>{t&&e.set(t,(e.get(t)||0)+1)}))})),Array.from(e).sort(((t,e)=>e[1]-t[1])).map((([t])=>t)).join("; ")}(t)),t)},C=new Us(o,{...b,loadOptions:{...i,maxConcurrency:n.maxConcurrency,worker:n.worker,gltf:{loadImages:!1},"3d-tiles":{loadGLTF:!1}}}),w=new t.Matrix4,v=new t.Matrix4,E=new t.Vector3;let T=!1,_="";if(C.root.boundingVolume?(C.root.header.boundingVolume.region&&console.warn("Cannot apply a model matrix to bounding volumes of type region. Tileset stays in original geo-coordinates."),v.setPosition(C.root.boundingVolume.center[0],C.root.boundingVolume.center[1],C.root.boundingVolume.center[2])):console.warn("Bounding volume not found, no transformations applied"),n.debug){const t=Ql(C.root);u.add(t),c[C.root.id]=t}let M=!1,I=!1;d.rootCenter.value.copy(E),d.rootNormal.value.copy(new t.Vector3(0,0,1).normalize()),C.stats.get("Loader concurrency").count=n.maxConcurrency,C.stats.get("Maximum mem usage").count=n.maximumMemoryUsage;let x=0,S=null,O=null,R=!1;const F=new t.Vector3(1/0,1/0,1/0);let D=null;l.updateMatrixWorld(!0);const G=(new t.Matrix4).copy(l.matrixWorld),L=(new t.Matrix4).copy(G).invert();function U(e){if(!e.boundingVolume.halfAxes)return;const n=e.boundingVolume.halfAxes,r=(new t.Matrix4).extractRotation(ql(n)).premultiply((new t.Matrix4).extractRotation(L));if(!(new t.Euler).setFromRotationMatrix(r).equals(new t.Euler)){T=!0;const e=new t.Vector3(v.elements[12],v.elements[13],v.elements[14]);v.extractRotation(r),v.setPosition(e)}}function N(){w.copy(G),n.resetTransform&&w.multiply((new t.Matrix4).copy(v).invert()),C.modelMatrix=new dn(w.toArray())}function P(r,s,i,o){if(M||!o)return;if(!D||o.aspect!=O){if(o instanceof t.PerspectiveCamera){const t=new pr({fov:o.fov/180*Math.PI,aspectRatio:o.aspect,near:o.near,far:o.far});D=t.sseDenominator}else if(o instanceof t.OrthographicCamera){const t=o.right-o.left,e=o.top-o.bottom,n=t/e;D=Math.max(e/i,t/(i*n))}O=o.aspect,n.debug&&console.log("Updated sse denonimator:",D)}const a=Kl(o).planes.map((t=>new ir(t.normal.toArray(),t.constant))),d=new hr(a),f={camera:{position:F.toArray()},height:i,frameNumber:r._frameNumber,sseDenominator:D,cullingVolume:d,viewport:{id:0}};r._cache.reset(),r._traverser.traverse(r.root,f,r.options);for(const t of r.tiles)t.selected?s[t.id]?s[t.id].visible=!0:console.error("TILE SELECTED BUT NOT LOADED!!",t.id):s[t.id]&&(s[t.id].visible=!1);for(;h.length>0;){const t=h.pop();s[t.id]&&0==t.contentState&&(l.remove(s[t.id]),nu(s[t.id]),delete s[t.id]),c[t.id]&&(nu(c[t.id]),u.remove(c[t.id]),delete c[t.id])}const m=r.stats.get("Tiles Loaded").count,g=r.stats.get("Tiles Loading").count;return e.onProgress&&e.onProgress(m,m+g),e.loadingManager&&!I&&0==g&&(null==n.preloadTilesCount||m>=n.preloadTilesCount)&&(I=!0,e.loadingManager.itemEnd(e.url)),f}return n.resetTransform&&U(C.root),n.debug&&(c[C.root.id].applyMatrix4(w),u.matrixWorld.copy(l.matrixWorld)),{model:l,runtime:{getTileset:()=>C,getStats:()=>C.stats,getDataAttributions:()=>_,showTiles:t=>{u.visible=t},setWireframe:e=>{n.wireframe=e,l.traverse((n=>{n instanceof t.Mesh&&(n.material.wireframe=e)}))},setDebug:t=>{n.debug=t,u.visible=t},setShading:t=>{n.shading=t},getTileBoxes:()=>u,setViewDistanceScale:t=>{C.options.viewDistanceScale=t,C._frameNumber++,P(C,a,y.y,A)},setMaximumScreenSpaceError:t=>{C.options.maximumScreenSpaceError=t,C._frameNumber++,P(C,a,y.y,A)},setHideGround:t=>{d.hideGround.value=t},setPointCloudColoring:t=>{d.coloring.value=t},setElevationRange:t=>{d.elevationRange.value.set(t[0],t[1])},setMaxIntensity:t=>{d.maxIntensity.value=t},setIntensityContrast:t=>{d.intensityContrast.value=t},setPointAlpha:t=>{d.alpha.value=t},getLatLongHeightFromPosition:e=>{const n=C.ellipsoid.cartesianToCartographic((new t.Vector3).copy(e).applyMatrix4((new t.Matrix4).copy(w).invert()).toArray());return{lat:n[1],long:n[0],height:n[2]}},getPositionFromLatLongHeight:e=>{const n=C.ellipsoid.cartographicToCartesian([e.long,e.lat,e.height]);return new t.Vector3(...n).applyMatrix4(w)},orientToGeocoord:e=>{const n=[e.long,e.lat,e.height],r=C.ellipsoid.cartographicToCartesian(n),s=(new t.Matrix4).fromArray(C.ellipsoid.eastNorthUpToFixedFrame(r)),i=(new t.Matrix4).makeRotationFromEuler(new t.Euler(Math.PI/2,Math.PI/2,0));!function(e){const n=new t.Vector3,r=new t.Quaternion,s=new t.Vector3;e.decompose(n,r,s),l.position.copy(n),l.quaternion.copy(r),l.scale.copy(s),l.updateMatrix(),l.updateMatrixWorld(!0),G.copy(l.matrixWorld),L.copy(G).invert(),N()}((new t.Matrix4).copy(s).multiply(i).invert())},getWebMercatorCoord:e=>function(e,n){const r=2*Math.PI*6378137/2,s=n*r/180;let i=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return i=i*r/180,new t.Vector2(s,i)}(e.lat,e.long),getCameraFrustum:e=>{const n=Kl(e).planes.map((t=>new ir(t.normal.toArray(),t.constant))).map((e=>function(e){const n=new t.Group,r=new t.PlaneGeometry(10,5),s=new t.Vector3(...e.projectPointOntoPlane([0,0,0])),i=new t.Vector3(e.normal.x,e.normal.y,e.normal.z),o=(new t.Vector3).copy(s).add(i);r.lookAt(o),r.translate(s.x,s.y,s.z);const a=new t.MeshBasicMaterial({color:65535,side:t.DoubleSide}),c=new t.Mesh(r,a),h=new t.ArrowHelper(i,s,5,16776960);return n.add(h),n.add(c),n}(e))),r=new t.Group;for(const t of n)r.add(t);return r},overlayGeoJSON:t=>(t.applyMatrix4(w),t.updateMatrixWorld(),t),subtractBox:t=>(t.applyMatrix4(w),t.updateMatrixWorld(),t),update:function(e,r,i){if(A=i,y.copy(r),x+=e,C&&x>=s){if(!G.equals(l.matrixWorld)){x=0,G.copy(l.matrixWorld),n.updateTransforms&&N();const e=(new t.Vector3).setFromMatrixPosition(G);d.rootCenter.value.copy(e),d.rootNormal.value.copy(new t.Vector3(0,0,1).applyMatrix4(G).normalize()),L.copy(G).invert(),n.debug&&(c[C.root.id].matrixWorld.copy(w),c[C.root.id].applyMatrix4(G))}null==S?S=(new t.Matrix4).copy(i.matrixWorld):(R||function(e,n,r){const s=!e.matrixWorld.equals(n);return e instanceof t.PerspectiveCamera?s||e.aspect!==r:s}(i,S,O))&&(x=0,R=!1,C._frameNumber++,i.getWorldPosition(F),S.copy(i.matrixWorld),P(C,a,y.y,i))}},dispose:function(){for(M=!0,C._destroy();l.children.length>0;){const t=l.children[0];nu(t),l.remove(t)}for(;u.children.length>0;){const t=u.children[0];u.remove(t),t.geometry.dispose(),t.material.dispose()}g&&g.dispose(),p&&p.dispose()}}}}static async loadGeoJSON(e){const{url:n,height:r,featureToColor:s}=e;return le(n,jl,{worker:!1,gis:{format:"binary"}}).then((e=>{const n=e,i=new t.BufferGeometry,o=n.polygons.positions.value.reduce(((t,e,n,s)=>{if(n%2==0){const i=[e,s[n+1],r],o=jn.WGS84.cartographicToCartesian(i);t.push(...o)}return t}),[]);if(s){const e=n.polygons.numericProps[s.feature].value.reduce(((t,e,n,r)=>{const i=s.colorMap(e);return t[3*n]=i.r,t[3*n+1]=i.g,t[3*n+2]=i.b,t}),[]);i.setAttribute("color",new t.Float32BufferAttribute(e,3))}i.setAttribute("position",new t.Float32BufferAttribute(o,3)),i.setIndex(new t.BufferAttribute(n.polygons.triangles.value,1));const a=new t.MeshBasicMaterial({transparent:!0});return a.vertexColors=!0,new t.Mesh(i,a)}))}}.load({url:this.data.url,renderer:this.el.sceneEl.renderer,options:{googleApiKey:this.data.googleApiKey,cesiumIONToken:this.data.cesiumIONToken,dracoDecoderPath:"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/libs/draco",basisTranscoderPath:"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/libs/basis",maximumScreenSpaceError:this.data.maximumSSE,maximumMemoryUsage:this.data.maximumMem,memoryCacheOverflow:128,pointCloudColoring:e,viewDistanceScale:this.data.distanceScale,wireframe:this.data.wireframe,updateTransforms:!0}})},_initStats:function(){const t=document.createElement("a-entity");return this.el.sceneEl.appendChild(t),t.setAttribute("position","-0.5 0 -1"),t.setAttribute("textarea",{cols:30,rows:15,text:"",color:"white",disabledBackgroundColor:"#0c1e2c",disabled:!0}),t},_nextFrame:async function(){return new Promise(((t,e)=>{setTimeout((()=>{t()}),0)}))}})})(),s})()));